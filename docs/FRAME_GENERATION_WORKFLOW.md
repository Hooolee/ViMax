# åˆ†é•œå¸§ç”Ÿæˆå·¥ä½œæµç¨‹è¯¦è§£

> æœ¬æ–‡æ¡£è¯¦ç»†è§£é‡Š ViMax ä¸­ä»åˆ†é•œæè¿°åˆ°æœ€ç»ˆè§†é¢‘çš„å®Œæ•´ç”Ÿæˆæµç¨‹ï¼ŒåŒ…æ‹¬å¹¶å‘æœºåˆ¶ã€Transition Video çš„ä½œç”¨ã€ä»¥åŠ Camera æ ‘çš„æ¦‚å¿µã€‚

## ç›®å½•

- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
- [è¯¦ç»†æµç¨‹](#è¯¦ç»†æµç¨‹)
- [å¹¶å‘æ‰§è¡Œæœºåˆ¶](#å¹¶å‘æ‰§è¡Œæœºåˆ¶)
- [Transition Video è¯¦è§£](#transition-videoè¯¦è§£)
- [Camera æ ‘ä¸ Timeline çš„åŒºåˆ«](#cameraæ ‘ä¸timelineçš„åŒºåˆ«)
- [å®ä¾‹åˆ†æ](#å®ä¾‹åˆ†æ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ ¸å¿ƒæ¦‚å¿µ

### 1. Camera æ ‘ï¼ˆç©ºé—´å…³ç³»ï¼‰

Camera æ ‘è¡¨ç¤ºæ‘„å½±æœºä½ä¹‹é—´çš„**ç©ºé—´åŒ…å«å…³ç³»**ï¼Œè€Œéæ—¶é—´é¡ºåºã€‚

```
Camera 0 (å…¨æ™¯)
    â”œâ”€â”€ Camera 1 (ä¸­æ™¯1)
    â”‚       â””â”€â”€ Camera 2 (ç‰¹å†™1)
    â”œâ”€â”€ Camera 3 (ä¸­æ™¯2)
    â”‚       â””â”€â”€ Camera 4 (ç‰¹å†™2)
    â””â”€â”€ Camera 5 (ä¸­è¿œæ™¯)
            â””â”€â”€ Camera 6 (è¿‘æ™¯)
```

**å…³é”®ç‚¹ï¼š**

- **çˆ¶å­å…³ç³»** = è§†é‡åŒ…å«å…³ç³»ï¼ˆå…¨æ™¯åŒ…å«ä¸­æ™¯ï¼Œä¸­æ™¯åŒ…å«ç‰¹å†™ï¼‰
- **ä¸æ˜¯æ—¶é—´é¡ºåº** = æ’­æ”¾æ—¶å¯èƒ½æ˜¯ 0â†’1â†’2â†’3â†’4â†’5â†’6
- **æ ¹èŠ‚ç‚¹** = ç¬¬ä¸€ä¸ªé•œå¤´ï¼ˆé€šå¸¸æ˜¯å»ºç«‹é•œå¤´ï¼‰

### 2. Timelineï¼ˆæ—¶é—´é¡ºåºï¼‰

Timeline æ˜¯ç”µå½±å®é™…æ’­æ”¾çš„æ—¶é—´é¡ºåºã€‚

```
Timelineæ’­æ”¾é¡ºåºï¼š
Shot 0 â†’ Shot 1 â†’ Shot 2 â†’ Shot 3 â†’ Shot 4 â†’ Shot 5 â†’ Shot 6
(å…¨æ™¯)  (ä¸­æ™¯)  (ç‰¹å†™)  (ä¸­æ™¯)  (ç‰¹å†™)  (ä¸­è¿œæ™¯) (è¿‘æ™¯)
```

### 3. ä¸¤ç§è§†é¢‘æ–‡ä»¶

| ç±»å‹                 | æ–‡ä»¶å                             | ç”¨é€”                        | æ˜¯å¦å¿…éœ€       |
| -------------------- | ---------------------------------- | --------------------------- | -------------- |
| **Transition Video** | `transition_video_from_shot_X.mp4` | ğŸ”§ è¾…åŠ©å·¥å…·ï¼Œæå–æ„å›¾å‚è€ƒå¸§ | éƒ¨åˆ†é•œå¤´éœ€è¦   |
| **æœ€ç»ˆè§†é¢‘**         | `video.mp4`                        | ğŸ¬ æœ€ç»ˆæˆå“ï¼Œç”¨äºå‰ªè¾‘       | æ‰€æœ‰é•œå¤´éƒ½éœ€è¦ |

---

## æ•´ä½“æ¶æ„

```
åˆ†é•œæè¿°ï¼ˆStoryboardï¼‰
    â†“
é•œå¤´æè¿°åˆ†è§£ï¼ˆShot Descriptionï¼‰
    â†“
æ„å»ºCameraæ ‘
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     å¹¶å‘ç”Ÿæˆæ‰€æœ‰é•œå¤´çš„å¸§              â”‚
â”‚  ï¼ˆæ¯ä¸ªCameraç‹¬ç«‹ï¼Œå†…éƒ¨æœ‰ä¾èµ–ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     é¡ºåºæˆ–å¹¶å‘ç”Ÿæˆæœ€ç»ˆè§†é¢‘            â”‚
â”‚  ï¼ˆæ ¹æ®interactive_modeé…ç½®ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Timelineå‰ªè¾‘
    â†“
æœ€ç»ˆæˆç‰‡
```

---

## è¯¦ç»†æµç¨‹

### é˜¶æ®µ 0ï¼šåˆ†é•œè§„åˆ’ï¼ˆStoryboardï¼‰

åœ¨å¸§ç”Ÿæˆä¹‹å‰ï¼Œå·²ç»å®Œæˆï¼š

```
âœ… åœºæ™¯è§„åˆ’ï¼ˆScene Planningï¼‰
âœ… è§’è‰²æå–ï¼ˆCharacter Extractionï¼‰
âœ… è§’è‰²è‚–åƒç”Ÿæˆï¼ˆCharacter Portraitsï¼‰
   - æ¯ä¸ªè§’è‰²çš„ä¸‰è§†å›¾ï¼ˆæ­£é¢ã€ä¾§é¢ã€èƒŒé¢ï¼‰
   - æŒ‰åœºæ™¯IDå’Œappearance_idç»„ç»‡
âœ… åˆ†é•œè®¾è®¡ï¼ˆStoryboardï¼‰
   - ç”Ÿæˆæ‰€æœ‰Shotçš„briefæè¿°
âœ… é•œå¤´æè¿°åˆ†è§£ï¼ˆShot Descriptionï¼‰
   - æ¯ä¸ªShotçš„é¦–å¸§æè¿°ï¼ˆff_descï¼‰
   - æ¯ä¸ªShotçš„æœ«å¸§æè¿°ï¼ˆlf_descï¼Œå¦‚æœéœ€è¦ï¼‰
   - æ¯ä¸ªShotçš„è¿åŠ¨æè¿°ï¼ˆmotion_descï¼‰
   - è§†è§‰æè¿°ï¼ˆvisual_descï¼‰
âœ… Cameraæ ‘æ„å»º
   - ç¡®å®šçˆ¶å­å…³ç³»
   - è®¡ç®—missing_info
```

### é˜¶æ®µ 1ï¼šç”Ÿæˆæ ¹é•œå¤´ï¼ˆShot 0ï¼‰

**Shot 0 æ˜¯æ•´ä¸ªæµç¨‹çš„åŸºç¡€ï¼Œå¿…é¡»æœ€å…ˆå®Œæˆã€‚**

```python
# ç¬¬1æ­¥ï¼šç”ŸæˆShot 0çš„first_frame
await generate_first_frame_for_shot_0(
    shot_description=shot_descriptions[0],
    character_portraits=character_portraits_registry,
)
# è¾“å‡ºï¼šshots/0/first_frame.png
```

**ä¸ºä»€ä¹ˆ Shot 0 è¦å…ˆå®Œæˆï¼Ÿ**

- å…¶ä»– Camera éƒ½å¯èƒ½ä¾èµ–å®ƒï¼ˆparent_shot_idx = 0ï¼‰
- å®ƒæ˜¯å»ºç«‹é•œå¤´ï¼Œæä¾›æ•´ä¸ªåœºæ™¯çš„ç©ºé—´å‚è€ƒ

### é˜¶æ®µ 2ï¼šå¹¶å‘ç”Ÿæˆå…¶ä»–é•œå¤´çš„å¸§

**æ‰€æœ‰ Camera åŒæ—¶å¼€å§‹å·¥ä½œï¼ˆå¹¶å‘ï¼‰ã€‚**

```python
# ä¼ªä»£ç 
tasks = []
for camera in camera_tree:
    task = generate_frames_for_camera(camera)
    tasks.append(task)

await asyncio.gather(*tasks)  # åŒæ—¶æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
```

#### æ¯ä¸ª Camera å†…éƒ¨çš„æµç¨‹

ä»¥**Camera 3ï¼ˆShot 3ï¼‰**ä¸ºä¾‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Camera 3: Shot 3 (é™ˆé»˜èµ°å‘æŠ¤æ  - ä¸­æ™¯)                    â”‚
â”‚ parent_shot_idx = 0                                      â”‚
â”‚ is_parent_fully_covers_child = true                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤1: ç­‰å¾…çˆ¶é•œå¤´å®Œæˆ
    â†“
    await frame_events[0]["first_frame"].wait()
    âœ… Shot 0çš„first_frame.pngå·²å®Œæˆ

æ­¥éª¤2: ç”ŸæˆTransition Video
    â†“
    è¾“å…¥ï¼š
      â€¢ Shot 0çš„first_frame.png
      â€¢ Shot 0çš„visual_descï¼ˆæ–‡å­—ï¼‰
      â€¢ Shot 3çš„visual_descï¼ˆæ–‡å­—ï¼‰
    è¾“å‡ºï¼š
      âœ… transition_video_from_shot_0.mp4
         [0-2.5s: Shot 0å†…å®¹] + [åˆ‡é•œå¤´] + [2.5-5s: Shot 3å†…å®¹]

æ­¥éª¤3: åœºæ™¯æ£€æµ‹åˆ‡åˆ†
    â†“
    ContentDetectoræ£€æµ‹åˆ‡é•œå¤´ä½ç½®
    â†“
    åˆ‡åˆ†æˆï¼š
      âœ… cache/...-Scene-001.mp4ï¼ˆShot 0éƒ¨åˆ†ï¼‰
      âœ… cache/...-Scene-002.mp4ï¼ˆShot 3éƒ¨åˆ†ï¼‰

æ­¥éª¤4: æå–å‚è€ƒå¸§
    â†“
    ä»Scene-002.mp4æå–ç¬¬0å¸§
    â†“
    âœ… new_camera_3.png
       ç‰¹ç‚¹ï¼šæ„å›¾âœ… èƒŒæ™¯âœ… ä½†ç»†èŠ‚å¯èƒ½ä¸å®Œç¾âš ï¸

æ­¥éª¤5: é€‰æ‹©å‚è€ƒå›¾å¹¶ç”ŸæˆPrompt
    â†“
    å¯ç”¨å‚è€ƒå›¾æ± ï¼š
      â€¢ new_camera_3.pngï¼ˆæ„å›¾+èƒŒæ™¯å‚è€ƒï¼‰
      â€¢ é™ˆé»˜è‚–åƒ_æ­£é¢.png
      â€¢ é™ˆé»˜è‚–åƒ_ä¾§é¢.png
      â€¢ é™ˆé»˜è‚–åƒ_èƒŒé¢.png
      â€¢ å‰ä¸€ä¸ªé•œå¤´çš„æœ«å¸§ï¼ˆå¦‚æœæœ‰ä¸”åŒåœºæ™¯ï¼‰
    â†“
    reference_image_selectoræ™ºèƒ½ç­›é€‰ï¼š
      é€‰ä¸­ï¼šnew_camera_3.png + é™ˆé»˜è‚–åƒ_ä¾§é¢.png
    â†“
    ç”Ÿæˆç»„åˆPromptï¼š
      "Image 0: æ„å›¾å’ŒèƒŒæ™¯æ­£ç¡®ï¼Œä½†é™ˆé»˜é¢éƒ¨éœ€è¦æ›¿æ¢
       Image 1: é™ˆé»˜çš„ä¾§é¢è‚–åƒ
       ç”Ÿæˆï¼šé™ˆé»˜åœ¨å¤©å°æŠ¤æ è¾¹çš„ä¸­æ™¯ï¼Œ
             ä½¿ç”¨Image 0çš„æ„å›¾å’ŒèƒŒæ™¯ï¼Œ
             ç”¨Image 1çš„é™ˆé»˜é¢éƒ¨ç‰¹å¾..."

æ­¥éª¤6: ç”Ÿæˆæœ€ç»ˆé¦–å¸§
    â†“
    è°ƒç”¨å›¾åƒç”ŸæˆAPIï¼ˆå¤šå‚è€ƒå›¾ç”Ÿæˆï¼‰
    â†“
    âœ… shots/3/first_frame.png
       æ„å›¾å®Œç¾âœ… é¢éƒ¨æ¸…æ™°âœ… èƒŒæ™¯æ­£ç¡®âœ…

æ­¥éª¤7: ç”Ÿæˆæœ«å¸§ï¼ˆå¦‚æœéœ€è¦ï¼‰
    â†“
    æ ¹æ®variation_typeå†³å®š
    â†“
    å¦‚æœæ˜¯"medium"æˆ–"large"ï¼š
      ç”Ÿæˆlast_frame.pngï¼ˆç±»ä¼¼æµç¨‹ï¼‰
```

### é˜¶æ®µ 3ï¼šç”Ÿæˆæœ€ç»ˆè§†é¢‘

**åœ¨æ‰€æœ‰å¸§ç”Ÿæˆå®Œæˆåï¼Œç”Ÿæˆæ¯ä¸ª Shot çš„ video.mp4ã€‚**

```python
# æ ¹æ®é…ç½®å†³å®šæ˜¯é¡ºåºè¿˜æ˜¯å¹¶å‘
if interactive_mode:
    # é¡ºåºç”Ÿæˆï¼Œæ¯ä¸ªå®Œæˆåç­‰å¾…ç”¨æˆ·ç¡®è®¤
    for shot in shot_descriptions:
        await generate_video_for_shot(shot)
        wait_for_user_confirmation()
else:
    # å¹¶å‘ç”Ÿæˆæ‰€æœ‰è§†é¢‘
    tasks = [generate_video_for_shot(shot) for shot in shot_descriptions]
    await asyncio.gather(*tasks)
```

#### å•ä¸ªé•œå¤´è§†é¢‘ç”Ÿæˆ

```
è¾“å…¥ï¼š
  â€¢ first_frame.png
  â€¢ motion_descï¼ˆè¿åŠ¨æè¿°ï¼‰
  â€¢ last_frame.pngï¼ˆå¦‚æœæœ‰ï¼‰

è°ƒç”¨è§†é¢‘ç”ŸæˆAPIï¼š
  prompt = f"åŸºäºé¦–å¸§ï¼ŒæŒ‰ç…§è¿åŠ¨æè¿°ç”Ÿæˆè§†é¢‘ï¼š{motion_desc}"
  reference_images = [first_frame.png, last_frame.png]

è¾“å‡ºï¼š
  âœ… shots/X/video.mp4ï¼ˆ5-10ç§’çš„æœ€ç»ˆæˆå“ï¼‰
```

### é˜¶æ®µ 4ï¼šTimeline å‰ªè¾‘

```python
# æ„å»ºæ—¶é—´çº¿
timeline = build_timeline(shot_descriptions, working_dir)
# è¾“å‡ºï¼štimeline.json

# æ¸²æŸ“æœ€ç»ˆè§†é¢‘
render_timeline(timeline, "final_video.mp4")
```

**Timeline ç»“æ„ï¼š**

```json
[
  {"shot_idx": 0, "video_path": "shots/0/video.mp4", "duration": 5.0},
  {"shot_idx": 1, "video_path": "shots/1/video.mp4", "duration": 3.0},
  {"shot_idx": 2, "video_path": "shots/2/video.mp4", "duration": 2.0},
  {"shot_idx": 3, "video_path": "shots/3/video.mp4", "duration": 5.0},
  ...
]
```

**æ³¨æ„ï¼šTransition videos ä¸ä¼šå‡ºç°åœ¨ Timeline ä¸­ï¼**

---

## å¹¶å‘æ‰§è¡Œæœºåˆ¶

### ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘ï¼Ÿ

```
å¦‚æœé¡ºåºæ‰§è¡Œï¼š
  Shot 0: 30ç§’ â†’ Shot 1: 30ç§’ â†’ ... â†’ Shot 6: 30ç§’
  æ€»è®¡ï¼š7 Ã— 30 = 210ç§’ â‰ˆ 3.5åˆ†é’Ÿ

ä½¿ç”¨å¹¶å‘ï¼š
  Shot 0: 30ç§’
  â†“ (Shot 0å®Œæˆåï¼Œå…¶ä»–åŒæ—¶å¼€å§‹)
  Shot 1, 3, 5: å¹¶å‘æ‰§è¡Œï¼Œ30ç§’
  Shot 2, 4, 6: ä¾èµ–å‰é¢ï¼Œé™†ç»­å®Œæˆ
  æ€»è®¡ï¼šçº¦60-90ç§’ â‰ˆ 1-1.5åˆ†é’Ÿ

æ•ˆç‡æå‡ï¼š2-3å€
```

### å¹¶å‘å±‚çº§

```
Level 1: Cameraçº§å¹¶å‘
  æ‰€æœ‰CameraåŒæ—¶å¼€å§‹ï¼ˆé™¤äº†ç­‰å¾…Shot 0ï¼‰

Level 2: Cameraå†…éƒ¨ä»»åŠ¡å¹¶å‘
  åŒä¸€Cameraçš„ä¸åŒé•œå¤´å¸§å¯ä»¥å¹¶å‘ç”Ÿæˆ
  ä½†æœ‰ä¼˜å…ˆçº§æœºåˆ¶ï¼ˆpriority_shot_idxsï¼‰

Level 3: å•ä¸ªä»»åŠ¡å†…éƒ¨çš„å­ä»»åŠ¡å¹¶å‘
  â€¢ Transition videoç”Ÿæˆ
  â€¢ First_frameç”Ÿæˆ
  è¿™ä¸¤ä¸ªä»»åŠ¡å¯ä»¥åŒæ—¶è¿›è¡Œï¼ˆå¦‚æœæ¡ä»¶å…è®¸ï¼‰
```

### ä¾èµ–å…³ç³»å¤„ç†

ä½¿ç”¨**Event æœºåˆ¶**åŒæ­¥ï¼š

```python
# åˆå§‹åŒ–äº‹ä»¶
frame_events = {
    shot_idx: {
        "first_frame": asyncio.Event(),
        "last_frame": asyncio.Event()
    }
    for shot_idx in range(len(shot_descriptions))
}

# ç”Ÿæˆå®Œæˆåè®¾ç½®äº‹ä»¶
await generate_first_frame(...)
frame_events[shot_idx]["first_frame"].set()

# å…¶ä»–ä»»åŠ¡ç­‰å¾…
await frame_events[parent_shot_idx]["first_frame"].wait()
```

### å¹¶å‘æ‰§è¡Œç¤ºä¾‹

ä»¥ä½ çš„ 7 ä¸ªé•œå¤´ä¸ºä¾‹ï¼š

```
æ—¶é—´è½´ï¼ˆå¹¶å‘ï¼‰ï¼š

T0 (0s):
  ğŸ“¹ Shot 0: å¼€å§‹ç”Ÿæˆfirst_frame

T1 (30s):
  âœ… Shot 0: first_frameå®Œæˆ
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ“¹ Shot 1: å¼€å§‹ç”Ÿæˆtransition video
  ğŸ“¹ Shot 1: å¼€å§‹ç”Ÿæˆfirst_frame
  ğŸ“¹ Shot 2: ç­‰å¾…Shot 1...
  ğŸ“¹ Shot 3: å¼€å§‹ç”Ÿæˆtransition video
  ğŸ“¹ Shot 3: å¼€å§‹ç”Ÿæˆfirst_frame
  ğŸ“¹ Shot 4: ç­‰å¾…Shot 3...
  ğŸ“¹ Shot 5: å¼€å§‹ç”Ÿæˆfirst_frameï¼ˆç›´æ¥ç”Ÿæˆï¼Œæ²¡æœ‰transitionï¼‰
  ğŸ“¹ Shot 6: ç­‰å¾…Shot 5...

T2 (45s):
  âœ… Shot 3: transition videoå®Œæˆï¼ˆå¿«ï¼ï¼‰
  â³ Shot 1: transition videoè¿˜åœ¨ç”Ÿæˆ...
  â³ Shot 3: first_frameè¿˜åœ¨ç”Ÿæˆ...
  â³ Shot 5: first_frameè¿˜åœ¨ç”Ÿæˆ...

T3 (60s):
  âœ… Shot 1: transition videoå®Œæˆ
  âœ… Shot 5: first_frameå®Œæˆ
  â³ Shot 1: first_frameè¿˜åœ¨ç”Ÿæˆ...
  â³ Shot 3: first_frameè¿˜åœ¨ç”Ÿæˆ...
  ğŸ“¹ Shot 6: å¯ä»¥å¼€å§‹äº†ï¼ˆShot 5å®Œæˆï¼‰

T4 (90s):
  âœ… æ‰€æœ‰first_frameså®Œæˆ
  ğŸ“¹ å¼€å§‹ç”Ÿæˆæœ€ç»ˆvideos
```

**å…³é”®ç‚¹ï¼š**

- ä»»åŠ¡åŒæ—¶å¯åŠ¨ï¼Œä½†å®Œæˆæ—¶é—´ä¸åŒ
- å“ªä¸ªå…ˆå®Œæˆå–å†³äºï¼šAPI é€Ÿåº¦ã€ä»»åŠ¡å¤æ‚åº¦ã€ç½‘ç»œå»¶è¿Ÿ
- Shot 3 çš„ transition video å¯èƒ½æ¯” Shot 1 å…ˆå®Œæˆï¼ˆæ­£å¸¸ç°è±¡ï¼‰

---

## Transition Video è¯¦è§£

### ä»€ä¹ˆæ˜¯ Transition Videoï¼Ÿ

Transition Video æ˜¯ä¸€ä¸ª**è¾…åŠ©å·¥å…·è§†é¢‘**ï¼Œç”¨äºæå–å­é•œå¤´çš„æ„å›¾å‚è€ƒå¸§ã€‚

**é‡è¦ç†è§£ï¼š**

- âŒ ä¸æ˜¯æœ€ç»ˆæˆå“
- âŒ ä¸ä¼šå‡ºç°åœ¨ Timeline ä¸­
- âœ… åªæ˜¯ç”Ÿæˆ first_frame çš„"è„šæ‰‹æ¶"

### ä¸ºä»€ä¹ˆéœ€è¦ Transition Videoï¼Ÿ

```
é—®é¢˜ï¼šå­é•œå¤´éœ€è¦ä»€ä¹ˆï¼Ÿ

ä»¥Shot 3ï¼ˆé™ˆé»˜èµ°å‘æŠ¤æ ä¸­æ™¯ï¼‰ä¸ºä¾‹ï¼š
  éœ€è¦ï¼š
    1. æ­£ç¡®çš„æ„å›¾ï¼ˆé™ˆé»˜åœ¨ç”»é¢å“ªé‡Œï¼ŸæŠ¤æ åœ¨å“ªé‡Œï¼Ÿï¼‰
    2. ä¸€è‡´çš„èƒŒæ™¯ï¼ˆå¤©å°çš„æ ·å­ï¼‰
    3. æ¸…æ™°çš„è§’è‰²ï¼ˆé™ˆé»˜çš„è„¸ï¼‰

å¦‚æœåªç”¨è§’è‰²è‚–åƒï¼š
  âŒ AIä¸çŸ¥é“æ„å›¾ï¼ˆé™ˆé»˜åº”è¯¥åœ¨ç”»é¢å·¦ä¾§è¿˜æ˜¯å³ä¾§ï¼Ÿï¼‰
  âŒ AIä¸çŸ¥é“èƒŒæ™¯ï¼ˆæŠ¤æ é•¿ä»€ä¹ˆæ ·ï¼Ÿå¤©å°ç¯å¢ƒå¦‚ä½•ï¼Ÿï¼‰
  âœ… AIçŸ¥é“è§’è‰²ï¼ˆé™ˆé»˜çš„è„¸ï¼‰

å¦‚æœç”¨Transition Videoï¼š
  1. ä»Shot 0å…¨æ™¯è¿‡æ¸¡åˆ°Shot 3ä¸­æ™¯
  2. AIç”Ÿæˆçš„è§†é¢‘åŒ…å«æ­£ç¡®çš„æ„å›¾å’ŒèƒŒæ™¯
  3. æå–Scene-002çš„é¦–å¸§ä½œä¸ºå‚è€ƒ
  4. å†ç”¨è§’è‰²è‚–åƒæ›¿æ¢é¢éƒ¨ç»†èŠ‚
  âœ… æ„å›¾æ­£ç¡® + èƒŒæ™¯ä¸€è‡´ + é¢éƒ¨æ¸…æ™°
```

### Transition Video çš„å†…å®¹

```
transition_video_from_shot_0.mp4:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0-2.5s: Shot 0çš„å†…å®¹ï¼ˆçˆ¶é•œå¤´ï¼‰           â”‚
â”‚         AIé‡ç°çˆ¶é•œå¤´çš„æ ·å­               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         âš¡ åˆ‡é•œå¤´                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2.5-5s: Shot 3çš„å†…å®¹ï¼ˆå­é•œå¤´ï¼‰           â”‚
â”‚         AIæƒ³è±¡çš„å­é•œå¤´æ ·å­               â”‚
â”‚         æ„å›¾âœ… èƒŒæ™¯âœ… ä½†ç»†èŠ‚å¯èƒ½ä¸å¯¹âš ï¸    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        åœºæ™¯æ£€æµ‹åˆ‡åˆ†
              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                     â”‚
Scene-001          Scene-002
(Shot 0éƒ¨åˆ†)       (Shot 3éƒ¨åˆ†)
   ä¸¢å¼ƒ               â†“
                 æå–ç¬¬0å¸§
                      â†“
              new_camera_3.png
           ï¼ˆæ„å›¾+èƒŒæ™¯å‚è€ƒå¸§ï¼‰
```

### Transition Video çš„ç”Ÿæˆæ¡ä»¶

ä¸æ˜¯æ‰€æœ‰é•œå¤´éƒ½éœ€è¦ Transition Videoï¼š

```python
if camera.parent_shot_idx is not None:
    # æœ‰çˆ¶é•œå¤´ï¼Œç”Ÿæˆtransition video
    generate_transition_video(...)
```

æ ¹æ® camera_tree.jsonï¼š

| Shot   | æ˜¯å¦ç”Ÿæˆ Transition Video | åŸå›                 |
| ------ | ------------------------- | ------------------- |
| Shot 0 | âŒ ä¸éœ€è¦                 | æ ¹é•œå¤´ï¼Œæ²¡æœ‰ parent |
| Shot 1 | âœ… éœ€è¦                   | parent æ˜¯ Shot 0    |
| Shot 2 | âœ… éœ€è¦                   | parent æ˜¯ Shot 1    |
| Shot 3 | âœ… éœ€è¦                   | parent æ˜¯ Shot 0    |
| Shot 4 | âœ… éœ€è¦                   | parent æ˜¯ Shot 3    |
| Shot 5 | âœ… éœ€è¦                   | parent æ˜¯ Shot 0    |
| Shot 6 | âœ… éœ€è¦                   | parent æ˜¯ Shot 5    |

**ç»Ÿè®¡ï¼š**

- N ä¸ªé•œå¤´ â†’ æœ€å¤šç”Ÿæˆ (N-1) ä¸ª Transition Videos
- ä½ çš„ä¾‹å­ï¼š7 ä¸ªé•œå¤´ â†’ 6 ä¸ª Transition Videos

### Transition Video vs æœ€ç»ˆ Video

| ç‰¹æ€§     | Transition Video             | æœ€ç»ˆ Video (video.mp4)     |
| -------- | ---------------------------- | -------------------------- |
| **å†…å®¹** | åŒ…å«ä¸¤ä¸ªé•œå¤´ï¼ˆçˆ¶+å­ï¼‰        | åªåŒ…å«å½“å‰é•œå¤´             |
| **è¾“å…¥** | çˆ¶é•œå¤´å›¾ç‰‡+ä¸¤ä¸ªæè¿°          | é¦–å¸§+è¿åŠ¨æè¿°+æœ«å¸§         |
| **é•¿åº¦** | å›ºå®š 5 ç§’å·¦å³                | æ ¹æ® duration_sec_estimate |
| **è´¨é‡** | ç”¨äºæå–å‚è€ƒå¸§ï¼Œè´¨é‡è¦æ±‚è¾ƒä½ | æœ€ç»ˆæˆå“ï¼Œè´¨é‡è¦æ±‚é«˜       |
| **ä¿ç•™** | å¯ä»¥åˆ é™¤ï¼ˆè¾…åŠ©äº§ç‰©ï¼‰         | å¿…é¡»ä¿ç•™ï¼ˆç”¨äºå‰ªè¾‘ï¼‰       |
| **æˆæœ¬** | 1 æ¬¡ API è°ƒç”¨                | 1 æ¬¡ API è°ƒç”¨              |

---

## Camera æ ‘ä¸ Timeline çš„åŒºåˆ«

è¿™æ˜¯ç†è§£æ•´ä¸ªæµç¨‹çš„å…³é”®ï¼

### Camera æ ‘ï¼šç©ºé—´åŒ…å«å…³ç³»

```
è¡¨è¾¾çš„æ˜¯ï¼š"è°çš„è§†é‡åŒ…å«è°"

Camera 0 (å¤©å°å…¨æ™¯)
    â”œâ”€â”€ Camera 1 (å°¸ä½“è½®å»“åŒºåŸŸ - ä¸­æ™¯)
    â”‚       â””â”€â”€ Camera 2 (é‹å­ - ç‰¹å†™)
    â”œâ”€â”€ Camera 3 (æŠ¤æ åŒºåŸŸ - ä¸­æ™¯)
    â”‚       â””â”€â”€ Camera 4 (æŠ¤æ ç¼ºå£ - ç‰¹å†™)
    â””â”€â”€ Camera 5 (é™ˆé»˜å’Œè­¦å‘˜åŒºåŸŸ - ä¸­è¿œæ™¯)
            â””â”€â”€ Camera 6 (é™ˆé»˜è„¸éƒ¨ - è¿‘æ™¯)

ç†è§£ï¼š
  â€¢ Camera 0çš„å…¨æ™¯èƒ½çœ‹åˆ°æ•´ä¸ªå¤©å°
  â€¢ Camera 1åªèƒ½çœ‹åˆ°å°¸ä½“è½®å»“é™„è¿‘
  â€¢ Camera 3åªèƒ½çœ‹åˆ°æŠ¤æ é™„è¿‘
  â€¢ Camera 1å’ŒCamera 3æ˜¯å¹³è¡Œå…³ç³»ï¼Œä¸æ˜¯å‰åå…³ç³»
```

### Timelineï¼šæ—¶é—´æ’­æ”¾é¡ºåº

```
è¡¨è¾¾çš„æ˜¯ï¼š"è§‚ä¼—æŒ‰ä»€ä¹ˆé¡ºåºçœ‹"

Shot 0 (å¤©å°å…¨æ™¯)
  â†“
Shot 1 (é™ˆé»˜æ£€æŸ¥å°¸ä½“ - ä¸­æ™¯)
  â†“
Shot 2 (é‹å­åˆ®ç—• - ç‰¹å†™)
  â†“
Shot 3 (é™ˆé»˜èµ°å‘æŠ¤æ  - ä¸­æ™¯)
  â†“
Shot 4 (æŠ¤æ ç¼ºå£ - ç‰¹å†™)
  â†“
Shot 5 (è­¦å‘˜èµ°è¿‘é™ˆé»˜ - ä¸­è¿œæ™¯)
  â†“
Shot 6 (é™ˆé»˜ååº” - è¿‘æ™¯)

ç†è§£ï¼š
  â€¢ è¿™æ˜¯æ•…äº‹æ¨è¿›çš„é¡ºåº
  â€¢ Shot 2 â†’ Shot 3ï¼šæ—¶é—´ä¸Šè¿ç»­
  â€¢ ä½†ç©ºé—´ä¸Šï¼ŒShot 2åœ¨å°¸ä½“åŒºåŸŸï¼ŒShot 3åœ¨æŠ¤æ åŒºåŸŸ
```

### å…³é”®ç†è§£ï¼šä¸¤ä¸ªç»´åº¦

| ç»´åº¦          | ç”¨é€”     | å†³å®šä»€ä¹ˆ                      |
| ------------- | -------- | ----------------------------- |
| **Camera æ ‘** | ç”Ÿæˆå‚è€ƒ | Shot 3 ä» Shot 0 è·å–æ„å›¾å‚è€ƒ |
| **Timeline**  | æ•…äº‹å™è¿° | Shot 3 åœ¨ Shot 2 ä¹‹åæ’­æ”¾     |

**å®ä¾‹è¯´æ˜ï¼š**

```
Shot 3çš„parent_shot_idx = 0

è¿™ä¸æ˜¯è¯´"Shot 3åœ¨Shot 0ä¹‹åæ’­æ”¾"
è€Œæ˜¯è¯´"Shot 3çš„æ„å›¾å‚è€ƒæ¥è‡ªShot 0"

å› ä¸ºï¼š
  â€¢ Shot 0çš„å…¨æ™¯åŒ…å«æŠ¤æ åŒºåŸŸ
  â€¢ Shot 3æ˜¯æŠ¤æ åŒºåŸŸçš„ä¸­æ™¯
  â€¢ ä»Shot 0å¯ä»¥"æ¨è¿›"åˆ°Shot 3

è™½ç„¶å®é™…æ’­æ”¾æ—¶ï¼š
  Shot 2 â†’ Shot 3 (æ—¶é—´é¡ºåº)

ä½†æ„å›¾å‚è€ƒæ˜¯ï¼š
  Shot 0 â†’ Shot 3 (ç©ºé—´å…³ç³»)
```

### ä¸ºä»€ä¹ˆ Shot 3 ä¸ä» Shot 2 è¿‡æ¸¡ï¼Ÿ

```
Shot 2: é‹å­åˆ®ç—•ç‰¹å†™
  è§†é‡ï¼šåªèƒ½çœ‹åˆ°é‹åº•ï¼Œæçª„

Shot 3: é™ˆé»˜èµ°å‘æŠ¤æ ä¸­æ™¯
  éœ€è¦ï¼šçœ‹åˆ°æŠ¤æ ä½ç½®ã€å¤©å°èƒŒæ™¯

é—®é¢˜ï¼š
  Shot 2çš„ç‰¹å†™é‡Œæ ¹æœ¬çœ‹ä¸åˆ°æŠ¤æ ï¼
  ä»"é‹å­ç‰¹å†™"æ€ä¹ˆçŸ¥é“æŠ¤æ åœ¨å“ªï¼Ÿ

è§£å†³æ–¹æ¡ˆï¼š
  Shot 3ä»Shot 0ï¼ˆå…¨æ™¯ï¼‰è·å–å‚è€ƒ
  å› ä¸ºShot 0èƒ½çœ‹åˆ°æ•´ä¸ªå¤©å°ï¼ŒåŒ…æ‹¬æŠ¤æ 

ç»“æœï¼š
  â€¢ Transition video: Shot 0 â†’ Shot 3 (ç©ºé—´å‚è€ƒ)
  â€¢ Timelineæ’­æ”¾: Shot 2 â†’ Shot 3 (æ—¶é—´é¡ºåº)
  â€¢ ä¸¤è€…ä¸å†²çªï¼
```

### è§†è§‰è¿è´¯æ€§å¤„ç†

**é—®é¢˜ï¼š** Shot 2ï¼ˆé‹å­ç‰¹å†™ï¼‰â†’ Shot 3ï¼ˆèµ°å‘æŠ¤æ ä¸­æ™¯ï¼‰ä¼šä¸ä¼šå‰²è£‚ï¼Ÿ

**ç­”æ¡ˆï¼š** ä¸ä¼šï¼Œå› ä¸º Shot 3 çš„è®¾è®¡å·²ç»è€ƒè™‘äº†è¡”æ¥ï¼š

```
Shot 3çš„ff_descï¼ˆé¦–å¸§ï¼‰ï¼š
  "é™ˆé»˜ã€è¹²ç€ã€‘ï¼Œä½å¤´çœ‹è„šä¸‹çš„é‹å­..."
  â†’ æ‰¿æ¥Shot 2çš„"çœ‹é‹å­"åŠ¨ä½œ

Shot 3çš„motion_descï¼ˆè¿åŠ¨ï¼‰ï¼š
  "è§†çº¿ä»é‹å­æŠ¬èµ· â†’ ç«™èµ·èº« â†’ èµ°å‘æŠ¤æ  â†’ è§¦æ‘¸æŠ¤æ "
  â†’ åŒ…å«äº†ä»"é‹å­"åˆ°"æŠ¤æ "çš„å®Œæ•´è¿‡æ¸¡

Shot 3çš„lf_descï¼ˆæœ«å¸§ï¼‰ï¼š
  "é™ˆé»˜ç«™åœ¨æŠ¤æ è¾¹ï¼Œè§¦æ‘¸æŠ¤æ ..."
  â†’ å®Œæˆç©ºé—´è½¬æ¢
```

**è¿™æ˜¯ç»å…¸çš„"åŠ¨ä½œåˆ‡"ï¼ˆAction Cutï¼‰æŠ€å·§ï¼š**

- Shot 2 ç»“æŸï¼šçœ‹åˆ°é‹å­ç»†èŠ‚
- Shot 3 å¼€å§‹ï¼šæ­ç¤º"è°åœ¨çœ‹"ï¼ˆé™ˆé»˜è¹²ç€ï¼‰
- Shot 3 è¿‡ç¨‹ï¼šé™ˆé»˜ç«™èµ· â†’ èµ°åˆ°æŠ¤æ 
- Shot 3 ç»“æŸï¼šåˆ°è¾¾æ–°ä½ç½®ï¼ˆæŠ¤æ è¾¹ï¼‰

**è§‚ä¼—ä½“éªŒï¼š**

```
Shot 2: "è¿™æ˜¯ä¸€åŒæ˜‚è´µçš®é‹çš„åˆ®ç—•"
  â†“ [åˆ‡é•œå¤´]
Shot 3å¼€å§‹: "å“¦ï¼ŒåŸæ¥æ˜¯é™ˆé»˜åœ¨æ£€æŸ¥è¿™åŒé‹"
Shot 3ä¸­æ®µ: "ç°åœ¨ä»–è¦å»çœ‹åˆ«çš„ä¸œè¥¿äº†"
Shot 3ç»“å°¾: "ä»–å‘ç°äº†æŠ¤æ ä¸Šçš„çº¿ç´¢"
```

---

## å®ä¾‹åˆ†æ

ä»¥ä½ çš„ä¾¦æ¢æ‚¬ç–‘ç‰‡ä¸ºä¾‹ï¼Œå®Œæ•´èµ°ä¸€éæµç¨‹ã€‚

### åœºæ™¯è®¾å®š

**åœºæ™¯ï¼š** å¤©å°å‡¶æ¡ˆç°åœº  
**æ€»é•œå¤´æ•°ï¼š** 7 ä¸ª  
**ä¸»è¦è§’è‰²ï¼š** é™ˆé»˜ï¼ˆä¾¦æ¢ï¼‰ã€å¼ æ˜è¿œï¼ˆå—å®³è€…ï¼‰ã€å¹´è½»è­¦å‘˜

### Camera æ ‘ç»“æ„

```json
[
  {
    "idx": 0,
    "active_shot_idxs": [0],
    "parent_cam_idx": null,
    "parent_shot_idx": null,
    "reason": null
  },
  {
    "idx": 1,
    "active_shot_idxs": [1],
    "parent_cam_idx": 0,
    "parent_shot_idx": 0,
    "reason": "çˆ¶é•œå¤´çš„å…¨æ™¯è§†é‡è¦†ç›–äº†å­é•œå¤´çš„ä¸­æ™¯",
    "is_parent_fully_covers_child": true
  },
  {
    "idx": 2,
    "active_shot_idxs": [2],
    "parent_cam_idx": 1,
    "parent_shot_idx": 1,
    "reason": "ä»ä¸­æ™¯åˆ‡å…¥åˆ°ç‰¹å†™",
    "is_parent_fully_covers_child": false,
    "missing_info": "Large change detected (size_gap=3, focal_ratio~2.0)"
  },
  {
    "idx": 3,
    "active_shot_idxs": [3],
    "parent_cam_idx": 0,
    "parent_shot_idx": 0,
    "reason": "å…¨æ™¯è§†é‡åŒ…å«äº†æŠ¤æ åŒºåŸŸ",
    "is_parent_fully_covers_child": true
  },
  {
    "idx": 4,
    "active_shot_idxs": [4],
    "parent_cam_idx": 3,
    "parent_shot_idx": 3,
    "reason": "ä¸­æ™¯åˆ°ç‰¹å†™çš„åˆ‡å…¥",
    "is_parent_fully_covers_child": false,
    "missing_info": "Large change detected (size_gap=3, focal_ratio~2.9)"
  },
  {
    "idx": 5,
    "active_shot_idxs": [5],
    "parent_cam_idx": 0,
    "parent_shot_idx": 0,
    "reason": "å…¨æ™¯è¦†ç›–äº†å¯¹è¯åŒºåŸŸ",
    "is_parent_fully_covers_child": true
  },
  {
    "idx": 6,
    "active_shot_idxs": [6],
    "parent_cam_idx": 5,
    "parent_shot_idx": 5,
    "reason": "ä»ä¸­è¿œæ™¯åˆ°è¿‘æ™¯ç‰¹å†™",
    "is_parent_fully_covers_child": false,
    "missing_info": "Large change detected (size_gap=3, focal_ratio~1.7)"
  }
]
```

### æ—¶é—´çº¿æ‰§è¡Œ

```
T0 (14:32:00):
  ğŸ“¹ Shot 0å¼€å§‹ç”Ÿæˆfirst_frame

T1 (14:32:30):
  âœ… Shot 0çš„first_frame.pngå®Œæˆ
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æ‰€æœ‰å…¶ä»–CameraåŒæ—¶å¼€å§‹ï¼š

  ğŸ“¹ Camera 1 (Shot 1):
     â”œâ”€ ç”Ÿæˆtransition_video_from_shot_0.mp4
     â””â”€ ç”Ÿæˆfirst_frame.png

  ğŸ“¹ Camera 2 (Shot 2):
     â””â”€ ç­‰å¾…Shot 1å®Œæˆ...

  ğŸ“¹ Camera 3 (Shot 3):
     â”œâ”€ ç”Ÿæˆtransition_video_from_shot_0.mp4
     â””â”€ ç”Ÿæˆfirst_frame.png

  ğŸ“¹ Camera 4 (Shot 4):
     â””â”€ ç­‰å¾…Shot 3å®Œæˆ...

  ğŸ“¹ Camera 5 (Shot 5):
     â””â”€ ç”Ÿæˆfirst_frame.pngï¼ˆæ— transition videoï¼‰

  ğŸ“¹ Camera 6 (Shot 6):
     â””â”€ ç­‰å¾…Shot 5å®Œæˆ...

T2 (14:32:45):
  âœ… Shot 3çš„transition_video_from_shot_0.mp4å®Œæˆï¼ˆå¿«ï¼ï¼‰
  â³ Shot 1çš„transition videoè¿˜åœ¨ç”Ÿæˆ...
  â³ Shot 3çš„first_frameè¿˜åœ¨ç”Ÿæˆ...
  â³ Shot 5çš„first_frameè¿˜åœ¨ç”Ÿæˆ...

T3 (14:33:00):
  âœ… Shot 1çš„transition videoå®Œæˆ
  âœ… Shot 5çš„first_frameå®Œæˆ
  ğŸ“¹ Shot 6å¯ä»¥å¼€å§‹äº†

T4 (14:33:30):
  âœ… æ‰€æœ‰first_frameså®Œæˆ
  ğŸ“¹ å¼€å§‹ç”Ÿæˆæœ€ç»ˆvideos

T5 (14:35:00):
  âœ… æ‰€æœ‰videoså®Œæˆ
  ğŸ¬ Timelineå‰ªè¾‘
```

### æ–‡ä»¶ç»“æ„

```
scene_0/
â”œâ”€â”€ camera_tree.json
â”œâ”€â”€ storyboard.json
â”œâ”€â”€ continuity_report.json
â””â”€â”€ shots/
    â”œâ”€â”€ 0/
    â”‚   â”œâ”€â”€ first_frame.png               âœ… å¤©å°å…¨æ™¯
    â”‚   â”œâ”€â”€ first_frame_selector_output.json
    â”‚   â”œâ”€â”€ shot_description.json
    â”‚   â””â”€â”€ video.mp4                     âœ… æœ€ç»ˆæˆå“
    â”‚
    â”œâ”€â”€ 1/
    â”‚   â”œâ”€â”€ transition_video_from_shot_0.mp4  âœ… è¾…åŠ©å·¥å…·
    â”‚   â”œâ”€â”€ cache/
    â”‚   â”‚   â”œâ”€â”€ ...-Scene-001.mp4
    â”‚   â”‚   â””â”€â”€ ...-Scene-002.mp4
    â”‚   â”œâ”€â”€ new_camera_1.png              âœ… æå–çš„å‚è€ƒå¸§
    â”‚   â”œâ”€â”€ first_frame.png               âœ… æœ€ç»ˆé¦–å¸§
    â”‚   â”œâ”€â”€ first_frame_selector_output.json
    â”‚   â”œâ”€â”€ shot_description.json
    â”‚   â””â”€â”€ video.mp4                     âœ… æœ€ç»ˆæˆå“
    â”‚
    â”œâ”€â”€ 2/
    â”‚   â”œâ”€â”€ transition_video_from_shot_1.mp4
    â”‚   â”œâ”€â”€ cache/...
    â”‚   â”œâ”€â”€ new_camera_2.png
    â”‚   â”œâ”€â”€ first_frame.png
    â”‚   â”œâ”€â”€ shot_description.json
    â”‚   â””â”€â”€ video.mp4
    â”‚
    â”œâ”€â”€ 3/
    â”‚   â”œâ”€â”€ transition_video_from_shot_0.mp4  âœ… å·²å®Œæˆï¼ˆæœ€å¿«ï¼‰
    â”‚   â”œâ”€â”€ first_frame.png                   â³ è¿˜åœ¨ç”Ÿæˆ
    â”‚   â”œâ”€â”€ shot_description.json
    â”‚   â””â”€â”€ video.mp4                         â³ ç­‰å¾…ç”Ÿæˆ
    â”‚
    â”œâ”€â”€ 4/
    â”œâ”€â”€ 5/
    â””â”€â”€ 6/

æœ€ç»ˆTimelineåªç”¨ï¼š
  shots/0/video.mp4
  shots/1/video.mp4
  shots/2/video.mp4
  shots/3/video.mp4
  shots/4/video.mp4
  shots/5/video.mp4
  shots/6/video.mp4

æ‰€æœ‰transition videoséƒ½æ˜¯è¾…åŠ©äº§ç‰©ï¼Œä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆç‰‡å­é‡Œï¼
```

### æˆæœ¬åˆ†æ

```
æ€»é•œå¤´æ•°ï¼š7ä¸ª

Transition Videosï¼š6ä¸ªï¼ˆé™¤äº†Shot 0ï¼‰
æœ€ç»ˆVideosï¼š7ä¸ª
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡APIè°ƒç”¨ï¼š13æ¬¡ï¼ˆå‡è®¾ä¸ç®—å€™é€‰å¸§ï¼‰

å¦‚æœç¦ç”¨Transition Videoï¼š
  åªéœ€è¦7æ¬¡APIè°ƒç”¨
  ä½†å¯èƒ½ç‰ºç‰²æ„å›¾ä¸€è‡´æ€§

æˆæœ¬å¢åŠ ï¼š13/7 â‰ˆ 1.86å€
æ¢æ¥ï¼šæ›´å¥½çš„ç©ºé—´ä¸€è‡´æ€§å’Œæ„å›¾å‡†ç¡®æ€§
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ Shot 3 çš„ transition video æ¯” Shot 1 å…ˆå®Œæˆï¼Ÿ

**A:** è¿™æ˜¯æ­£å¸¸çš„å¹¶å‘ç°è±¡ã€‚

- æ‰€æœ‰ä»»åŠ¡åŒæ—¶å¯åŠ¨
- å®Œæˆæ—¶é—´å–å†³äºï¼šAPI å“åº”é€Ÿåº¦ã€å†…å®¹å¤æ‚åº¦ã€ç½‘ç»œå»¶è¿Ÿ
- Shot 3 å¯èƒ½ç¢°å·§ API è¿”å›æ›´å¿«ï¼Œæˆ–å†…å®¹æ›´ç®€å•

**ç±»æ¯”ï¼š** 7 ä¸ªäººåŒæ—¶ç‚¹å¤–å–ï¼Œä¸ä¸€å®šæŒ‰é¡ºåºé€è¾¾ã€‚

### Q2: Shot 3 çš„ first_frame ä¸ºä»€ä¹ˆè¿˜æ²¡ç”Ÿæˆï¼Œtransition video å´å®Œæˆäº†ï¼Ÿ

**A:** å®ƒä»¬æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å¹¶å‘ä»»åŠ¡ã€‚

```
Shot 3çš„ä»»åŠ¡ï¼š
  â”œâ”€ ä»»åŠ¡Aï¼šç”Ÿæˆtransition video â†’ âœ… å·²å®Œæˆ
  â””â”€ ä»»åŠ¡Bï¼šç”Ÿæˆfirst_frame â†’ â³ è¿˜åœ¨è¿›è¡Œ

ä¸¤ä¸ªä»»åŠ¡åŒæ—¶å¼€å§‹ï¼Œä½†å®Œæˆæ—¶é—´ä¸åŒã€‚
```

### Q3: Transition video åŒ…å«ä¸¤ä¸ªé•œå¤´ï¼Œä¼šä¸ä¼šç”¨é”™ï¼Ÿ

**A:** ä¸ä¼šï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡åˆ†ã€‚

```
1. ContentDetectoræ£€æµ‹åˆ‡é•œå¤´ä½ç½®
2. åˆ‡åˆ†æˆScene-001ï¼ˆçˆ¶é•œå¤´ï¼‰å’ŒScene-002ï¼ˆå­é•œå¤´ï¼‰
3. åªæå–Scene-002çš„é¦–å¸§ä½œä¸ºå‚è€ƒ
4. å¦‚æœåˆ‡åˆ†å¤±è´¥ï¼Œåˆ™ä½¿ç”¨æ•´æ®µè§†é¢‘çš„æœ€åä¸€å¸§
```

### Q4: Shot 3 çš„ parent æ˜¯ Shot 0ï¼Œä½†å®é™…æ’­æ”¾æ—¶ Shot 3 åœ¨ Shot 2 åé¢ï¼Œä¼šä¸ä¼šå‰²è£‚ï¼Ÿ

**A:** ä¸ä¼šï¼Œå› ä¸ºä¸¤ä¸ªç»´åº¦ç‹¬ç«‹ã€‚

**ç©ºé—´ç»´åº¦ï¼ˆCamera æ ‘ï¼‰ï¼š**

- Shot 3 ä» Shot 0 è·å–æ„å›¾å‚è€ƒ
- å› ä¸º Shot 0 çš„å…¨æ™¯åŒ…å«æŠ¤æ åŒºåŸŸ

**æ—¶é—´ç»´åº¦ï¼ˆTimelineï¼‰ï¼š**

- Shot 2 â†’ Shot 3 çš„åˆ‡æ¢æ˜¯è‡ªç„¶çš„"åˆ‡é•œå¤´"
- Shot 3 çš„é¦–å¸§è®¾è®¡è€ƒè™‘äº†ä¸ Shot 2 çš„è¡”æ¥
- Shot 3 çš„è¿åŠ¨åŒ…å«äº†ä»"çœ‹é‹å­"åˆ°"èµ°å‘æŠ¤æ "çš„å®Œæ•´è¿‡æ¸¡

### Q5: å¯ä»¥è·³è¿‡ Transition Video å—ï¼Ÿ

**A:** å¯ä»¥ï¼Œä½†ä¼šç‰ºç‰²ä¸€äº›è´¨é‡ã€‚

**è·³è¿‡çš„åæœï¼š**

- âŒ æ„å›¾å¯èƒ½ä¸å‡†ç¡®ï¼ˆAI ä¸çŸ¥é“æŠ¤æ åœ¨å“ªï¼‰
- âŒ èƒŒæ™¯å¯èƒ½ä¸ä¸€è‡´ï¼ˆä¸å…¨æ™¯ä¸åŒ¹é…ï¼‰
- âœ… ä½†å¯ä»¥èŠ‚çœçº¦ 50%çš„è§†é¢‘ç”Ÿæˆæˆæœ¬

**ä¼˜åŒ–å»ºè®®ï¼š**

```python
# åªå¯¹æ™¯åˆ«è·¨åº¦å¤§çš„é•œå¤´ç”Ÿæˆtransition video
if missing_info is not None:  # size_gap > 2
    generate_transition_video(...)
else:
    # ç›´æ¥ç”¨çˆ¶é•œå¤´é¦–å¸§ä½œä¸ºå‚è€ƒ
    skip_transition_video()
```

### Q6: ä¸ºä»€ä¹ˆè¦å…ˆç”Ÿæˆ first_frameï¼Œå†ç”Ÿæˆ videoï¼Ÿ

**A:** å› ä¸ºéœ€è¦ç¡®ä¿å¸§çš„è´¨é‡ã€‚

**å¦‚æœç›´æ¥ç”Ÿæˆ videoï¼š**

- âŒ æ— æ³•ç²¾ç¡®æ§åˆ¶é¦–å¸§å’Œæœ«å¸§
- âŒ è§’è‰²é¢éƒ¨å¯èƒ½æ¯å¸§éƒ½ä¸ä¸€è‡´
- âŒ æ— æ³•è¿›è¡Œå¤šå€™é€‰é€‰æ‹©ï¼ˆåªèƒ½ç”Ÿæˆ 1 æ¬¡ï¼‰

**å…ˆç”Ÿæˆ frames å†ç”Ÿæˆ videoï¼š**

- âœ… å¯ä»¥å¯¹é¦–å¸§/æœ«å¸§è¿›è¡Œå¤šæ¬¡é‡‡æ ·ï¼Œé€‰æ‹©æœ€ä½³
- âœ… å¯ä»¥ç”¨ reference_image_selector ç²¾ç¡®æ§åˆ¶
- âœ… è§’è‰²é¢éƒ¨ä¸€è‡´æ€§æ›´å¥½ï¼ˆé¦–å¸§ä½œä¸ºé”šç‚¹ï¼‰
- âœ… å¯ä»¥å•ç‹¬éªŒè¯å’Œè°ƒæ•´æ¯ä¸€å¸§

### Q7: æ¯ä¸ª Shot éƒ½éœ€è¦ last_frame å—ï¼Ÿ

**A:** ä¸æ˜¯ï¼Œæ ¹æ® variation_type å†³å®šã€‚

```python
if shot.variation_type in ["medium", "large"]:
    # éœ€è¦last_frame
    # å› ä¸ºé•œå¤´å†…éƒ¨å˜åŒ–è¾ƒå¤§ï¼ˆè¿åŠ¨ã€æ™¯åˆ«å˜åŒ–ç­‰ï¼‰
    generate_last_frame()
elif shot.variation_type == "small":
    # ä¸éœ€è¦last_frame
    # é•œå¤´å†…éƒ¨å˜åŒ–å¾ˆå°ï¼ˆé™æ€æˆ–å¾®å°è¿åŠ¨ï¼‰
    # ç›´æ¥ç”¨first_frameä½œä¸ºå‚è€ƒ
    skip_last_frame()
```

**ä½ çš„ä¾‹å­ï¼š**

- Shot 2: é™æ€ç‰¹å†™ â†’ variation_type = "small" â†’ ä¸éœ€è¦ last_frame
- Shot 3: é™ˆé»˜èµ°å‘æŠ¤æ  â†’ variation_type = "small" â†’ ä¸éœ€è¦ last_frame
  ï¼ˆè™½ç„¶æœ‰è¿åŠ¨ï¼Œä½†æ™¯åˆ«å’Œæ„å›¾æ²¡æœ‰å¤§çš„å˜åŒ–ï¼‰

### Q8: ä¸ºä»€ä¹ˆä¸ç”¨å‰ä¸€ä¸ªé•œå¤´çš„æœ«å¸§ä½œä¸ºå‚è€ƒï¼Ÿ

**A:** å®é™…ä¸Šç³»ç»Ÿå·²ç»è€ƒè™‘äº†ï¼

åœ¨ç”Ÿæˆ first_frame æ—¶ï¼Œreference_image_selector ä¼šæ”¶é›†ï¼š

```python
available_images = [
    new_camera_image,  # ä»transition videoæå–
    è§’è‰²è‚–åƒä»¬,
    å‰ä¸€ä¸ªé•œå¤´çš„æœ«å¸§ï¼ˆå¦‚æœæœ‰ä¸”åŒåœºæ™¯ï¼‰,  â† è¿™é‡Œï¼
    å·²å®Œæˆçš„å…¶ä»–å¸§ï¼ˆP1ä¼˜åŒ–ï¼‰
]
```

**P1 ä¼˜åŒ–ï¼ˆç¯å¢ƒå‚è€ƒï¼‰ï¼š**

```python
if shot_idx > 0:
    prev_shot_idx = shot_idx - 1
    if åŒåœºæ™¯:
        if prev_shotæœ‰æœ«å¸§:
            ä½¿ç”¨å‰ä¸€é•œå¤´çš„æœ«å¸§
        else:
            ä½¿ç”¨å‰ä¸€é•œå¤´çš„é¦–å¸§
```

**æ‰€ä»¥å®é™…ä¸Š Shot 3 ç”Ÿæˆ first_frame æ—¶ï¼Œå‚è€ƒå›¾æ± åŒ…å«ï¼š**

1. new_camera_3.pngï¼ˆæ„å›¾å‚è€ƒï¼‰
2. é™ˆé»˜è‚–åƒä»¬ï¼ˆé¢éƒ¨å‚è€ƒï¼‰
3. Shot 2 çš„æœ«å¸§ï¼ˆç¯å¢ƒå‚è€ƒï¼Œå¦‚æœæœ‰ï¼‰

reference_image_selector ä¼šæ™ºèƒ½é€‰æ‹©æœ€ç›¸å…³çš„ 2-3 å¼ ï¼

---

## æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **ä¸¤ä¸ªç»´åº¦ç‹¬ç«‹**

   - Camera æ ‘ = ç©ºé—´åŒ…å«å…³ç³»ï¼ˆå†³å®šæ„å›¾å‚è€ƒæ¥æºï¼‰
   - Timeline = æ—¶é—´æ’­æ”¾é¡ºåºï¼ˆå†³å®šè§‚ä¼—è§‚çœ‹é¡ºåºï¼‰

2. **ä¸¤ç§è§†é¢‘æ–‡ä»¶**

   - Transition Video = è¾…åŠ©å·¥å…·ï¼ˆæå–æ„å›¾å‚è€ƒï¼‰
   - video.mp4 = æœ€ç»ˆæˆå“ï¼ˆç”¨äºå‰ªè¾‘ï¼‰

3. **ä¸‰çº§å¹¶å‘**

   - Camera çº§ï¼šæ‰€æœ‰ Camera åŒæ—¶å¼€å§‹
   - ä»»åŠ¡çº§ï¼šåŒä¸€ Camera çš„ä¸åŒä»»åŠ¡å¯å¹¶å‘
   - å­ä»»åŠ¡çº§ï¼štransition video å’Œ first_frame å¯å¹¶å‘

4. **å››ä¸ªå…³é”®æ­¥éª¤**
   - ç”Ÿæˆ transition videoï¼ˆå¦‚æœéœ€è¦ï¼‰
   - æå–å‚è€ƒå¸§ï¼ˆnew_cameraï¼‰
   - ç”Ÿæˆæœ€ç»ˆé¦–å¸§ï¼ˆfirst_frameï¼‰
   - ç”Ÿæˆæœ€ç»ˆè§†é¢‘ï¼ˆvideo.mp4ï¼‰

### è®¾è®¡å“²å­¦

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

1. **ç©ºé—´ä¸€è‡´æ€§ä¼˜å…ˆ**

   - ä½¿ç”¨ Camera æ ‘ç¡®ä¿æ‰€æœ‰å­é•œå¤´çš„æ„å›¾å’ŒèƒŒæ™¯ä¸å…¨æ™¯ä¸€è‡´
   - Transition video æä¾›å¯é çš„ç©ºé—´å‚è€ƒ

2. **æ—¶é—´çµæ´»æ€§**

   - Timeline ç‹¬ç«‹äº Camera æ ‘
   - åˆ†é•œå¸ˆå¯ä»¥è‡ªç”±è°ƒæ•´æ’­æ”¾é¡ºåº

3. **è´¨é‡å¯æ§**

   - å…ˆç”Ÿæˆå¸§ï¼Œåç”Ÿæˆè§†é¢‘
   - å¤šæ¬¡é‡‡æ ·ï¼Œé€‰æ‹©æœ€ä½³
   - reference_image_selector æ™ºèƒ½ç»„åˆå‚è€ƒå›¾

4. **æ•ˆç‡ä¼˜åŒ–**
   - ä¸‰çº§å¹¶å‘æœºåˆ¶
   - Event åŒæ­¥ç¡®ä¿ä¾èµ–æ­£ç¡®
   - åªåœ¨å¿…è¦æ—¶ç”Ÿæˆ transition video

### æœ€ä½³å®è·µ

1. **åˆ†é•œè®¾è®¡æ—¶**

   - è€ƒè™‘é•œå¤´é—´çš„è¡”æ¥ï¼ˆå¦‚ Shot 3 çš„é¦–å¸§å‘¼åº” Shot 2ï¼‰
   - ä½¿ç”¨å»ºç«‹é•œå¤´ï¼ˆShot 0ï¼‰ç¡®ç«‹ç©ºé—´

2. **è°ƒè¯•æ—¶**

   - æ£€æŸ¥ camera_tree.json äº†è§£ä¾èµ–å…³ç³»
   - æŸ¥çœ‹ transition videos éªŒè¯æ„å›¾å‚è€ƒ
   - æ£€æŸ¥ first_frame_selector_output.json äº†è§£å‚è€ƒå›¾é€‰æ‹©é€»è¾‘

3. **ä¼˜åŒ–æˆæœ¬**
   - åªå¯¹æ™¯åˆ«è·¨åº¦å¤§çš„é•œå¤´ç”Ÿæˆ transition video
   - è°ƒæ•´ n_candidatesï¼ˆå€™é€‰å¸§æ•°é‡ï¼‰
   - è€ƒè™‘ä½¿ç”¨æ›´å°çš„åˆ†è¾¨ç‡ç”Ÿæˆ transition video

---

## é™„å½•

### ç›¸å…³æ–‡æ¡£

- [ARCHITECTURE_ZH.md](./ARCHITECTURE_ZH.md) - æ•´ä½“æ¶æ„è¯´æ˜
- [SCENE_CONSISTENCY_ENHANCEMENT.md](./SCENE_CONSISTENCY_ENHANCEMENT.md) - åœºæ™¯ä¸€è‡´æ€§ä¼˜åŒ–
- [REFERENCE_IMAGE_SELECTOR_OPTIMIZATION.md](./REFERENCE_IMAGE_SELECTOR_OPTIMIZATION.md) - å‚è€ƒå›¾é€‰æ‹©å™¨ä¼˜åŒ–

### ä»£ç ä½ç½®

- Pipeline ä¸»æµç¨‹: `pipelines/script2video_pipeline.py`
- Camera æ ‘æ„å»º: `agents/camera_image_generator.py:construct_camera_tree()`
- Transition video ç”Ÿæˆ: `agents/camera_image_generator.py:generate_transition_video()`
- Reference image é€‰æ‹©: `agents/reference_image_selector.py:select_reference_images_and_generate_prompt()`
- å¸§ç”Ÿæˆ: `pipelines/script2video_pipeline.py:generate_frame_for_single_shot()`

### é…ç½®é€‰é¡¹

```yaml
# configs/script2video.yaml

# æ˜¯å¦å¯ç”¨äº¤äº’æ¨¡å¼ï¼ˆé¡ºåºç”Ÿæˆè§†é¢‘ï¼Œç­‰å¾…ç¡®è®¤ï¼‰
interactive_mode: false

# å€™é€‰å¸§æ•°é‡ï¼ˆç”¨äºå¤šæ¬¡é‡‡æ ·é€‰æ‹©æœ€ä½³ï¼‰
n_candidates: 3

# æ˜¯å¦å¯ç”¨transition videoï¼ˆå¯ä»¥å…¨å±€ç¦ç”¨ï¼‰
enable_transition_video: true

# Transition videoåªåœ¨è·¨åº¦å¤§æ—¶ç”Ÿæˆ
transition_video_threshold:
  min_size_gap: 2 # æ™¯åˆ«è·¨åº¦é˜ˆå€¼
  min_focal_ratio: 2.0 # ç„¦è·è·¨åº¦é˜ˆå€¼
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025 å¹´ 11 æœˆ 7 æ—¥  
**ä½œè€…ï¼š** ViMax Team
