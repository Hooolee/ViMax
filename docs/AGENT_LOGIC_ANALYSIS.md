# ViMax Agent é€»è¾‘åˆ†ææ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æäº† ViMax é¡¹ç›®ä¸­æ¯ä¸ª Agent çš„æ ¸å¿ƒé€»è¾‘ã€èŒè´£å’Œæ½œåœ¨ä¼˜åŒ–ç‚¹ã€‚

---

## ç›®å½•

1. [Screenwriter (ç¼–å‰§)](#1-screenwriter-ç¼–å‰§)
2. [ScenePlanner (åœºæ™¯è§„åˆ’å™¨)](#2-sceneplanner-åœºæ™¯è§„åˆ’å™¨) ğŸ†•
3. [CharacterExtractor (è§’è‰²æå–å™¨)](#3-characterextractor-è§’è‰²æå–å™¨)
4. [CharacterPortraitsGenerator (è§’è‰²è‚–åƒç”Ÿæˆå™¨)](#4-characterportraitsgenerator-è§’è‰²è‚–åƒç”Ÿæˆå™¨)
5. [StoryboardArtist (åˆ†é•œè‰ºæœ¯å®¶)](#5-storyboardartist-åˆ†é•œè‰ºæœ¯å®¶)
6. [CameraImageGenerator (é•œå¤´å›¾åƒç”Ÿæˆå™¨)](#6-cameraimagegenerator-é•œå¤´å›¾åƒç”Ÿæˆå™¨)
7. [ReferenceImageSelector (å‚è€ƒå›¾é€‰æ‹©å™¨)](#7-referenceimageselector-å‚è€ƒå›¾é€‰æ‹©å™¨)
8. [BestImageSelector (æœ€ä½³å›¾åƒé€‰æ‹©å™¨)](#8-bestimageselector-æœ€ä½³å›¾åƒé€‰æ‹©å™¨)
9. [Pipeline æµç¨‹æ¦‚è§ˆ](#9-pipeline-æµç¨‹æ¦‚è§ˆ)
10. [ä¼˜åŒ–å»ºè®®æ€»ç»“](#10-ä¼˜åŒ–å»ºè®®æ€»ç»“)

---

## 1. Screenwriter (ç¼–å‰§)

### æ ¸å¿ƒèŒè´£

å°†ç”¨æˆ·çš„åˆ›æ„æƒ³æ³•è½¬åŒ–ä¸ºå®Œæ•´çš„æ•…äº‹ï¼Œå¹¶è¿›ä¸€æ­¥æ”¹ç¼–æˆå¯æ‹æ‘„çš„å‰§æœ¬ã€‚

### ä¸»è¦æ–¹æ³•

#### `develop_story()`

- **è¾“å…¥**: idea (åˆ›æ„æ¦‚å¿µ), user_requirement (ç”¨æˆ·éœ€æ±‚)
- **è¾“å‡º**: å®Œæ•´çš„æ•…äº‹æ–‡æœ¬
- **é€»è¾‘æµç¨‹**:
  1. ä½¿ç”¨è¯¦ç»†çš„ç³»ç»Ÿæç¤ºè¯ï¼Œè¦æ±‚ç”Ÿæˆç¬¦åˆç‰¹å®šç»“æ„çš„æ•…äº‹
  2. åŒ…å«è§’è‰²ä»‹ç»ã€æ•…äº‹å¤§çº²ã€å®Œæ•´å™äº‹ç­‰è¦ç´ 
  3. æ”¯æŒç›®æ ‡å—ä¼—ã€ç±»å‹ã€é•¿åº¦ç­‰å®šåˆ¶åŒ–éœ€æ±‚

#### `write_script_based_on_story()`

- **è¾“å…¥**: story (æ•…äº‹æ–‡æœ¬), user_requirement (ç”¨æˆ·éœ€æ±‚)
- **è¾“å‡º**: List[str] - æŒ‰åœºæ™¯åˆ†å‰²çš„å‰§æœ¬åˆ—è¡¨
- **é€»è¾‘æµç¨‹**:
  1. å°†æ•…äº‹æ”¹ç¼–æˆç¬¦åˆå½±è§†åˆ¶ä½œæ ‡å‡†çš„å‰§æœ¬
  2. æŒ‰ç…§æ—¶é—´å’Œåœ°ç‚¹è¿›è¡Œåœºæ™¯åˆ’åˆ†
  3. åŒ…å«å¯¹ç™½ã€åŠ¨ä½œæè¿°ã€åœºæ™¯è®¾ç½®ç­‰å…ƒç´ 
  4. ä½¿ç”¨ Pydantic è§£æå™¨ç¡®ä¿è¾“å‡ºæ ¼å¼æ ‡å‡†åŒ–

### ä¼˜åŒ–å»ºè®®

- âœ… **å½“å‰ä¼˜åŠ¿**: æç¤ºè¯è®¾è®¡ä¸“ä¸šï¼Œè¦†ç›–äº†æ•…äº‹åˆ›ä½œçš„æ ¸å¿ƒè¦ç´ 
- ğŸ”„ **å¯ä¼˜åŒ–é¡¹**:
  - è€ƒè™‘æ·»åŠ æ•…äº‹ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆè§’è‰²è¡Œä¸ºã€æ—¶é—´çº¿é€»è¾‘ç­‰ï¼‰
  - å¯ä»¥å¢åŠ å¯¹ä¸åŒç±»å‹æ•…äº‹çš„æ¨¡æ¿æ”¯æŒï¼ˆç§‘å¹»ã€æ‚¬ç–‘ã€çˆ±æƒ…ç­‰ï¼‰
  - å‰§æœ¬ç”Ÿæˆæ—¶å¯ä»¥è€ƒè™‘åˆ¶ä½œé¢„ç®—çº¦æŸï¼ˆåœºæ™¯æ•°é‡ã€ç‰¹æ•ˆå¤æ‚åº¦ç­‰ï¼‰

---

## 2. ScenePlanner (åœºæ™¯è§„åˆ’å™¨) ğŸ†•

### æ ¸å¿ƒèŒè´£

åœ¨æ‰€æœ‰åç»­æµç¨‹ä¹‹å‰ï¼Œ**ç»Ÿä¸€åˆ†æå’Œåˆ’åˆ†å‰§æœ¬ä¸­çš„åœºæ™¯**ï¼Œä¸º CharacterExtractor å’Œ StoryboardArtist æä¾›ä¸€è‡´çš„åœºæ™¯å®šä¹‰ï¼Œç¡®ä¿ `scene_id` åœ¨æ•´ä¸ªæµç¨‹ä¸­ä¿æŒä¸€è‡´ã€‚

### ä¸»è¦æ–¹æ³•

#### `plan_scenes()`

- **è¾“å…¥**: script (å‰§æœ¬æ–‡æœ¬)
- **è¾“å‡º**: List[SceneDefinition] - åœºæ™¯å®šä¹‰åˆ—è¡¨
- **é€»è¾‘æµç¨‹**:
  1. åˆ†æå‰§æœ¬è¯†åˆ«æ‰€æœ‰ä¸åŒåœºæ™¯ï¼ˆåŸºäºåœ°ç‚¹å’Œæ—¶é—´å˜åŒ–ï¼‰
  2. ä¸ºæ¯ä¸ªåœºæ™¯ç”Ÿæˆ:
     - `scene_id`: åœºæ™¯ç´¢å¼•ï¼ˆä» 0 å¼€å§‹ï¼Œè¿ç»­é€’å¢ï¼‰
     - `location`: åœºæ™¯åœ°ç‚¹ï¼ˆå¦‚"åŠå…¬å®¤å†…éƒ¨"ã€"å…¬å›­"ï¼‰
     - `time_of_day`: æ—¶é—´æ®µï¼ˆå¦‚"æ—©æ™¨"ã€"ä¸‹åˆ"ã€"æ™šä¸Š"ï¼‰
     - `description`: åœºæ™¯ç®€çŸ­æè¿°ï¼ˆåŒ…å«ä¸»è¦äº‹ä»¶ï¼‰
     - `script_excerpt`: å¯¹åº”çš„å‰§æœ¬ç‰‡æ®µï¼ˆå¯é€‰ï¼‰
  3. **åœºæ™¯ ID éªŒè¯**: è‡ªåŠ¨æ£€æŸ¥å¹¶ä¿®å¤éè¿ç»­çš„ scene_id
  4. è¾“å‡ºè¯¦ç»†æ—¥å¿—ä¾¿äºè¿½è¸ª

### æ•°æ®ç»“æ„ç¤ºä¾‹

```python
SceneDefinition(
    scene_id=0,
    location="åŠå…¬å®¤å†…éƒ¨ / Office Interior",
    time_of_day="æ—©æ™¨ / Morning",
    description="John arrives at the office and greets colleagues",
    script_excerpt="INT. OFFICE - MORNING\n\nJohn walks in..."
)
```

### å…³é”®ç‰¹ç‚¹

- **åœºæ™¯è¾¹ç•Œè¯†åˆ«**: åŸºäºåœ°ç‚¹ï¼ˆINT/EXTï¼‰å’Œæ—¶é—´å˜åŒ–è‡ªåŠ¨åˆ’åˆ†
- **ID ä¸€è‡´æ€§ä¿è¯**: ç¡®ä¿ scene_id è¿ç»­ä¸”å”¯ä¸€
- **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒä¸­è‹±æ–‡å‰§æœ¬åˆ†æ
- **è¯¦ç»†æ—¥å¿—**: è¾“å‡ºæ¯ä¸ªåœºæ™¯çš„ä¿¡æ¯ä¾¿äºéªŒè¯

### æç¤ºè¯è®¾è®¡

ç³»ç»Ÿæç¤ºè¯åŒ…å«ï¼š

- åœºæ™¯å®šä¹‰æ ‡å‡†ï¼ˆåœ°ç‚¹å˜åŒ–ã€æ—¶é—´è·³è·ƒã€å™äº‹è½¬æŠ˜ï¼‰
- è¾“å‡ºæ ¼å¼è¦æ±‚ï¼ˆJSON ç»“æ„ï¼‰
- ç¤ºä¾‹åœºæ™¯åˆ’åˆ†ï¼ˆå•åœºæ™¯ vs å¤šåœºæ™¯ï¼‰
- è¿ç»­æ€§è¦æ±‚ï¼ˆscene_id å¿…é¡»ä» 0 å¼€å§‹è¿ç»­ï¼‰

### ä¸ºä»€ä¹ˆéœ€è¦ ScenePlannerï¼Ÿ

**é—®é¢˜èƒŒæ™¯**ï¼šåœ¨ä¹‹å‰çš„å®ç°ä¸­å­˜åœ¨ä¸¥é‡çš„é€»è¾‘é—®é¢˜ï¼š

- CharacterExtractor åœ¨æå–äººç‰©æ—¶ï¼Œä¼šæ ¹æ®å‰§æœ¬è‡ªè¡Œè¯†åˆ«åœºæ™¯
- StoryboardArtist åœ¨ç”Ÿæˆåˆ†é•œæ—¶ï¼Œä¹Ÿä¼šæ ¹æ®å‰§æœ¬è‡ªè¡Œè¯†åˆ«åœºæ™¯
- ä¸¤ä¸ª Agent å¯¹"åœºæ™¯"çš„ç†è§£å¯èƒ½ä¸ä¸€è‡´ï¼Œå¯¼è‡´ï¼š
  - äººç‰©å¤–è§‚çš„ `scene_ids` å’Œåˆ†é•œçš„ `scene_id` ä¸åŒ¹é…
  - åœ¨ç”Ÿæˆå¸§å›¾åƒæ—¶é€‰æ‹©é”™è¯¯çš„äººç‰©è‚–åƒ
  - äººç‰©æœè£…/å‘å‹ä¸ç¬¦åˆåœºæ™¯è¦æ±‚

**è§£å†³æ–¹æ¡ˆ**ï¼šé¢„å…ˆç»Ÿä¸€åœºæ™¯åˆ’åˆ†

- ScenePlanner æå‰åˆ†æå‰§æœ¬ï¼Œç”Ÿæˆæ ‡å‡†çš„åœºæ™¯åˆ—è¡¨
- æ‰€æœ‰åç»­ Agentï¼ˆCharacterExtractorã€StoryboardArtistï¼‰éƒ½ä½¿ç”¨è¿™ä¸ªç»Ÿä¸€çš„åœºæ™¯å®šä¹‰
- ç¡®ä¿æ•´ä¸ª pipeline ä¸­çš„ scene_id å®Œå…¨ä¸€è‡´

### åœ¨ Pipeline ä¸­çš„ä½ç½®

```
Script â†’ ScenePlanner.plan_scenes()
            â†“
        scenes.json
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â†“               â†“
CharacterExtractor  StoryboardArtist
(ä½¿ç”¨scenes)       (ä½¿ç”¨scenes)
    â†“               â†“
characters.json   storyboard.json
(å«scene_ids)     (å«scene_id)
```

### ä¼˜åŒ–å»ºè®®

- âœ… **å½“å‰ä¼˜åŠ¿**:
  - ç»Ÿä¸€äº†åœºæ™¯å®šä¹‰ï¼Œè§£å†³äº† scene_id ä¸ä¸€è‡´é—®é¢˜
  - è‡ªåŠ¨éªŒè¯ scene_id è¿ç»­æ€§
  - è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºä¾¿äºè°ƒè¯•
- ğŸ”„ **å¯è¿›ä¸€æ­¥ä¼˜åŒ–**:
  - å¯ä»¥æ·»åŠ åœºæ™¯æ—¶é•¿ä¼°è®¡
  - æ”¯æŒåœºæ™¯å†…çš„æ—¶é—´è·³è·ƒï¼ˆsub-sceneï¼‰
  - æ·»åŠ åœºæ™¯è½¬åœºæ•ˆæœå»ºè®®
  - å¯ä»¥åˆ†æåœºæ™¯å¤æ‚åº¦ï¼ˆç”¨äºé¢„ç®—ä¼°ç®—ï¼‰

---

## 3. CharacterExtractor (è§’è‰²æå–å™¨)

### æ ¸å¿ƒèŒè´£

ä»å‰§æœ¬ä¸­è¯†åˆ«å¹¶æå–æ‰€æœ‰ä¸»è¦è§’è‰²çš„è¯¦ç»†ä¿¡æ¯ï¼Œ**æ”¯æŒå¤šå¤–è§‚ç³»ç»Ÿ**ï¼Œèƒ½å¤Ÿè¯†åˆ«è§’è‰²åœ¨ä¸åŒåœºæ™¯çš„æœè£…ã€æƒ…ç»ªçŠ¶æ€å˜åŒ–ã€‚

### ä¸»è¦æ–¹æ³•

#### `extract_characters()`

- **è¾“å…¥**:
  - script (å‰§æœ¬æ–‡æœ¬)
  - scenes (åœºæ™¯å®šä¹‰åˆ—è¡¨ï¼Œæ¥è‡ª ScenePlanner) ğŸ†•
- **è¾“å‡º**: List[CharacterInScene] - è§’è‰²ä¿¡æ¯åˆ—è¡¨ï¼ˆåŒ…å«å¤šå¤–è§‚ï¼‰
- **é€»è¾‘æµç¨‹**:
  1. **æ¥æ”¶é¢„å®šä¹‰çš„åœºæ™¯åˆ—è¡¨**ï¼ˆç”± ScenePlanner æä¾›ï¼‰ğŸ†•
  2. åœ¨æç¤ºè¯ä¸­æä¾›åœºæ™¯ä¿¡æ¯ï¼Œç¡®ä¿ä½¿ç”¨ç»Ÿä¸€çš„ scene_id ğŸ†•
  3. åˆ†æå‰§æœ¬è¯†åˆ«æ‰€æœ‰é‡è¦è§’è‰²
  4. ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆ:
     - æ ‡è¯†ç¬¦ï¼ˆåå­—æˆ–æè¿°æ€§ç§°å‘¼ï¼‰
     - **é™æ€ç‰¹å¾**ï¼ˆå¤–è²Œã€ä½“å‹ç­‰ä¸å˜ç‰¹å¾ï¼Œè·¨åœºæ™¯ä¸€è‡´ï¼‰
     - ~~åŠ¨æ€ç‰¹å¾~~ï¼ˆå·²åºŸå¼ƒï¼Œæ”¹ç”¨ appearancesï¼‰
     - **å¤šå¥—å¤–è§‚** (appearances)ï¼šæ¯ä¸ªå¤–è§‚åŒ…å«ï¼š
       - `appearance_id`: å¤–è§‚æ ‡è¯†ï¼ˆappearance_0, appearance_1...ï¼‰
       - `scene_ids`: **è¯¥å¤–è§‚é€‚ç”¨çš„åœºæ™¯åˆ—è¡¨ï¼ˆä½¿ç”¨ ScenePlanner æä¾›çš„ scene_idï¼‰** ğŸ†•
       - `dynamic_features`: è¯¥å¤–è§‚çš„æœè£…ã€é…é¥°ç­‰å¯å˜ç‰¹å¾
       - `emotional_state`: åŸºç¡€æƒ…ç»ªçŠ¶æ€ï¼ˆneutral, tired, energetic, sad, angry, happy ç­‰ï¼‰
       - `description`: å¤–è§‚ç®€çŸ­æè¿°ï¼ˆå¦‚"å·¥ä½œè£…æŸ"ã€"è¿åŠ¨è£…æŸ"ï¼‰
  5. **æ™ºèƒ½å¤–è§‚è¯†åˆ«**:
     - è‡ªåŠ¨æ£€æµ‹è§’è‰²åœ¨ä¸åŒåœºæ™¯çš„æœè£…å˜åŒ–
     - è¯†åˆ«æ˜¾è‘—çš„æƒ…ç»ªçŠ¶æ€å˜åŒ–
     - **ä¸ºæ¯ä¸ªå¤–è§‚åˆ†é…æ­£ç¡®çš„åœºæ™¯ç´¢å¼•ï¼ˆåŸºäº ScenePlanner çš„å®šä¹‰ï¼‰** ğŸ†•
  6. åˆå¹¶åŒä¸€è§’è‰²çš„ä¸åŒç§°å‘¼
  7. å¦‚æœå‰§æœ¬ä¸­ç¼ºå°‘æè¿°ï¼Œä¼šåŸºäºä¸Šä¸‹æ–‡æ¨æ–­è§’è‰²ç‰¹å¾
  8. ä½¿ç”¨é‡è¯•æœºåˆ¶ç¡®ä¿æå–è´¨é‡

### æ•°æ®ç»“æ„ç¤ºä¾‹

```python
CharacterInScene(
    idx=0,
    identifier_in_scene="John",
    static_features="Male, 35 years old, brown hair, athletic build",
    appearances=[
        CharacterAppearance(
            appearance_id="appearance_0",
            scene_ids=[0],
            dynamic_features="Formal black suit and tie",
            emotional_state="focused",
            description="Office attire"
        ),
        CharacterAppearance(
            appearance_id="appearance_1",
            scene_ids=[1],
            dynamic_features="Gray tank top and shorts",
            emotional_state="energetic",
            description="Gym outfit"
        ),
    ]
)
```

### å…³é”®ç‰¹ç‚¹

- **è§’è‰²å»é‡**: èƒ½è¯†åˆ«åŒä¸€è§’è‰²çš„ä¸åŒç§°å‘¼æ–¹å¼
- **ç‰¹å¾è¡¥å…¨**: å½“å‰§æœ¬æè¿°ä¸å®Œæ•´æ—¶ï¼Œä¼šæ™ºèƒ½è¡¥å……è§’è‰²ç‰¹å¾
- **è§†è§‰åŒ–å¯¼å‘**: ç‰¹å¾æè¿°ä¸“æ³¨äºå¯è§†åŒ–å…ƒç´ ï¼Œä¾¿äºåç»­å›¾åƒç”Ÿæˆ
- **ğŸ†• å¤šå¤–è§‚æ”¯æŒ**: è‡ªåŠ¨è¯†åˆ«è§’è‰²åœ¨ä¸åŒåœºæ™¯çš„å¤–è§‚å˜åŒ–
- **ğŸ†• åœºæ™¯æ˜ å°„**: ä¸ºæ¯ä¸ªå¤–è§‚ç²¾ç¡®åˆ†é…é€‚ç”¨çš„åœºæ™¯èŒƒå›´
- **ğŸ†• æƒ…ç»ªè¿½è¸ª**: æ•æ‰è§’è‰²çš„åŸºç¡€æƒ…ç»ªçŠ¶æ€å˜åŒ–
- **ğŸ†• å‘åå…¼å®¹**: ä¿ç•™æ—§çš„ `dynamic_features` å­—æ®µï¼Œæ”¯æŒè‡ªåŠ¨è¿ç§»

### æç¤ºè¯ä¼˜åŒ–

ç³»ç»Ÿæç¤ºè¯å·²å…¨é¢å‡çº§ï¼ŒåŒ…å«è¯¦ç»†çš„å¤šå¤–è§‚è¯†åˆ«æŒ‡å—ï¼š

- **ä½•æ—¶åˆ›å»ºæ–°å¤–è§‚**: æœè£…æ˜¾è‘—å˜åŒ–ã€æƒ…ç»ªçŠ¶æ€æŒç»­å˜åŒ–
- **ä½•æ—¶å¤ç”¨å¤–è§‚**: æœè£…åŸºæœ¬ç›¸åŒã€ä»…æœ‰å§¿æ€æˆ–è¡¨æƒ…å˜åŒ–
- **åœºæ™¯åˆ†é…è§„åˆ™**: æ ¹æ®å‰§æœ¬ä¸­çš„åœºæ™¯æ ‡è®°ï¼ˆScene 0, Scene 1...ï¼‰åˆ†é…
- **é»˜è®¤å¤–è§‚æœºåˆ¶**: `scene_ids=[]` è¡¨ç¤ºé€‚ç”¨äºæ‰€æœ‰åœºæ™¯çš„é»˜è®¤å¤–è§‚

### ä¼˜åŒ–å»ºè®®

- âœ… **å·²å®Œæˆä¼˜åŒ–**:
  - âœ… æ”¯æŒè§’è‰²åœ¨ä¸åŒåœºæ™¯çš„æœè£…å˜åŒ–è¿½è¸ª
  - âœ… æå–è§’è‰²çš„æƒ…æ„ŸçŠ¶æ€å˜åŒ–æ—¶é—´çº¿
  - âœ… å¤šå¤–è§‚ç³»ç»Ÿå®Œå…¨é›†æˆ
- ğŸ”„ **å¯è¿›ä¸€æ­¥ä¼˜åŒ–**:
  - å¯ä»¥æ·»åŠ è§’è‰²å…³ç³»å›¾è°±ï¼ˆè°æ˜¯è°çš„æœ‹å‹/æ•Œäººç­‰ï¼‰
  - è€ƒè™‘æ›´ç»†ç²’åº¦çš„æƒ…ç»ªå¼ºåº¦ï¼ˆä¸ä»…æ˜¯ç±»å‹ï¼Œè¿˜æœ‰å¼ºåº¦å€¼ï¼‰
  - å¯ä»¥æ·»åŠ è§’è‰²åŠ¨ä½œæ¨¡å¼è¯†åˆ«ï¼ˆå¸¸è§åŠ¨ä½œã€ä¹ æƒ¯ç­‰ï¼‰

---

## 3. CharacterPortraitsGenerator (è§’è‰²è‚–åƒç”Ÿæˆå™¨)

### æ ¸å¿ƒèŒè´£

ä¸ºæ¯ä¸ªè§’è‰²çš„**æ¯ä¸ªå¤–è§‚**ç”Ÿæˆæ ‡å‡†åŒ–çš„å¤šè§’åº¦è‚–åƒï¼ˆæ­£é¢ã€ä¾§é¢ã€èƒŒé¢ï¼‰ï¼Œæ”¯æŒä¸åŒæƒ…ç»ªçŠ¶æ€çš„è¡¨æƒ…æ¸²æŸ“ï¼Œç”¨äºåç»­é•œå¤´ä¸­ä¿æŒè§’è‰²ä¸€è‡´æ€§ã€‚

### ä¸»è¦æ–¹æ³•

#### `generate_front_portrait()`

- **è¾“å…¥**:
  - character (è§’è‰²ä¿¡æ¯)
  - style (è§†è§‰é£æ ¼)
  - appearance (ç‰¹å®šå¤–è§‚ï¼Œå¯é€‰)
- **è¾“å‡º**: ImageOutput - æ­£é¢å…¨èº«è‚–åƒ
- **é€»è¾‘**:
  - åŸºäºè§’è‰²é™æ€ç‰¹å¾ + å¤–è§‚çš„åŠ¨æ€ç‰¹å¾ç”Ÿæˆæ ‡å‡†æ­£é¢è§†è§’
  - **è‡ªåŠ¨åº”ç”¨æƒ…ç»ªè¡¨æƒ…**: æ ¹æ® `appearance.emotional_state` æ˜ å°„åˆ°å…·ä½“è¡¨æƒ…æè¿°
  - æ”¯æŒ 11 ç§æƒ…ç»ªçŠ¶æ€ï¼šneutral, tired, energetic, sad, angry, happy, excited, depressed, anxious, confident, relaxed

#### `generate_side_portrait()` & `generate_back_portrait()`

- **è¾“å…¥**:
  - character
  - front_image_path (æ­£é¢è‚–åƒçš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„)
  - appearance (å¯é€‰ï¼Œç”¨äºè·å–æƒ…ç»ªçŠ¶æ€)
- **è¾“å‡º**: ImageOutput - ä¾§é¢/èƒŒé¢å…¨èº«è‚–åƒ
- **é€»è¾‘**:
  - åŸºäºå·²ç”Ÿæˆçš„æ­£é¢è‚–åƒç”Ÿæˆä¸€è‡´çš„å…¶ä»–è§†è§’
  - ä¾§é¢è§†å›¾ä¿æŒç›¸åŒçš„æƒ…ç»ªè¡¨æƒ…
  - ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿä¼ é€’å‚è€ƒå›¾

#### `generate_portraits_for_appearance()` ğŸ†•

- **è¾“å…¥**: character, appearance, style
- **è¾“å‡º**: Dict[str, ImageOutput] - åŒ…å« 'front', 'side', 'back' çš„å­—å…¸
- **é€»è¾‘**:
  1. ä¸ºç‰¹å®šå¤–è§‚ç”Ÿæˆä¸‰è§†å›¾
  2. è‡ªåŠ¨ç®¡ç†ä¸´æ—¶æ–‡ä»¶ï¼ˆfront å›¾ç‰‡ï¼‰
  3. ç¡®ä¿æ¸…ç†ä¸´æ—¶èµ„æº

#### `generate_all_appearances_for_character()` ğŸ†•

- **è¾“å…¥**: character, style
- **è¾“å‡º**: Dict[str, Dict[str, ImageOutput]] - å¤–å±‚ key æ˜¯ appearance_idï¼Œå†…å±‚æ˜¯è§†å›¾
- **é€»è¾‘**:
  - æ‰¹é‡ä¸ºè§’è‰²çš„æ‰€æœ‰å¤–è§‚ç”Ÿæˆè‚–åƒ
  - æ¯ä¸ªå¤–è§‚ç‹¬ç«‹ç”Ÿæˆä¸‰è§†å›¾
  - è¿”å›ç»“æ„åŒ–ç»“æœä¾¿äºä¿å­˜

### æƒ…ç»ªè¡¨æƒ…ç³»ç»Ÿ ğŸ†•

```python
EMOTIONAL_EXPRESSIONS = {
    "neutral": "Natural, neutral expression.",
    "tired": "Tired, weary expression with slight fatigue visible.",
    "energetic": "Energetic, lively expression with bright eyes.",
    "sad": "Sad, melancholic expression.",
    "angry": "Angry, intense expression.",
    "happy": "Happy, cheerful expression with a smile.",
    "excited": "Excited, enthusiastic expression.",
    "depressed": "Depressed, downcast expression.",
    "anxious": "Anxious, worried expression.",
    "confident": "Confident, self-assured expression.",
    "relaxed": "Relaxed, calm expression.",
}
```

### ç›®å½•ç»“æ„ ğŸ†•

```
character_portraits/
â””â”€â”€ {idx}_{name}/
    â”œâ”€â”€ appearance_0/
    â”‚   â”œâ”€â”€ front.png
    â”‚   â”œâ”€â”€ side.png
    â”‚   â””â”€â”€ back.png
    â”œâ”€â”€ appearance_1/
    â”‚   â”œâ”€â”€ front.png
    â”‚   â”œâ”€â”€ side.png
    â”‚   â””â”€â”€ back.png
    â””â”€â”€ appearance_2/
        â”œâ”€â”€ front.png
        â”œâ”€â”€ side.png
        â””â”€â”€ back.png
```

### å…³é”®è®¾è®¡

- **ä¸‰è§†å›¾ç³»ç»Ÿ**: æ­£é¢ â†’ ä¾§é¢ â†’ èƒŒé¢çš„ç”Ÿæˆé¡ºåº
- **å‚è€ƒå›¾é“¾å¼ç”Ÿæˆ**: åç»­è§†è§’åŸºäºæ­£é¢è‚–åƒï¼Œç¡®ä¿ä¸€è‡´æ€§
- **çº¯ç™½èƒŒæ™¯**: ä¾¿äºåç»­æŠ å›¾å’Œåˆæˆ
- **å…¨èº«å±…ä¸­æ„å›¾**: å æ®ç”»é¢å¤§éƒ¨åˆ†åŒºåŸŸï¼Œç»†èŠ‚å®Œæ•´
- **ğŸ†• å¤šå¤–è§‚ç‹¬ç«‹ç”Ÿæˆ**: æ¯ä¸ªå¤–è§‚æœ‰ç‹¬ç«‹çš„ä¸‰è§†å›¾
- **ğŸ†• æƒ…ç»ªçŠ¶æ€æ¸²æŸ“**: è‡ªåŠ¨å°†æƒ…ç»ªçŠ¶æ€æ˜ å°„åˆ°é¢éƒ¨è¡¨æƒ…
- **ğŸ†• åµŒå¥—ç›®å½•ç»“æ„**: æ¸…æ™°çš„ç»„ç»‡æ–¹å¼ï¼Œä¾¿äºç®¡ç†å’Œå¼•ç”¨
- **ğŸ†• ä¸´æ—¶æ–‡ä»¶ç®¡ç†**: è‡ªåŠ¨æ¸…ç†ä¸­é—´äº§ç‰©ï¼Œé¿å…ç£ç›˜æµªè´¹

### ä¼˜åŒ–å»ºè®®

- âœ… **å·²å®Œæˆä¼˜åŒ–**:
  - âœ… æ”¯æŒä¸åŒæƒ…ç»ªè¡¨æƒ…çš„è‚–åƒå˜ä½“
  - âœ… æ‰¹é‡ç”Ÿæˆæ¥å£ï¼ˆgenerate_all_appearances_for_characterï¼‰
  - âœ… æƒ…ç»ªçŠ¶æ€ç³»ç»Ÿï¼ˆ11 ç§æƒ…ç»ªï¼‰
- ğŸ”„ **å¯è¿›ä¸€æ­¥ä¼˜åŒ–**:
  - å¯ä»¥å¢åŠ  3/4 è§†è§’è‚–åƒï¼ˆç”µå½±ä¸­å¸¸ç”¨ï¼‰
  - è€ƒè™‘æ·»åŠ è´¨é‡éªŒè¯æ­¥éª¤ï¼ˆæ£€æŸ¥æ˜¯å¦æ­£ç¡®ç”Ÿæˆäº†æŒ‡å®šè§†è§’ï¼‰
  - å¯ä»¥æ·»åŠ è§’è‰²èº«é«˜æ¯”ä¾‹å‚è€ƒï¼Œä¾¿äºåæœŸåˆæˆ
  - è€ƒè™‘æ”¯æŒæ›´å¤šæƒ…ç»ªçš„ç»†å¾®å˜åŒ–ï¼ˆå¾®ç¬‘ç¨‹åº¦ã€çœ‰æ¯›è§’åº¦ç­‰ï¼‰

---

## 5. StoryboardArtist (åˆ†é•œè‰ºæœ¯å®¶)

### æ ¸å¿ƒèŒè´£

å°†å‰§æœ¬è½¬åŒ–ä¸ºè¯¦ç»†çš„åˆ†é•œå¤´è„šæœ¬ï¼Œ**ä½¿ç”¨ ScenePlanner æä¾›çš„ç»Ÿä¸€åœºæ™¯å®šä¹‰ä¸ºæ¯ä¸ªé•œå¤´åˆ†é…åœºæ™¯ ID**ï¼Œæ˜¯ä»æ–‡å­—åˆ°è§†è§‰çš„å…³é”®è½¬æ¢å±‚ã€‚

### ä¸»è¦æ–¹æ³•

#### `design_storyboard()`

- **è¾“å…¥**:
  - script (å‰§æœ¬)
  - characters (è§’è‰²åˆ—è¡¨)
  - scenes (åœºæ™¯å®šä¹‰åˆ—è¡¨ï¼Œæ¥è‡ª ScenePlanner) ğŸ†•
  - user_requirement (ç”¨æˆ·éœ€æ±‚)
- **è¾“å‡º**: List[ShotBriefDescription] - åˆ†é•œå¤´ç®€è¦æè¿°åˆ—è¡¨ï¼ˆåŒ…å« scene_idï¼‰
- **é€»è¾‘æµç¨‹**:
  1. **ğŸ†• æ¥æ”¶é¢„å®šä¹‰çš„åœºæ™¯åˆ—è¡¨**ï¼ˆç”± ScenePlanner æä¾›ï¼‰
  2. **ğŸ†• åœ¨æç¤ºè¯ä¸­æä¾›åœºæ™¯ä¿¡æ¯**ï¼Œè¦æ±‚ LLM ä½¿ç”¨è¿™äº›é¢„å®šä¹‰çš„ scene_id
  3. **ğŸ†• åœºæ™¯ ID åˆ†é…**: ä¸ºæ¯ä¸ªé•œå¤´åˆ†é… `scene_id`ï¼ˆä½¿ç”¨ ScenePlanner çš„å®šä¹‰ï¼‰
     - æ ¹æ®é•œå¤´æ‰€å±çš„åœºæ™¯ï¼Œåˆ†é…å¯¹åº”çš„ scene_id
     - ç¡®ä¿ä¸ CharacterExtractor ä½¿ç”¨ç›¸åŒçš„åœºæ™¯å®šä¹‰
  4. åˆ†æå‰§æœ¬åœºæ™¯ï¼Œå†³å®šé•œå¤´æ•°é‡å’Œç±»å‹
  5. ä¸ºæ¯ä¸ªé•œå¤´è®¾è®¡:
     - **ğŸ†• scene_id**: åœºæ™¯ç´¢å¼•ï¼ˆä¸ ScenePlanner å®šä¹‰ä¸€è‡´ï¼Œç”¨äºè§’è‰²å¤–è§‚è¿‡æ»¤ï¼‰
     - é•œå¤´å°ºå¯¸ (shot_size): è¿œæ™¯/å…¨æ™¯/ä¸­æ™¯/ç‰¹å†™ç­‰
     - æ‹æ‘„è§’åº¦ (angle): å¹³è§†/ä¿¯è§†/ä»°è§†ç­‰
     - é•œå¤´é«˜åº¦ (camera_height)
     - ç­‰æ•ˆç„¦è· (lens_equiv_mm)
     - è¿åŠ¨æ–¹å‘ (screen_direction): å·¦ â†’ å³/å³ â†’ å·¦/æœå‘/è¿œç¦»/é™æ­¢
     - è½¬åœºæ–¹å¼ (transition_in/out)
     - èŠ‚å¥ (beat): æ…¢/ä¸­/å¿«
     - é¢„ä¼°æ—¶é•¿ (duration_sec_estimate)
  6. ç¼–å†™è§†è§‰æè¿°å’ŒéŸ³é¢‘æè¿°

#### `decompose_visual_description()`

- **è¾“å…¥**: shot_brief_desc, characters
- **è¾“å‡º**: ShotDescription - åŒ…å«é¦–å¸§/æœ«å¸§/è¿åŠ¨æè¿°çš„è¯¦ç»†åˆ†é•œï¼ˆåŒ…å« scene_idï¼‰
- **é€»è¾‘æµç¨‹**:
  1. **ğŸ†• ä¿ç•™åœºæ™¯ ID**: å°† `scene_id` ä» brief ä¼ é€’åˆ° detailed description
  2. å°†ç®€è¦è§†è§‰æè¿°æ‹†è§£ä¸ºä¸‰éƒ¨åˆ†:
     - **é¦–å¸§æè¿°** (ff_desc): é•œå¤´å¼€å§‹æ—¶çš„é™æ€ç”»é¢
     - **æœ«å¸§æè¿°** (lf_desc): é•œå¤´ç»“æŸæ—¶çš„é™æ€ç”»é¢
     - **è¿åŠ¨æè¿°** (motion_desc): é¦–æœ«å¸§ä¹‹é—´çš„åŠ¨æ€å˜åŒ–
  3. åŒºåˆ†é•œå¤´è¿åŠ¨å’Œç”»é¢å†…å…ƒç´ è¿åŠ¨
  4. è¯†åˆ«å‡ºç°çš„è§’è‰²ç´¢å¼•
  5. åˆ¤æ–­å˜åŒ–ç¨‹åº¦ (variation_type): large/medium/small
  6. åœ¨è¿åŠ¨æè¿°ä¸­ä½¿ç”¨å¤–è§‚ç‰¹å¾ï¼ˆè€Œéåå­—ï¼‰æŒ‡ä»£è§’è‰²

### åœºæ™¯è¯†åˆ«æŒ‡å— ğŸ†•

ç³»ç»Ÿæç¤ºè¯ä¸­æ–°å¢çš„åœºæ™¯è¯†åˆ«è¯´æ˜ï¼š

> **Scene Identification**: Analyze the script to identify distinct scenes (usually separated by location or time changes). Assign a `scene_id` (starting from 0) to each shot based on which scene it belongs to. If the entire script is one continuous scene, assign `scene_id=0` to all shots. The scene_id is crucial for tracking character appearance changes across different scenes.

### æ•°æ®ç»“æ„ç¤ºä¾‹ ğŸ†•

```python
ShotDescription(
    idx=0,
    scene_id=0,  # åœºæ™¯0ï¼ˆåŠå…¬å®¤ï¼‰
    shot_size="medium",
    visual_desc="John in formal suit working at desk...",
    # ... å…¶ä»–å­—æ®µ
)

ShotDescription(
    idx=5,
    scene_id=1,  # åœºæ™¯1ï¼ˆå¥èº«æˆ¿ï¼‰
    shot_size="close_up",
    visual_desc="John in gym outfit lifting weights...",
    # ... å…¶ä»–å­—æ®µ
)
```

### å…³é”®è®¾è®¡ç‰¹ç‚¹

- **ç”µå½±è¯­è¨€ä¸“ä¸šæ€§**: åŒ…å«äº†å®Œæ•´çš„æ‘„å½±å‚æ•°ï¼ˆç„¦è·ã€è§’åº¦ã€è¿åŠ¨ç­‰ï¼‰
- **180 åº¦/30 åº¦æ³•åˆ™æ”¯æŒ**: é€šè¿‡ screen_direction ç­‰å‚æ•°æ”¯æŒåç»­è¿ç»­æ€§æ£€æŸ¥
- **å¸§çº§åˆ†è§£**: é¦–å¸§/æœ«å¸§åˆ†ç¦»è®¾è®¡ä¸ºåç»­å›¾åƒç”Ÿæˆæä¾›æ˜ç¡®ç›®æ ‡
- **è§’è‰²å¼•ç”¨è§„èŒƒ**: ä½¿ç”¨ `<è§’è‰²å>` æ ‡è®°ï¼Œåœ¨è¿åŠ¨æè¿°ä¸­ç”¨å¤–è§‚ç‰¹å¾å¼•ç”¨
- **ğŸ†• åœºæ™¯è¿½è¸ª**: æ¯ä¸ªé•œå¤´éƒ½å¸¦æœ‰ scene_idï¼Œæ”¯æŒè·¨åœºæ™¯çš„è§’è‰²å¤–è§‚ç®¡ç†
- **ğŸ†• è‡ªåŠ¨åœºæ™¯åˆ†å‰²**: LLM è‡ªåŠ¨è¯†åˆ«åœºæ™¯è¾¹ç•Œå¹¶åˆ†é… ID
- **ğŸ†• å¤–è§‚ä¸€è‡´æ€§æ”¯æŒ**: scene_id ä¸è§’è‰²çš„ appearance.scene_ids é…åˆä½¿ç”¨

### ä¼˜åŒ–å»ºè®®

- âœ… **å·²å®Œæˆä¼˜åŒ–**:
  - âœ… åœºæ™¯è¯†åˆ«å’Œ ID åˆ†é…æœºåˆ¶
  - âœ… æ”¯æŒå¤šåœºæ™¯è§’è‰²å¤–è§‚ç®¡ç†
- âœ… **å½“å‰ä¼˜åŠ¿**:
  - ç”µå½±æ‘„å½±å‚æ•°éå¸¸ä¸“ä¸šå®Œæ•´
  - é¦–å¸§/æœ«å¸§åˆ†ç¦»çš„è®¾è®¡åˆç†
  - æ”¯æŒè¿ç»­æ€§è§„åˆ™æ£€æŸ¥
- ğŸ”„ **å¯è¿›ä¸€æ­¥ä¼˜åŒ–**:
  - å¯ä»¥æ·»åŠ æ™¯æ·±ä¿¡æ¯ï¼ˆå‰æ™¯/ä¸­æ™¯/èƒŒæ™¯å±‚æ¬¡ï¼‰
  - è€ƒè™‘å¢åŠ å…‰çº¿ä¿¡æ¯ï¼ˆè‡ªç„¶å…‰/äººå·¥å…‰ã€è‰²æ¸©ç­‰ï¼‰
  - variation_type å¯ä»¥æ›´ç²¾ç»†åŒ–ï¼ˆä¾‹å¦‚ç”¨æ•°å€¼è¡¨ç¤ºå˜åŒ–ç¨‹åº¦ï¼‰
  - å¯ä»¥è€ƒè™‘æ·»åŠ "é•œå¤´ä¼˜å…ˆçº§"æ ‡è®°ï¼Œä¼˜å…ˆç”Ÿæˆå…³é”®é•œå¤´
  - åœºæ™¯è½¬æ¢å¯ä»¥æ ‡è®°è½¬åœºç±»å‹ï¼ˆæ·¡å…¥æ·¡å‡ºã€åˆ‡æ¢ç­‰ï¼‰

---

## 5. CameraImageGenerator (é•œå¤´å›¾åƒç”Ÿæˆå™¨)

### æ ¸å¿ƒèŒè´£

æ„å»ºé•œå¤´é—´çš„å±‚çº§å…³ç³»ï¼ˆæ‘„å½±æœºæ ‘ï¼‰ï¼Œå¹¶ç®¡ç†é•œå¤´è¿‡æ¸¡è§†é¢‘çš„ç”Ÿæˆã€‚

### ä¸»è¦æ–¹æ³•

#### `construct_camera_tree()`

- **è¾“å…¥**: cameras (é•œå¤´åˆ—è¡¨), shot_descs (åˆ†é•œæè¿°)
- **è¾“å‡º**: List[Camera] - å¸¦æœ‰çˆ¶å­å…³ç³»çš„é•œå¤´æ ‘
- **é€»è¾‘æµç¨‹**:
  1. ä¸ºæ¯ä¸ªé•œå¤´å¯»æ‰¾"çˆ¶é•œå¤´"ï¼ˆè§†é‡æ›´å¹¿çš„é•œå¤´ï¼‰
  2. è€ƒè™‘å› ç´ :
     - **å†…å®¹åŒ…å«å…³ç³»**: çˆ¶é•œå¤´çš„è§†é‡åº”åŒ…å«å­é•œå¤´
     - **é•œå¤´å°ºå¯¸è¿‡æ¸¡**: ä¼˜å…ˆé€‰æ‹©ç›¸é‚»å°ºå¯¸ï¼Œé¿å…è·³è·ƒè¿‡å¤§
     - **180 åº¦æ³•åˆ™**: ä¼˜å…ˆé€‰æ‹©è¿åŠ¨æ–¹å‘ä¸€è‡´çš„çˆ¶é•œå¤´
     - **æ—¶é—´é‚»è¿‘æ€§**: çˆ¶é•œå¤´åº”åœ¨æ—¶é—´ä¸Šæ¥è¿‘å­é•œå¤´
     - **ç„¦è·é™åˆ¶**: é¿å…ç„¦è·å·®å¼‚è¿‡å¤§ï¼ˆè¶…è¿‡ 3 å€ï¼‰
  3. ä½¿ç”¨å¯å‘å¼ç®—æ³•ä½œä¸ºå…œåº•æ–¹æ¡ˆ
  4. æ ‡è®°çˆ¶é•œå¤´æ— æ³•å®Œå…¨è¦†ç›–çš„ä¿¡æ¯ (missing_info)
  5. åªå…è®¸ä¸€ä¸ªé•œå¤´ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼ˆæ— çˆ¶é•œå¤´ï¼‰

#### `generate_transition_video()`

- **è¾“å…¥**: ä¸¤ä¸ªé•œå¤´çš„è§†è§‰æè¿°, ç¬¬ä¸€ä¸ªé•œå¤´çš„é¦–å¸§
- **è¾“å‡º**: VideoOutput - è¿‡æ¸¡è§†é¢‘
- **é€»è¾‘**: ç”Ÿæˆä»çˆ¶é•œå¤´åˆ°å­é•œå¤´çš„å¹³æ»‘è¿‡æ¸¡è§†é¢‘

#### `get_new_camera_image()`

- **è¾“å…¥**: transition_video_path
- **è¾“å‡º**: ImageOutput - æ–°é•œå¤´çš„å›¾åƒ
- **é€»è¾‘**:
  1. ä½¿ç”¨åœºæ™¯æ£€æµ‹åˆ†å‰²è¿‡æ¸¡è§†é¢‘
  2. æå–ç¬¬äºŒä¸ªåœºæ™¯çš„é¦–å¸§ä½œä¸ºæ–°é•œå¤´å›¾åƒ
  3. å¦‚æœæ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨è¿‡æ¸¡è§†é¢‘çš„æœ«å¸§

### å…³é”®è®¾è®¡

- **å±‚çº§åŒ–é•œå¤´ç®¡ç†**: æ ‘çŠ¶ç»“æ„åæ˜ äº†é•œå¤´é—´çš„åŒ…å«å…³ç³»
- **æ™ºèƒ½çˆ¶é•œå¤´é€‰æ‹©**: ç»¼åˆè€ƒè™‘å¤šä¸ªç”µå½±æ‹æ‘„è§„åˆ™
- **è¿‡æ¸¡è§†é¢‘ä¸­ä»‹**: åˆ©ç”¨è§†é¢‘ç”Ÿæˆçš„æ—¶é—´è¿ç»­æ€§æ¥è·å¾—åˆç†çš„æ–°è§†è§’

### ä¼˜åŒ–å»ºè®®

- âœ… **å½“å‰ä¼˜åŠ¿**:
  - é•œå¤´æ ‘è®¾è®¡å·§å¦™ï¼Œç¬¦åˆç”µå½±åˆ¶ä½œå®è·µ
  - å¤šå› ç´ è¯„åˆ†ç³»ç»Ÿåˆç†
  - è‡ªåŠ¨æ£€æµ‹å¹¶æ ‡è®°é—®é¢˜ï¼ˆmissing_infoï¼‰
- ğŸ”„ **å¯ä¼˜åŒ–é¡¹**:
  - å¯ä»¥è€ƒè™‘æ›´å¤æ‚çš„è¯„åˆ†æƒé‡è°ƒæ•´
  - å¯¹äº missing_info æƒ…å†µï¼Œå¯ä»¥ç”Ÿæˆä¸“é—¨çš„"è¡¥å…¨æç¤º"
  - å¯ä»¥æ·»åŠ "é•œå¤´å¯è¡Œæ€§"é¢„æ£€æŸ¥ï¼ˆæŸäº›é•œå¤´ç»„åˆå¯èƒ½ç‰©ç†ä¸Šä¸å¯è¡Œï¼‰
  - è€ƒè™‘æ”¯æŒå¹¶è¡Œé•œå¤´ï¼ˆåŒä¸€æ—¶åˆ»çš„ä¸åŒè§†è§’ï¼‰

---

## 6. ReferenceImageSelector (å‚è€ƒå›¾é€‰æ‹©å™¨)

### æ ¸å¿ƒèŒè´£

ä¸ºæ¯ä¸€å¸§å›¾åƒçš„ç”Ÿæˆæ™ºèƒ½é€‰æ‹©æœ€ç›¸å…³çš„å‚è€ƒå›¾åƒï¼Œ**æ ¹æ®åœºæ™¯ ID è‡ªåŠ¨è¿‡æ»¤è§’è‰²å¤–è§‚**ï¼Œ**æ³¨å…¥åœºæ™¯ç¯å¢ƒä¸Šä¸‹æ–‡ä»¥å¢å¼ºåœºæ™¯ä¸€è‡´æ€§** ğŸ†•ï¼Œå¹¶ç”Ÿæˆå¼•å¯¼å›¾åƒç”Ÿæˆçš„æ–‡æœ¬æç¤ºã€‚

### ä¸»è¦æ–¹æ³•

#### `select_reference_images_and_generate_prompt()`

- **è¾“å…¥**:
  - available_image_path_and_text_pairs: å¯ç”¨çš„å‚è€ƒå›¾åˆ—è¡¨ï¼ˆè§’è‰²è‚–åƒ+å·²ç”Ÿæˆçš„åœºæ™¯å›¾ï¼‰
  - frame_description: ç›®æ ‡å¸§çš„æ–‡æœ¬æè¿°
  - style: è§†è§‰é£æ ¼
  - **ğŸ†• scene_id**: å½“å‰åœºæ™¯ IDï¼ˆç”¨äºè¿‡æ»¤è§’è‰²å¤–è§‚ï¼‰
  - **ğŸ†• characters**: è§’è‰²åˆ—è¡¨ï¼ˆç”¨äºå¤–è§‚åŒ¹é…ï¼‰
  - **ğŸ†• scene_definition**: SceneDefinition å¯¹è±¡ï¼ˆç”¨äºæ³¨å…¥åœºæ™¯ç¯å¢ƒä¸Šä¸‹æ–‡ï¼‰
- **è¾“å‡º**:
  - reference_image_path_and_text_pairs: é€‰ä¸­çš„å‚è€ƒå›¾ï¼ˆæœ€å¤š 8 å¼ ï¼‰
  - text_prompt: ç”Ÿæˆçš„å›¾åƒæç¤ºè¯
- **é€»è¾‘æµç¨‹**: 0. **ğŸ†• åœºæ™¯ä¸Šä¸‹æ–‡æ„å»º**:
  - å¦‚æœæä¾›äº† `scene_definition`ï¼Œæå–åœºæ™¯ä¿¡æ¯æ„å»ºä¸Šä¸‹æ–‡å­—ç¬¦ä¸²
  - åŒ…å«: locationï¼ˆåœ°ç‚¹ï¼‰ã€time_of_dayï¼ˆæ—¶é—´ï¼‰ã€descriptionï¼ˆåœºæ™¯æè¿°ï¼‰
  - åœ¨æ‰€æœ‰åç»­æç¤ºè¯ç”Ÿæˆä¸­æ³¨å…¥æ­¤ä¸Šä¸‹æ–‡ï¼ŒæŒ‡å¯¼ LLM ä¿æŒåœºæ™¯ç¯å¢ƒä¸€è‡´æ€§
  1. **ğŸ†• åœºæ™¯å¤–è§‚è¿‡æ»¤é˜¶æ®µ** (`_filter_images_by_scene`):
     - æ ¹æ® `scene_id` å’Œè§’è‰²çš„ `appearance.scene_ids` è¿‡æ»¤è‚–åƒ
     - åªä¿ç•™å½“å‰åœºæ™¯é€‚ç”¨çš„è§’è‰²å¤–è§‚
     - éè§’è‰²è‚–åƒï¼ˆå¦‚èƒŒæ™¯å›¾ï¼‰å§‹ç»ˆä¿ç•™
     - å¦‚æœ scene_id=Noneï¼Œè¿”å›æ‰€æœ‰å›¾åƒï¼ˆå‘åå…¼å®¹ï¼‰
  2. **é¢„è¿‡æ»¤é˜¶æ®µ**ï¼ˆå¦‚æœå€™é€‰å›¾è¶…è¿‡ 8 å¼ ï¼‰:
     - ğŸ†• åœ¨æç¤ºè¯ä¸­æ³¨å…¥åœºæ™¯ä¸Šä¸‹æ–‡
     - ä½¿ç”¨çº¯æ–‡æœ¬æ¨¡å‹å¿«é€Ÿç­›é€‰ç›¸å…³å›¾åƒ
  3. **å¤šæ¨¡æ€é€‰æ‹©é˜¶æ®µ**:
     - ğŸ†• åœ¨æç¤ºè¯ä¸­æ³¨å…¥åœºæ™¯ä¸Šä¸‹æ–‡
     - ä½¿ç”¨æ”¯æŒå›¾åƒè¾“å…¥çš„æ¨¡å‹è¿›è¡Œç²¾ç»†é€‰æ‹©
     - è€ƒè™‘å› ç´ :
       - è§’è‰²ä¸€è‡´æ€§ï¼ˆå¤–è²Œã€æœè£…ã€å§¿æ€ï¼‰
       - **ğŸ†• åœºæ™¯ç¯å¢ƒä¸€è‡´æ€§**ï¼ˆåœ°ç‚¹ã€æ—¶é—´ã€æ°›å›´ä¸ scene_definition åŒ¹é…ï¼‰
       - é£æ ¼ä¸€è‡´æ€§ï¼ˆè§†è§‰é£æ ¼ç»Ÿä¸€ï¼‰
       - æ„å›¾ç›¸ä¼¼æ€§ï¼ˆåŒä¸€é•œå¤´æ‹æ‘„çš„ç”»é¢ä¼˜å…ˆï¼‰
       - æ—¶é—´é‚»è¿‘æ€§ï¼ˆæœ€è¿‘ç”Ÿæˆçš„ç”»é¢ä¼˜å…ˆï¼‰
  4. **æç¤ºè¯ç”Ÿæˆ**:
     - ğŸ†• åœ¨æç¤ºè¯ä¸­æ³¨å…¥åœºæ™¯ä¸Šä¸‹æ–‡
     - ä¸ºæ¯ä¸ªé€‰ä¸­çš„å‚è€ƒå›¾åˆ†é…ç´¢å¼•ï¼ˆImage 0, Image 1...ï¼‰
     - ç”Ÿæˆè¯¦ç»†æç¤ºè¯ï¼Œæ˜ç¡®æŒ‡å‡ºæ¯ä¸ªå…ƒç´ åº”å‚è€ƒå“ªå¼ å›¾
     - åŒ…å«è§†è§‰é£æ ¼è¦æ±‚å’Œåœºæ™¯ç¯å¢ƒè¦æ±‚
  5. **é™çº§ç­–ç•¥**:
     - ğŸ†• åœ¨æç¤ºè¯ä¸­æ³¨å…¥åœºæ™¯ä¸Šä¸‹æ–‡
     - å¦‚æœå¤šæ¨¡æ€å¤±è´¥ï¼Œé™çº§ä¸ºçº¯æ–‡æœ¬é€‰æ‹©
  6. **æç¤ºè¯éªŒè¯å’Œä¿®å¤** (`_validate_prompt_mapping`):
     - æ£€æŸ¥ç”Ÿæˆçš„æç¤ºè¯æ˜¯å¦æ­£ç¡®å¼•ç”¨äº†æ‰€æœ‰å‚è€ƒå›¾
     - å¦‚æœç¼ºå¤±å¼•ç”¨ï¼Œè‡ªåŠ¨ä¿®å¤æˆ–é‡æ–°ç”Ÿæˆ

#### `_filter_images_by_scene()` ğŸ†•

- **è¾“å…¥**:
  - available_pairs: æ‰€æœ‰å¯ç”¨å›¾åƒè·¯å¾„å’Œæè¿°å¯¹
  - scene_id: å½“å‰åœºæ™¯ ID
  - characters: è§’è‰²åˆ—è¡¨
- **è¾“å‡º**: è¿‡æ»¤åçš„å›¾åƒåˆ—è¡¨
- **è¿‡æ»¤é€»è¾‘**:
  1. è¯†åˆ«è§’è‰²è‚–åƒï¼ˆè·¯å¾„åŒ…å« "character_portraits"ï¼‰
  2. æå– appearance_idï¼ˆæ­£åˆ™åŒ¹é… `/appearance_X/`ï¼‰
  3. æŸ¥æ‰¾å¯¹åº”è§’è‰²å’Œå¤–è§‚
  4. æ£€æŸ¥ `appearance.scene_ids` æ˜¯å¦åŒ…å«å½“å‰ scene_id
  5. è¿‡æ»¤æ‰ä¸é€‚ç”¨çš„å¤–è§‚ï¼Œä¿ç•™é€‚ç”¨çš„å¤–è§‚å’Œæ‰€æœ‰éè‚–åƒå›¾åƒ

### åœºæ™¯è¿‡æ»¤ç¤ºä¾‹ ğŸ†•

```python
# åœºæ™¯ 0ï¼ˆåŠå…¬å®¤ï¼‰
è¾“å…¥: [
    "portraits/0_John/appearance_0/front.png",  # è¥¿è£…ï¼ˆåœºæ™¯0ï¼‰
    "portraits/0_John/appearance_1/front.png",  # è¿åŠ¨æœï¼ˆåœºæ™¯1ï¼‰
    "portraits/0_John/appearance_2/front.png",  # ä¼‘é—²è£…ï¼ˆåœºæ™¯2ï¼‰
    "background/office.png"
]

scene_id=0 æ—¶è¾“å‡º: [
    "portraits/0_John/appearance_0/front.png",  # âœ“ ä¿ç•™
    "background/office.png"                      # âœ“ ä¿ç•™ï¼ˆéè‚–åƒï¼‰
]
# appearance_1 å’Œ appearance_2 è¢«è¿‡æ»¤æ‰

# åœºæ™¯ 1ï¼ˆå¥èº«æˆ¿ï¼‰
scene_id=1 æ—¶è¾“å‡º: [
    "portraits/0_John/appearance_1/front.png",  # âœ“ ä¿ç•™
    "background/office.png"                      # âœ“ ä¿ç•™
]
```

### å…³é”®è®¾è®¡

- **ä¸¤é˜¶æ®µè¿‡æ»¤**: å…ˆç²—ç­›å†ç²¾é€‰ï¼ŒèŠ‚çœå¤šæ¨¡æ€æ¨¡å‹è°ƒç”¨æˆæœ¬
- **å¼ºåˆ¶å¼•ç”¨æœºåˆ¶**: ç¡®ä¿ç”Ÿæˆçš„æç¤ºè¯æ˜ç¡®å¼•ç”¨æ¯å¼ å‚è€ƒå›¾ï¼ˆ"Image N"æ ¼å¼ï¼‰
- **è§†è§’åŒ¹é…**: ä¸ºè§’è‰²é€‰æ‹©æœ€åˆé€‚çš„è§†è§’è‚–åƒï¼ˆæ­£é¢/ä¾§é¢/èƒŒé¢ï¼‰
- **å»é‡é€»è¾‘**: é¿å…é€‰æ‹©é‡å¤ä¿¡æ¯çš„å‚è€ƒå›¾
- **ğŸ†• åœºæ™¯æ„ŸçŸ¥è¿‡æ»¤**: è‡ªåŠ¨æ ¹æ®åœºæ™¯ ID è¿‡æ»¤è§’è‰²å¤–è§‚
- **ğŸ†• æ™ºèƒ½è·¯å¾„åŒ¹é…**: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«åµŒå¥—å¤–è§‚ç›®å½•ç»“æ„
- **ğŸ†• å‘åå…¼å®¹**: scene_id=None æˆ– characters=None æ—¶è·³è¿‡è¿‡æ»¤
- **ğŸ†• æ—¥å¿—è®°å½•**: è¯¦ç»†è®°å½•è¿‡æ»¤è¿‡ç¨‹ï¼Œä¾¿äºè°ƒè¯•

### æµ‹è¯•éªŒè¯ ğŸ†•

å·²é€šè¿‡å®Œæ•´å•å…ƒæµ‹è¯•ï¼š

- âœ… åœºæ™¯ 0 è¿‡æ»¤æµ‹è¯•ï¼šæ­£ç¡®è¿‡æ»¤å‡º appearance_0
- âœ… åœºæ™¯ 1 è¿‡æ»¤æµ‹è¯•ï¼šæ­£ç¡®è¿‡æ»¤å‡º appearance_1
- âœ… scene_id=None æµ‹è¯•ï¼šè¿”å›æ‰€æœ‰å›¾åƒï¼ˆå‘åå…¼å®¹ï¼‰
- âœ… éè‚–åƒå›¾åƒï¼šå§‹ç»ˆä¿ç•™
- âœ… æ—§æ ¼å¼è‚–åƒï¼šå‘åå…¼å®¹å¤„ç†

### åœºæ™¯ä¸Šä¸‹æ–‡ç³»ç»Ÿ ğŸ†• (P1 ä¼˜åŒ–)

#### åœºæ™¯ç¯å¢ƒå‚è€ƒå¸§æ”¶é›†

åœ¨ç”Ÿæˆæ¯ä¸€å¸§æ—¶ï¼Œè‡ªåŠ¨æ”¶é›†å·²å®Œæˆçš„åŒåœºæ™¯å¸§ä½œä¸ºç¯å¢ƒå‚è€ƒï¼š

```python
# åœ¨ script2video_pipeline.py ä¸­å®ç°
completed_frames = self.collect_completed_frames_for_scene(
    scene_id=shot_description.scene_id,
    current_shot_idx=shot.idx,
    shot_descriptions=shot_descriptions
)
```

**æ”¶é›†é€»è¾‘**:

1. éå†æ‰€æœ‰å·²å®Œæˆçš„å¸§
2. è¿‡æ»¤å‡ºç›¸åŒ scene_id çš„å¸§
3. æ’é™¤å½“å‰é•œå¤´çš„å¸§
4. æŒ‰ scene_id å’Œ shot_idx æ’åº
5. é™åˆ¶æœ€å¤š 5 ä¸ªå‚è€ƒå¸§

**ä¼˜åŠ¿**:

- æä¾›åŒåœºæ™¯çš„ç¯å¢ƒå‚è€ƒï¼Œå¢å¼ºåœºæ™¯ä¸€è‡´æ€§
- é“å…·ã€å®¶å…·ã€å¸ƒå±€ç­‰ç¯å¢ƒå…ƒç´ æ›´è¿è´¯
- å…‰çº¿ã€è‰²è°ƒç­‰è§†è§‰é£æ ¼æ›´ç»Ÿä¸€

#### åœºæ™¯ä¸Šä¸‹æ–‡æ„å»º

```python
def _build_scene_context(self, scene_definition):
    """æ„å»ºåœºæ™¯ä¸Šä¸‹æ–‡å­—ç¬¦ä¸²"""
    if not scene_definition:
        return ""

    context_parts = []
    if scene_definition.location:
        context_parts.append(f"Location: {scene_definition.location}")
    if scene_definition.time_of_day:
        context_parts.append(f"Time: {scene_definition.time_of_day}")
    if scene_definition.description:
        context_parts.append(f"Scene: {scene_definition.description}")

    return ", ".join(context_parts)
```

**æ³¨å…¥ä½ç½®**:

- åœ¨æ‰€æœ‰ ReferenceImageSelector çš„æç¤ºè¯ç”Ÿæˆä¸­
- åŒ…æ‹¬é¢„è¿‡æ»¤é˜¶æ®µã€å¤šæ¨¡æ€é€‰æ‹©é˜¶æ®µã€æç¤ºè¯ç”Ÿæˆé˜¶æ®µ

### ä¼˜åŒ–å»ºè®®

- âœ… **å·²å®Œæˆä¼˜åŒ–**:
  - âœ… åœºæ™¯å¤–è§‚è¿‡æ»¤ç³»ç»Ÿ
  - âœ… æ­£åˆ™è¡¨è¾¾å¼è·¯å¾„åŒ¹é…
  - âœ… å‘åå…¼å®¹æœºåˆ¶
  - âœ… **P1 ä¼˜åŒ–**: åœºæ™¯ç¯å¢ƒå‚è€ƒå¸§æ”¶é›†ä¸æ³¨å…¥
- âœ… **å½“å‰ä¼˜åŠ¿**:
  - ä¸¤é˜¶æ®µç­›é€‰è®¾è®¡é«˜æ•ˆ
  - æç¤ºè¯éªŒè¯æœºåˆ¶å®Œå–„
  - é™çº§ç­–ç•¥ä¿è¯é²æ£’æ€§
  - **ç¯å¢ƒä¸€è‡´æ€§æ˜¾è‘—æå‡**ï¼ˆé€šè¿‡åœºæ™¯å‚è€ƒå¸§ï¼‰
- ğŸ”„ **å¯è¿›ä¸€æ­¥ä¼˜åŒ–**:
  - å¯ä»¥æ·»åŠ å‚è€ƒå›¾æƒé‡ç³»ç»Ÿï¼ˆæœ‰äº›å›¾æ›´é‡è¦ï¼‰
  - è€ƒè™‘ç¼“å­˜å¸¸ç”¨è§’è‰²ç»„åˆçš„å‚è€ƒå›¾é€‰æ‹©ç»“æœ
  - å¯ä»¥ä¼˜åŒ–é€‰æ‹©ç­–ç•¥ï¼ˆä¾‹å¦‚ä½¿ç”¨ embedding ç›¸ä¼¼åº¦é¢„ç­›é€‰ï¼‰
  - ç”Ÿæˆçš„æç¤ºè¯å¯ä»¥æ›´ç»“æ„åŒ–ï¼ˆåˆ†ä¸ºè§’è‰²æè¿°ã€ç¯å¢ƒæè¿°ã€é£æ ¼æè¿°ç­‰æ¨¡å—ï¼‰
  - å¯ä»¥æ·»åŠ "ç½®ä¿¡åº¦"è¯„åˆ†ï¼Œæ ‡è®°ä½è´¨é‡çš„å‚è€ƒå›¾
  - **åœºæ™¯å‚è€ƒå›¾ç”Ÿæˆ**ï¼ˆé•¿æœŸæ–¹æ¡ˆï¼Œè§ TODO.mdï¼‰

---

## 7. BestImageSelector (æœ€ä½³å›¾åƒé€‰æ‹©å™¨)

### æ ¸å¿ƒèŒè´£

ä»å¤šä¸ªå€™é€‰ç”Ÿæˆå›¾åƒä¸­é€‰å‡ºæœ€ç¬¦åˆè¦æ±‚çš„ä¸€å¼ ï¼Œ**å¼ºåŒ–ç¯å¢ƒä¸€è‡´æ€§è¯„ä¼°** ğŸ†• (P5 ä¼˜åŒ–)ã€‚

### ä¸»è¦æ–¹æ³•

#### `__call__()`

- **è¾“å…¥**:
  - reference_image_path_and_text_pairs: å‚è€ƒå›¾åŠå…¶æè¿°
  - target_description: ç›®æ ‡å›¾åƒçš„æ–‡æœ¬æè¿°
  - candidate_image_paths: å€™é€‰å›¾åƒè·¯å¾„åˆ—è¡¨
- **è¾“å‡º**: æœ€ä½³å›¾åƒçš„è·¯å¾„
- **è¯„ä¼°æ ‡å‡†** ğŸ†• (æƒé‡å·²ä¼˜åŒ–):
  1. **ğŸ†• ç¯å¢ƒä¸€è‡´æ€§** (40% - æœ€é«˜ä¼˜å…ˆçº§):
     - åœºæ™¯åœ°ç‚¹åŒ¹é…ï¼ˆåŠå…¬å®¤ã€è¡—é“ã€å®¤å†…/å®¤å¤–ï¼‰
     - å…‰çº¿æ¡ä»¶ä¸€è‡´ï¼ˆè‡ªç„¶å…‰ã€äººå·¥ç…§æ˜ã€æ—¶é—´æ®µï¼‰
     - æ•´ä½“æ°›å›´ç»Ÿä¸€ï¼ˆè‰²è°ƒã€æ˜æš—å¯¹æ¯”ï¼‰
     - é“å…·å’Œå®¶å…·çš„è¿ç»­æ€§
  2. **è§’è‰²ä¸€è‡´æ€§** (30%):
     - æ€§åˆ«ã€ç§æ—ã€å¹´é¾„
     - é¢éƒ¨ç‰¹å¾ã€ä½“å‹
     - æœè£…ã€å‘å‹
  3. **æè¿°å‡†ç¡®æ€§** (20%):
     - æ˜¯å¦åŒ…å«æè¿°ä¸­çš„å…³é”®å…ƒç´ 
     - åŠ¨ä½œã€åœºæ™¯ã€ç‰©å“æ˜¯å¦å‡†ç¡®
  4. **ç©ºé—´ä¸€è‡´æ€§** (10%):
     - è§’è‰²ç›¸å¯¹ä½ç½®ï¼ˆå·¦å³ã€å‰åï¼‰
     - åœºæ™¯å¸ƒå±€
     - è§†è§’ä¸€è‡´æ€§

### æƒé‡è°ƒæ•´è¯´æ˜ ğŸ†• (P5 ä¼˜åŒ–)

**ä¼˜åŒ–å‰**:

- è§’è‰²ä¸€è‡´æ€§: æœ€é«˜ä¼˜å…ˆçº§
- ç¯å¢ƒå› ç´ : è¾ƒä½æƒé‡

**ä¼˜åŒ–å**:

- **ç¯å¢ƒä¸€è‡´æ€§: 40%** - ç¡®ä¿åœºæ™¯ç¯å¢ƒè¿è´¯
- è§’è‰²ä¸€è‡´æ€§: 30% - ä¿æŒè§’è‰²è¯†åˆ«å‡†ç¡®
- æè¿°å‡†ç¡®æ€§: 20% - ç¡®ä¿å…³é”®å…ƒç´ å­˜åœ¨
- ç©ºé—´ä¸€è‡´æ€§: 10% - åŸºç¡€å¸ƒå±€åˆç†

**ç†ç”±**:

- ç¯å¢ƒä¸€è‡´æ€§å¯¹è§†è§‰è¿è´¯æ€§å½±å“æœ€å¤§
- é“å…·ä½ç½®ã€å…‰çº¿ã€è‰²è°ƒçš„ä¸€è‡´æ€§æ˜¯ç”¨æˆ·æœ€å®¹æ˜“å¯Ÿè§‰çš„é—®é¢˜
- åœ¨ä¿è¯è§’è‰²å¯è¯†åˆ«çš„å‰æä¸‹ï¼Œç¯å¢ƒç»Ÿä¸€æ€§æ›´é‡è¦

### å…³é”®è®¾è®¡

- **å¤šå€™é€‰ç”Ÿæˆç­–ç•¥**: ç”Ÿæˆå¤šå¼ å€™é€‰å›¾ï¼ˆé€šå¸¸ 3 å¼ ï¼‰å†é€‰æœ€ä½³
- **å¤šæ¨¡æ€è¯„ä¼°**: åŒæ—¶å¯¹æ¯”å‚è€ƒå›¾å’Œå€™é€‰å›¾çš„è§†è§‰ä¿¡æ¯
- **å®¢è§‚è¯„ä¼°**: é¿å…ä¸»è§‚åå¥½ï¼ŒåŸºäºæ˜ç¡®æ ‡å‡†
- **é‡è¯•æœºåˆ¶**: å¤±è´¥æ—¶é™çº§ä¸ºé€‰æ‹©ç¬¬ä¸€å¼ å€™é€‰
- **ğŸ†• ç¯å¢ƒä¼˜å…ˆ**: é‡æ–°è°ƒæ•´è¯„ä¼°æƒé‡ï¼Œå¼ºåŒ–ç¯å¢ƒä¸€è‡´æ€§

### ä¼˜åŒ–å»ºè®®

- âœ… **å·²å®Œæˆä¼˜åŒ–**:
  - âœ… **P5 ä¼˜åŒ–**: ç¯å¢ƒä¸€è‡´æ€§æƒé‡æå‡è‡³ 40%
  - âœ… è¯„ä¼°æ ‡å‡†é‡æ–°å¹³è¡¡
- âœ… **å½“å‰ä¼˜åŠ¿**:
  - è¯„ä¼°æ ‡å‡†æ¸…æ™°æ˜ç¡®
  - ä¼˜å…ˆçº§åˆç†ï¼ˆç¯å¢ƒä¸€è‡´æ€§æœ€é‡è¦ï¼‰
  - æœ‰é™çº§ç­–ç•¥
- ğŸ”„ **å¯ä¼˜åŒ–é¡¹**:
  - å¯ä»¥è¿”å›è¯„åˆ†è€Œéä»…è¿”å›æœ€ä½³å›¾ï¼ˆä¾¿äºè°ƒè¯•å’Œåˆ†æï¼‰
  - è€ƒè™‘å¢åŠ å€™é€‰æ•°é‡ï¼ˆä¾‹å¦‚ 5-7 å¼ ï¼‰æé«˜é€‰æ‹©ç©ºé—´
  - å¯ä»¥æ·»åŠ "éƒ½ä¸æ»¡æ„"çš„åˆ¤æ–­ï¼Œè§¦å‘é‡æ–°ç”Ÿæˆ
  - è€ƒè™‘å¼•å…¥è‡ªåŠ¨åŒ–æŒ‡æ ‡ï¼ˆCLIP ç›¸ä¼¼åº¦ã€äººè„¸è¯†åˆ«ç­‰ï¼‰è¾…åŠ©åˆ¤æ–­

---

## 8. Pipeline æµç¨‹æ¦‚è§ˆ

### Script2Video Pipeline

å®Œæ•´æµç¨‹ï¼ˆ8 ä¸ªä¸»è¦é˜¶æ®µï¼‰ï¼š

```
0. ğŸ†• åœºæ™¯è§„åˆ’ (ScenePlanner.plan_scenes)
   â†“ åˆ†æå‰§æœ¬ï¼Œè¯†åˆ«åœºæ™¯è¾¹ç•Œï¼Œåˆ†é…ç»Ÿä¸€çš„ scene_id
   â†“ è¾“å‡º: List[SceneDefinition] â†’ scenes.json
   â†“ å­˜å‚¨åœ¨ self.scenes_dict ä¸­ä¾›åç»­ä½¿ç”¨

1. æå–è§’è‰² (CharacterExtractor.extract_characters) ğŸ†• æ¥æ”¶åœºæ™¯å®šä¹‰
   â†“ è¾“å…¥: script + scenesï¼ˆä½¿ç”¨ ScenePlanner çš„åœºæ™¯å®šä¹‰ï¼‰
   â†“ æ ¹æ®åœºæ™¯ä¸ºè§’è‰²åˆ†é…å¤–è§‚ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ scene_id
   â†“ è¾“å‡º: List[CharacterInScene] with appearancesï¼ˆscene_ids ä¸ ScenePlanner ä¸€è‡´ï¼‰

2. ç”Ÿæˆè§’è‰²è‚–åƒ (CharacterPortraitsGenerator) ğŸ†• æ”¯æŒå¤šå¤–è§‚
   â†“ ä¸ºæ¯ä¸ªè§’è‰²çš„æ¯ä¸ªå¤–è§‚ç”Ÿæˆä¸‰è§†å›¾
   â†“ è¾“å‡º: character_portraits/{idx}_{name}/{appearance_id}/{view}.png

3. è®¾è®¡åˆ†é•œå¤´ (StoryboardArtist.design_storyboard) ğŸ†• æ¥æ”¶åœºæ™¯å®šä¹‰
   â†“ è¾“å…¥: script + characters + scenesï¼ˆä½¿ç”¨ ScenePlanner çš„åœºæ™¯å®šä¹‰ï¼‰
   â†“ ä¸ºæ¯ä¸ªé•œå¤´åˆ†é… scene_idï¼ˆä¸ ScenePlanner å’Œ CharacterExtractor ä¿æŒä¸€è‡´ï¼‰
   â†“ è¾“å‡º: List[ShotBriefDescription] with scene_id

4. åˆ†è§£è§†è§‰æè¿° (StoryboardArtist.decompose_visual_description)
   â†“ ä¿ç•™ scene_id åˆ°è¯¦ç»†æè¿°
   â†“ è¾“å‡º: List[ShotDescription] with scene_id

5. æ„å»ºé•œå¤´æ ‘ (Construct Camera Tree)
   â†“

6. è¿ç»­æ€§æ£€æŸ¥ (Continuity Check - 180/30åº¦è§„åˆ™)
   â†“

7. å¹¶è¡Œç”Ÿæˆå¸§å’Œè§†é¢‘ (Generate Frames & Videos) ğŸ†• åœºæ™¯æ„ŸçŸ¥ + ç¯å¢ƒä¸€è‡´æ€§ + æ—¶åºä¼˜åŒ–
   â”œâ”€ **ğŸ†• P2 ä¼˜åŒ–: ç›¸æœºæ—¶åºæ§åˆ¶**
   â”‚  â”œâ”€ è¯†åˆ«ä¼˜å…ˆçº§é•œå¤´ï¼ˆpriority_shot_idxsï¼‰
   â”‚  â””â”€ ç­‰å¾…ç¬¬ä¸€ä¸ªé•œå¤´çš„æœ«å¸§å®Œæˆåå†å¼€å§‹åç»­é•œå¤´
   â”œâ”€ æŒ‰é•œå¤´æ ‘ç”Ÿæˆé¦–å¸§
   â”œâ”€ **ğŸ†• P1 ä¼˜åŒ–: åŠ¨æ€ç¯å¢ƒå‚è€ƒæ”¶é›†**
   â”‚  â””â”€ collect_completed_frames_for_scene() - æ”¶é›†åŒåœºæ™¯å·²å®Œæˆçš„å¸§
   â”œâ”€ ğŸ†• ä» scenes_dict è·å–å½“å‰é•œå¤´çš„ scene_definition
   â”œâ”€ é€‰æ‹©å‚è€ƒå›¾ (ReferenceImageSelector)
   â”‚  â”œâ”€ ğŸ†• æ¥æ”¶ scene_definition å‚æ•°
   â”‚  â”œâ”€ æ ¹æ® scene_id è¿‡æ»¤è§’è‰²å¤–è§‚ (_filter_images_by_scene)
   â”‚  â”œâ”€ **ğŸ†• P1 ä¼˜åŒ–: æ·»åŠ åŒåœºæ™¯ç¯å¢ƒå‚è€ƒå¸§**
   â”‚  â””â”€ ğŸ†• æ³¨å…¥åœºæ™¯ä¸Šä¸‹æ–‡ï¼ˆlocation, time_of_day, descriptionï¼‰åˆ°æç¤ºè¯
   â”œâ”€ ç”Ÿæˆå€™é€‰å¸§ (å¤šå¼ )
   â”œâ”€ **ğŸ†• P5 ä¼˜åŒ–: é€‰æ‹©æœ€ä½³å¸§ (BestImageSelector)**
   â”‚  â””â”€ ç¯å¢ƒä¸€è‡´æ€§æƒé‡ 40%ï¼ˆæœ€é«˜ï¼‰
   â”œâ”€ **ğŸ†• P3 ä¼˜åŒ–: åœºæ™¯å®šä¹‰éªŒè¯**
   â”‚  â””â”€ æ£€æŸ¥ shot_description.scene_id æ˜¯å¦å­˜åœ¨äº scenes_dict
   â””â”€ **ğŸ†• P4 ä¼˜åŒ–: è§†é¢‘ç”Ÿæˆå®¹é”™**
      â”œâ”€ 10 åˆ†é’Ÿè¶…æ—¶æ§åˆ¶
      â”œâ”€ æ–‡ä»¶å­˜åœ¨æ€§éªŒè¯
      â””â”€ è¯¦ç»†é”™è¯¯æ—¥å¿—
   â†“

8. æ—¶é—´çº¿æ¸²æŸ“ (Timeline Rendering)
```

### å¤šå¤–è§‚ç³»ç»Ÿå·¥ä½œæµç¨‹ ğŸ†•

```
âœ… ç»Ÿä¸€åœºæ™¯è§„åˆ’æµç¨‹ï¼š

0. ScenePlanner æå‰åˆ†æå‰§æœ¬
   â†“ è¾“å‡º: scenes.json
   [
     {scene_id: 0, location: "åŠå…¬å®¤", time_of_day: "ç™½å¤©", ...},
     {scene_id: 1, location: "å¥èº«æˆ¿", time_of_day: "ä¸‹åˆ", ...},
     {scene_id: 2, location: "é¤å…", time_of_day: "æ™šä¸Š", ...}
   ]

åœºæ™¯ 0 (åŠå…¬å®¤)
â”œâ”€ CharacterExtractor ä½¿ç”¨ ScenePlanner çš„åœºæ™¯å®šä¹‰
â”‚  â””â”€ è¯†åˆ« John çš„ appearance_0 (è¥¿è£…) â†’ scene_ids=[0]
â”œâ”€ CharacterPortraitsGenerator ä¸º appearance_0 ç”Ÿæˆä¸‰è§†å›¾
â”œâ”€ StoryboardArtist ä½¿ç”¨ ScenePlanner çš„åœºæ™¯å®šä¹‰
â”‚  â””â”€ ä¸ºé•œå¤´åˆ†é… scene_id=0ï¼ˆä¸ ScenePlanner ä¸€è‡´ï¼‰
â””â”€ ReferenceImageSelector
   â”œâ”€ æ ¹æ® scene_id=0 è¿‡æ»¤ï¼Œåªä½¿ç”¨ appearance_0 çš„è‚–åƒ
   â””â”€ ğŸ†• æ³¨å…¥åœºæ™¯ä¸Šä¸‹æ–‡ï¼š"Location: åŠå…¬å®¤, Time: ç™½å¤©, ..."

åœºæ™¯ 1 (å¥èº«æˆ¿)
â”œâ”€ CharacterExtractor ä½¿ç”¨ ScenePlanner çš„åœºæ™¯å®šä¹‰
â”‚  â””â”€ è¯†åˆ« John çš„ appearance_1 (è¿åŠ¨æœ) â†’ scene_ids=[1]
â”œâ”€ CharacterPortraitsGenerator ä¸º appearance_1 ç”Ÿæˆä¸‰è§†å›¾
â”œâ”€ StoryboardArtist ä½¿ç”¨ ScenePlanner çš„åœºæ™¯å®šä¹‰
â”‚  â””â”€ ä¸ºé•œå¤´åˆ†é… scene_id=1ï¼ˆä¸ ScenePlanner ä¸€è‡´ï¼‰
â””â”€ ReferenceImageSelector
   â”œâ”€ æ ¹æ® scene_id=1 è¿‡æ»¤ï¼Œåªä½¿ç”¨ appearance_1 çš„è‚–åƒ
   â””â”€ ğŸ†• æ³¨å…¥åœºæ™¯ä¸Šä¸‹æ–‡ï¼š"Location: å¥èº«æˆ¿, Time: ä¸‹åˆ, ..."

åœºæ™¯ 2 (é¤å…)
â”œâ”€ CharacterExtractor ä½¿ç”¨ ScenePlanner çš„åœºæ™¯å®šä¹‰
â”‚  â””â”€ è¯†åˆ« John çš„ appearance_2 (ä¼‘é—²è£…) â†’ scene_ids=[2]
â”œâ”€ CharacterPortraitsGenerator ä¸º appearance_2 ç”Ÿæˆä¸‰è§†å›¾
â”œâ”€ StoryboardArtist ä½¿ç”¨ ScenePlanner çš„åœºæ™¯å®šä¹‰
â”‚  â””â”€ ä¸ºé•œå¤´åˆ†é… scene_id=2ï¼ˆä¸ ScenePlanner ä¸€è‡´ï¼‰
â””â”€ ReferenceImageSelector
   â”œâ”€ æ ¹æ® scene_id=2 è¿‡æ»¤ï¼Œåªä½¿ç”¨ appearance_2 çš„è‚–åƒ
   â””â”€ ğŸ†• æ³¨å…¥åœºæ™¯ä¸Šä¸‹æ–‡ï¼š"Location: é¤å…, Time: æ™šä¸Š, ..."

â­ å…³é”®ä¼˜åŠ¿ï¼š
- scene_id åœ¨æ‰€æœ‰ Agent é—´å®Œå…¨ä¸€è‡´ï¼ˆæ¥è‡ªåŒä¸€ä¸ª ScenePlannerï¼‰
- è§’è‰²å¤–è§‚ scene_ids ä¸é•œå¤´ scene_id å®Œç¾åŒ¹é…
- åœºæ™¯ä¸Šä¸‹æ–‡å¢å¼ºäº†ç¯å¢ƒä¸€è‡´æ€§
```

### å‘åå…¼å®¹æœºåˆ¶ ğŸ†•

```
æ—§æ ¼å¼è§’è‰²æ•°æ®:
CharacterInScene(
    dynamic_features="Black suit"  # å•ä¸€åŠ¨æ€ç‰¹å¾
)

è‡ªåŠ¨è¿ç§»ä¸º:
CharacterInScene(
    dynamic_features="",  # æ ‡è®°ä¸ºdeprecated
    appearances=[
        CharacterAppearance(
            appearance_id="appearance_0",
            scene_ids=[],  # ç©º=é€‚ç”¨æ‰€æœ‰åœºæ™¯
            dynamic_features="Black suit"
        )
    ]
)
```

### Idea2Video Pipeline

åœ¨ Script2Video ä¹‹å‰å¢åŠ ï¼š

```
1. å‘å±•æ•…äº‹ (Develop Story)
   â†“
2. ç¼–å†™å‰§æœ¬ (Write Script)
   â†“
3. [å¯¹æ¯ä¸ªåœºæ™¯æ‰§è¡Œ Script2Video Pipeline] ğŸ†• åœºæ™¯æ„ŸçŸ¥
   â†“
4. æ‹¼æ¥åœºæ™¯è§†é¢‘
```

### å…³é”®è®¾è®¡ç‰¹ç‚¹

#### ç¼“å­˜æœºåˆ¶

- æ¯ä¸ªé˜¶æ®µçš„è¾“å‡ºéƒ½ä¿å­˜ä¸º JSON/å›¾ç‰‡/è§†é¢‘æ–‡ä»¶
- é‡æ–°è¿è¡Œæ—¶ä¼šè·³è¿‡å·²å®Œæˆçš„æ­¥éª¤
- ä¾¿äºè°ƒè¯•å’Œå¢é‡ç”Ÿæˆ
- **ğŸ†• åµŒå¥—ç›®å½•ç»“æ„**: å¤šå¤–è§‚è‚–åƒä½¿ç”¨ `{appearance_id}/` å­ç›®å½•

#### å¼‚æ­¥å¹¶è¡Œ

- å¤§é‡ä½¿ç”¨ `asyncio.gather()` å¹¶è¡Œå¤„ç†
- ä½¿ç”¨ `asyncio.Event()` ç®¡ç†ä¾èµ–å…³ç³»
- ä¾‹å¦‚ï¼šå¤šä¸ªé•œå¤´çš„å¸§å¯ä»¥å¹¶è¡Œç”Ÿæˆ
- **ğŸ†• æ‰¹é‡å¤–è§‚ç”Ÿæˆ**: `generate_all_appearances_for_character()` å¹¶è¡Œç”Ÿæˆ

#### ä¼˜å…ˆçº§ç³»ç»Ÿ

- priority_shot_idxsï¼šæ ‡è®°ä½œä¸ºå…¶ä»–é•œå¤´çˆ¶é•œå¤´çš„é‡è¦é•œå¤´
- ä¼˜å…ˆç”Ÿæˆè¿™äº›é•œå¤´çš„é¦–å¸§ï¼Œè§£é™¤ä¸‹æ¸¸ä¾èµ–

#### å®¹é”™è®¾è®¡

- å„ Agent éƒ½æœ‰é‡è¯•æœºåˆ¶ï¼ˆé€šå¸¸ 3 æ¬¡ï¼‰
- é™çº§ç­–ç•¥ï¼ˆä¾‹å¦‚å¤šæ¨¡æ€å¤±è´¥é™çº§ä¸ºçº¯æ–‡æœ¬ï¼‰
- è¿ç»­æ€§æ£€æŸ¥å¤±è´¥ä¼šç»ˆæ­¢ç”Ÿæˆï¼ˆé¿å…æµªè´¹èµ„æºï¼‰
- **ğŸ†• å‘åå…¼å®¹**: scene_id=None æ—¶è·³è¿‡å¤–è§‚è¿‡æ»¤

#### åœºæ™¯ç®¡ç† ğŸ†•

- **ğŸ†• ç»Ÿä¸€åœºæ™¯è§„åˆ’**: ScenePlanner æå‰åˆ†æå‰§æœ¬å¹¶å®šä¹‰æ‰€æœ‰åœºæ™¯
- **ğŸ†• åœºæ™¯å®šä¹‰ä¼ æ’­**: CharacterExtractor å’Œ StoryboardArtist éƒ½æ¥æ”¶ç»Ÿä¸€çš„åœºæ™¯å®šä¹‰
- **ğŸ†• ä¸€è‡´æ€§ä¿è¯**: æ‰€æœ‰ Agent ä½¿ç”¨ç›¸åŒçš„ scene_id å®šä¹‰ï¼Œé¿å…åœºæ™¯ ID ä¸åŒ¹é…
- **ğŸ†• åœºæ™¯ä¸Šä¸‹æ–‡æ³¨å…¥**: ReferenceImageSelector åœ¨æç¤ºè¯ä¸­æ³¨å…¥åœºæ™¯ç¯å¢ƒä¿¡æ¯
- **åœºæ™¯è¿½è¸ª**: æ¯ä¸ª ShotDescription éƒ½å¸¦æœ‰ scene_id
- **å¤–è§‚æ˜ å°„**: CharacterAppearance.scene_ids å®šä¹‰é€‚ç”¨èŒƒå›´
- **è‡ªåŠ¨è¿‡æ»¤**: ReferenceImageSelector æ ¹æ® scene_id è‡ªåŠ¨é€‰æ‹©æ­£ç¡®å¤–è§‚

---

## 9. ä¼˜åŒ–å»ºè®®æ€»ç»“

### æ¶æ„å±‚é¢

#### âœ… å·²æœ‰ä¼˜åŠ¿

1. **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ª Agent èŒè´£å•ä¸€æ˜ç¡®
2. **ç¼“å­˜ç³»ç»Ÿ**: é¿å…é‡å¤è®¡ç®—ï¼Œæ”¯æŒå¢é‡ç”Ÿæˆ
3. **å¼‚æ­¥å¹¶è¡Œ**: å……åˆ†åˆ©ç”¨ I/O ç­‰å¾…æ—¶é—´
4. **ä¸“ä¸šæ€§**: æ·±åº¦ç»“åˆç”µå½±åˆ¶ä½œç†è®º
5. **ğŸ†• å¤šå¤–è§‚ç³»ç»Ÿ**: å®Œæ•´æ”¯æŒè§’è‰²åœ¨ä¸åŒåœºæ™¯çš„å¤–è§‚å˜åŒ–
6. **ğŸ†• åœºæ™¯æ„ŸçŸ¥**: è‡ªåŠ¨è¯†åˆ«åœºæ™¯å¹¶è¿‡æ»¤è§’è‰²å¤–è§‚
7. **ğŸ†• å‘åå…¼å®¹**: ä¼˜é›…å¤„ç†æ—§æ ¼å¼æ•°æ®

#### ğŸ”„ å¯ä¼˜åŒ–æ–¹å‘

1. **è´¨é‡è¯„ä¼°ä½“ç³»**

   - åœ¨å¤šä¸ªé˜¶æ®µå¼•å…¥è´¨é‡è¯„åˆ†
   - è‡ªåŠ¨æ£€æµ‹å¹¶æ ‡è®°"å¯ç–‘"è¾“å‡º
   - å»ºç«‹åé¦ˆå¾ªç¯ï¼šè´¨é‡ä¸ä½³æ—¶è‡ªåŠ¨é‡è¯•æˆ–è°ƒæ•´å‚æ•°
   - **ğŸ†• å¤–è§‚ä¸€è‡´æ€§éªŒè¯**: æ£€æµ‹ç”Ÿæˆå›¾åƒæ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„è§’è‰²å¤–è§‚

2. **ç”¨æˆ·äº¤äº’å¢å¼º**

   - åœ¨å…³é”®èŠ‚ç‚¹æä¾›é¢„è§ˆå’Œç¡®è®¤æœºåˆ¶
   - å…è®¸ç”¨æˆ·å¾®è°ƒæŸäº›å‚æ•°ï¼ˆä¾‹å¦‚é•œå¤´æ•°é‡ã€èŠ‚å¥ç­‰ï¼‰
   - æä¾›"å¿«é€Ÿé¢„è§ˆ"æ¨¡å¼ï¼ˆä½è´¨é‡å¿«é€Ÿç”Ÿæˆï¼‰
   - **ğŸ†• å¤–è§‚ç¼–è¾‘ç•Œé¢**: å…è®¸ç”¨æˆ·æ‰‹åŠ¨è°ƒæ•´è§’è‰²å¤–è§‚åˆ†é…

3. **æˆæœ¬ä¼˜åŒ–**

   - æ™ºèƒ½é¢„ç®—åˆ†é…ï¼ˆé‡è¦é•œå¤´é«˜è´¨é‡ï¼Œæ¬¡è¦é•œå¤´é™ä½è´¨é‡ï¼‰
   - å‚è€ƒå›¾é€‰æ‹©å¯ä»¥ä½¿ç”¨æ›´ä¾¿å®œçš„ embedding æ¨¡å‹é¢„ç­›é€‰
   - å€™é€‰å›¾æ•°é‡å¯ä»¥æ ¹æ®é‡è¦æ€§åŠ¨æ€è°ƒæ•´
   - **ğŸ†• å¤–è§‚å¤ç”¨**: æ£€æµ‹ç›¸ä¼¼å¤–è§‚ï¼Œé¿å…é‡å¤ç”Ÿæˆ

4. **ä¸€è‡´æ€§å¢å¼º**

   - å»ºç«‹å…¨å±€"è®°å¿†ç³»ç»Ÿ"ï¼Œè¿½è¸ªè§’è‰²çŠ¶æ€å˜åŒ–
   - å¢å¼ºè§’è‰²å¤–è²Œä¸€è‡´æ€§éªŒè¯ï¼ˆäººè„¸è¯†åˆ«ã€æœè£…æ£€æµ‹ç­‰ï¼‰
   - åœºæ™¯å…ƒç´ ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆé“å…·ã€ç¯å¢ƒç­‰ï¼‰
   - **âœ… å·²å®ç°**: å¤šå¤–è§‚ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†è§’è‰²åœ¨ä¸åŒåœºæ™¯çš„å¤–è§‚ä¸€è‡´æ€§
   - **âœ… P1-P5 ä¸€è‡´æ€§ä¼˜åŒ–** (v1.2):
     - âœ… P1: åœºæ™¯ç¯å¢ƒå‚è€ƒå¸§æ”¶é›†ä¸æ³¨å…¥
     - âœ… P2: ç›¸æœºæ—¶åºæ§åˆ¶ï¼ˆç¡®ä¿é¦–å¸§é¡ºåºï¼‰
     - âœ… P5: BestImageSelector ç¯å¢ƒæƒé‡ä¼˜åŒ–ï¼ˆ40%ï¼‰
     - âœ… P3: åœºæ™¯å®šä¹‰éªŒè¯
     - âœ… P4: è§†é¢‘ç”Ÿæˆå®¹é”™ä¸è¶…æ—¶æ§åˆ¶

5. **åˆ›æ„æ§åˆ¶**

   - æ”¯æŒ"å…³é”®å¸§é”å®š"ï¼ˆç”¨æˆ·æä¾›æŸäº›å…³é”®ç”»é¢ï¼‰
   - é£æ ¼è¿ç§»æ›´ç»†ç²’åº¦æ§åˆ¶
   - æ”¯æŒåˆ†å±‚é£æ ¼ï¼ˆè§’è‰²ä¸€ç§é£æ ¼ï¼ŒèƒŒæ™¯å¦ä¸€ç§é£æ ¼ï¼‰
   - **ğŸ†• å¤–è§‚æ¨¡æ¿**: é¢„å®šä¹‰å¸¸è§å¤–è§‚ç»„åˆï¼ˆæ­£å¼è£…ã€ä¼‘é—²è£…ç­‰ï¼‰

6. **æ€§èƒ½ç›‘æ§**
   - æ·»åŠ è¯¦ç»†çš„è€—æ—¶ç»Ÿè®¡
   - è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
   - è‡ªåŠ¨ä¼˜åŒ–æ‰§è¡Œç­–ç•¥
   - **ğŸ†• å¤–è§‚ç”Ÿæˆç»Ÿè®¡**: è¿½è¸ªæ¯ä¸ªå¤–è§‚çš„ç”Ÿæˆæ—¶é—´å’ŒæˆåŠŸç‡

### å…·ä½“ Agent ä¼˜åŒ–ä¼˜å…ˆçº§

| Agent                       | ä¼˜å…ˆçº§  | å»ºè®®ä¼˜åŒ–ç‚¹                                       | ğŸ†• å·²å®Œæˆä¼˜åŒ–                                                         |
| --------------------------- | ------- | ------------------------------------------------ | --------------------------------------------------------------------- |
| ScenePlanner                | âœ… å®Œæˆ | ~~åœºæ™¯è¾¹ç•Œè¯†åˆ«~~ã€~~åœºæ™¯å®šä¹‰ç”Ÿæˆ~~               | âœ… ç»Ÿä¸€åœºæ™¯è§„åˆ’ã€âœ… åœºæ™¯å®šä¹‰ä¼ æ’­ã€âœ… scene_id åˆ†é…                    |
| CharacterExtractor          | âœ… å®Œæˆ | ~~è§’è‰²å…³ç³»å›¾è°±~~ã€~~æœè£…å˜åŒ–è¿½è¸ª~~               | âœ… å¤šå¤–è§‚è¯†åˆ«ã€âœ… åœºæ™¯æ˜ å°„ã€âœ… æƒ…ç»ªè¿½è¸ªã€âœ… æ¥æ”¶åœºæ™¯å®šä¹‰              |
| CharacterPortraitsGenerator | âœ… å®Œæˆ | ~~è¡¨æƒ…å˜ä½“~~ã€~~æ‰¹é‡ç”Ÿæˆ~~                       | âœ… æƒ…ç»ªè¡¨æƒ…ç³»ç»Ÿã€âœ… æ‰¹é‡æ¥å£ã€âœ… å¤šå¤–è§‚ç”Ÿæˆ                           |
| ReferenceImageSelector      | âœ… å®Œæˆ | ~~å¤–è§‚è¿‡æ»¤~~ã€~~åœºæ™¯ç¯å¢ƒä¸€è‡´æ€§~~ã€å‚è€ƒå›¾æƒé‡ç³»ç»Ÿ | âœ… åœºæ™¯æ„ŸçŸ¥è¿‡æ»¤ã€âœ… å¤–è§‚åŒ¹é…ã€âœ… åœºæ™¯ä¸Šä¸‹æ–‡æ³¨å…¥ã€âœ… P1 ç¯å¢ƒå‚è€ƒå¸§æ”¶é›† |
| StoryboardArtist            | âœ… å®Œæˆ | ~~åœºæ™¯è¯†åˆ«~~ã€æ™¯æ·±/å…‰çº¿ä¿¡æ¯ã€é•œå¤´ä¼˜å…ˆçº§          | âœ… åœºæ™¯ ID åˆ†é…ã€âœ… å¤šåœºæ™¯æ”¯æŒã€âœ… æ¥æ”¶åœºæ™¯å®šä¹‰                       |
| BestImageSelector           | âœ… å®Œæˆ | ~~ç¯å¢ƒæƒé‡ä¼˜åŒ–~~ã€å¢åŠ å€™é€‰æ•°é‡ã€å¼•å…¥è‡ªåŠ¨æŒ‡æ ‡     | âœ… P5 ç¯å¢ƒä¸€è‡´æ€§æƒé‡ 40%                                              |
| Pipeline (Script2Video)     | âœ… å®Œæˆ | ~~æ—¶åºæ§åˆ¶~~ã€~~å®¹é”™æœºåˆ¶~~ã€æ€§èƒ½ç›‘æ§             | âœ… P2 ç›¸æœºæ—¶åºã€âœ… P3 åœºæ™¯éªŒè¯ã€âœ… P4 è§†é¢‘ç”Ÿæˆå®¹é”™                    |
| CameraImageGenerator        | ğŸŸ¡ ä¸­   | é•œå¤´å¯è¡Œæ€§é¢„æ£€æŸ¥ã€è¯„åˆ†æƒé‡ä¼˜åŒ–                   | -                                                                     |
| Screenwriter                | ğŸŸ¢ ä½   | ä¸€è‡´æ€§æ£€æŸ¥ã€ç±»å‹æ¨¡æ¿                             | -                                                                     |

### å¤šå¤–è§‚ç³»ç»Ÿä¸åœºæ™¯è§„åˆ’ç›¸å…³ä¼˜åŒ– ğŸ†•

#### âœ… å·²å®Œæˆ (v1.1)

1. **åœºæ™¯è§„åˆ’å±‚** ğŸ†•:

   - âœ… `SceneDefinition` æ¥å£å®šä¹‰
   - âœ… ScenePlanner Agent å®ç°
   - âœ… ç»Ÿä¸€åœºæ™¯å®šä¹‰ (scenes.json)
   - âœ… åœºæ™¯ä¸Šä¸‹æ–‡ä¼ æ’­æœºåˆ¶

2. **æ•°æ®ç»“æ„å±‚**:

   - âœ… `CharacterAppearance` ç±»å®šä¹‰
   - âœ… `CharacterInScene` æ”¯æŒå¤šå¤–è§‚
   - âœ… `ShotDescription` åŒ…å« `scene_id`
   - âœ… å‘åå…¼å®¹çš„è‡ªåŠ¨è¿ç§»æœºåˆ¶

3. **Agent å±‚**:

   - âœ… ScenePlanner åœºæ™¯è§„åˆ’ï¼ˆæ–°å¢ï¼‰ğŸ†•
   - âœ… CharacterExtractor å¤šå¤–è§‚æå– + æ¥æ”¶åœºæ™¯å®šä¹‰ ğŸ†•
   - âœ… CharacterPortraitsGenerator æ‰¹é‡å¤–è§‚ç”Ÿæˆ
   - âœ… ReferenceImageSelector åœºæ™¯å¤–è§‚è¿‡æ»¤ + åœºæ™¯ä¸Šä¸‹æ–‡æ³¨å…¥ ğŸ†•
   - âœ… StoryboardArtist åœºæ™¯ ID åˆ†é… + æ¥æ”¶åœºæ™¯å®šä¹‰ ğŸ†•

4. **Pipeline å±‚**:

   - âœ… åœºæ™¯è§„åˆ’å‰ç½®æµç¨‹ ğŸ†•
   - âœ… scenes_dict å­˜å‚¨ä¸ä¼ æ’­ ğŸ†•
   - âœ… åµŒå¥—ç›®å½•ç»“æ„æ”¯æŒ
   - âœ… åœºæ™¯æ„ŸçŸ¥çš„å‚è€ƒå›¾é€‰æ‹©
   - âœ… å®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•

5. **ä¸€è‡´æ€§ä¿è¯** ğŸ†•:
   - âœ… scene_id åœ¨æ‰€æœ‰ Agent é—´ç»Ÿä¸€
   - âœ… åœºæ™¯ç¯å¢ƒä¸Šä¸‹æ–‡æ³¨å…¥ï¼ˆçŸ­æœŸæ–¹æ¡ˆï¼‰
   - ğŸ“‹ åœºæ™¯å‚è€ƒå›¾ç”Ÿæˆï¼ˆé•¿æœŸæ–¹æ¡ˆï¼Œå·²è®°å½•åœ¨ TODO.mdï¼‰

#### ğŸ”„ å¾…ä¼˜åŒ– (v2.0)

1. **æ™ºèƒ½å¤–è§‚ç®¡ç†**:

   - å¤–è§‚ç›¸ä¼¼åº¦æ£€æµ‹ï¼ˆé¿å…é‡å¤ç”Ÿæˆï¼‰
   - å¤–è§‚è‡ªåŠ¨è¡¥å…¨ï¼ˆæ¨æ–­ç¼ºå¤±åœºæ™¯çš„å¤–è§‚ï¼‰
   - å¤–è§‚ç»§æ‰¿æœºåˆ¶ï¼ˆæ–°åœºæ™¯é»˜è®¤ä½¿ç”¨ä¸Šä¸€åœºæ™¯çš„å¤–è§‚ï¼‰

2. **é«˜çº§å¤–è§‚ç‰¹æ€§**:

   - æ¸å˜å¤–è§‚ï¼ˆä»ä¸€ä¸ªå¤–è§‚å¹³æ»‘è¿‡æ¸¡åˆ°å¦ä¸€ä¸ªï¼‰
   - éƒ¨åˆ†å¤–è§‚å˜åŒ–ï¼ˆåªæ¢ä¸Šè¡£ï¼Œä¿æŒè£¤å­ï¼‰
   - å¤–è§‚ç»„åˆï¼ˆåŸºç¡€å¤–è§‚ + é…é¥°ï¼‰

3. **ç”¨æˆ·ä½“éªŒ**:

   - å¤–è§‚å¯è§†åŒ–é¢„è§ˆ
   - å¤–è§‚ç¼–è¾‘å™¨ï¼ˆæ‹–æ‹½è°ƒæ•´åœºæ™¯åˆ†é…ï¼‰
   - å¤–è§‚æ¨¡æ¿åº“

4. **è´¨é‡ä¿è¯**:
   - å¤–è§‚ä¸€è‡´æ€§è‡ªåŠ¨éªŒè¯ï¼ˆäººè„¸è¯†åˆ«ã€æœè£…æ£€æµ‹ï¼‰
   - åœºæ™¯è½¬æ¢åˆç†æ€§æ£€æŸ¥ï¼ˆè¥¿è£… â†’ è¿åŠ¨æœéœ€è¦åˆç†ç†ç”±ï¼‰
   - å¤–è§‚ç”Ÿæˆè´¨é‡è¯„åˆ†

---

## 10. ä¸€è‡´æ€§ä¼˜åŒ–ç³»ç»Ÿ (v1.2) ğŸ†•

åŸºäº `docs/history_enhance/CONSISTENCY_ISSUES_ANALYSIS.md` çš„é—®é¢˜åˆ†æï¼Œå®ç°äº†ä¸€å¥—å®Œæ•´çš„ä¸€è‡´æ€§ä¼˜åŒ–æ–¹æ¡ˆã€‚

### P1 ä¼˜åŒ–: åœºæ™¯ç¯å¢ƒå‚è€ƒå¸§æ”¶é›† âœ…

**é—®é¢˜**: åœºæ™¯å†…ç¯å¢ƒå…ƒç´ ï¼ˆé“å…·ã€å®¶å…·ã€å¸ƒå±€ï¼‰ä¸è¿è´¯

**è§£å†³æ–¹æ¡ˆ**: åŠ¨æ€æ”¶é›†åŒåœºæ™¯å·²å®Œæˆçš„å¸§ä½œä¸ºç¯å¢ƒå‚è€ƒ

**å®ç°ä½ç½®**: `pipelines/script2video_pipeline.py`

```python
def collect_completed_frames_for_scene(
    self,
    scene_id: Optional[int],
    current_shot_idx: int,
    shot_descriptions: List[ShotDescription]
) -> List[Tuple[str, str]]:
    """æ”¶é›†åŒåœºæ™¯å·²å®Œæˆçš„å¸§ä½œä¸ºç¯å¢ƒå‚è€ƒ"""
    if scene_id is None:
        return []

    completed_frames = []
    for shot in shot_descriptions:
        # åŒåœºæ™¯ + ä¸æ˜¯å½“å‰é•œå¤´ + æ–‡ä»¶å­˜åœ¨
        if shot.scene_id == scene_id and shot.idx != current_shot_idx:
            for frame_type in ["first_frame", "last_frame"]:
                frame_path = os.path.join(
                    self.working_dir, "shots", str(shot.idx), f"{frame_type}.png"
                )
                if os.path.exists(frame_path):
                    completed_frames.append((frame_path, f"Scene {scene_id} frame"))

    # æ’åºå¹¶é™åˆ¶æ•°é‡
    completed_frames.sort(key=lambda x: (scene_id, shot.idx))
    return completed_frames[:5]  # æœ€å¤š5ä¸ªå‚è€ƒå¸§
```

**è°ƒç”¨ä½ç½®**: `generate_frame_for_single_shot()` ä¸­ï¼Œåœ¨è°ƒç”¨ `ReferenceImageSelector` ä¹‹å‰

**æ•ˆæœ**:

- åŒåœºæ™¯çš„å’–å•¡æ¯ä½ç½®ä¿æŒä¸€è‡´
- å®¶å…·ã€çª—æˆ·ç­‰ç¯å¢ƒå…ƒç´ è¿è´¯
- å…‰çº¿å’Œè‰²è°ƒç»Ÿä¸€

---

### P2 ä¼˜åŒ–: ç›¸æœºæ—¶åºæ§åˆ¶ âœ…

**é—®é¢˜**: åç»­é•œå¤´å…ˆå®Œæˆï¼Œå¯¼è‡´ç¼ºå°‘ç¯å¢ƒå‚è€ƒ

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ç¬¬ä¸€ä¸ªé•œå¤´çš„æœ«å¸§ä¼˜å…ˆå®Œæˆ

**å®ç°ä½ç½®**: `pipelines/script2video_pipeline.py`

```python
async def generate_frames_for_single_camera(...):
    # è¯†åˆ«ç¬¬ä¸€ä¸ªé•œå¤´
    first_shot_idx = camera.active_shot_idxs[0]

    # å¦‚æœæ˜¯ä¼˜å…ˆçº§é•œå¤´çš„ç¬¬ä¸€ä¸ªé•œå¤´ï¼Œç­‰å¾…å…¶æœ«å¸§å®Œæˆ
    if first_shot_idx in priority_shot_idxs:
        print(f"âœ¨ P2ä¼˜åŒ–: é•œå¤´ {first_shot_idx} æ˜¯ä¼˜å…ˆçº§é•œå¤´ï¼Œç¡®ä¿æœ«å¸§ä¼˜å…ˆå®Œæˆ")
        # å…ˆç”Ÿæˆé¦–å¸§å’Œæœ«å¸§
        await generate_first_and_last_frame(first_shot_idx)
        # ç­‰å¾…æœ«å¸§ Event
        await self.frame_events[first_shot_idx]["last_frame"].wait()
```

**æ•ˆæœ**:

- ç¯å¢ƒå‚è€ƒå¸§æŒ‰æ­£ç¡®é¡ºåºç”Ÿæˆ
- P1 ä¼˜åŒ–èƒ½è·å–åˆ°æœ‰æ•ˆçš„å‚è€ƒå¸§
- åœºæ™¯ä¸€è‡´æ€§æ˜¾è‘—æå‡

---

### P5 ä¼˜åŒ–: BestImageSelector ç¯å¢ƒæƒé‡ä¼˜åŒ– âœ…

**é—®é¢˜**: é€‰å›¾æ—¶è¿‡åº¦å…³æ³¨è§’è‰²ï¼Œå¿½ç•¥ç¯å¢ƒä¸€è‡´æ€§

**è§£å†³æ–¹æ¡ˆ**: é‡æ–°è°ƒæ•´è¯„ä¼°æƒé‡ï¼Œç¯å¢ƒä¸€è‡´æ€§ä¼˜å…ˆ

**å®ç°ä½ç½®**: `agents/best_image_selector.py`

**æƒé‡è°ƒæ•´**:

```python
# ä¼˜åŒ–å‰
è§’è‰²ä¸€è‡´æ€§: æœ€é«˜ä¼˜å…ˆçº§
ç¯å¢ƒå› ç´ : è¾ƒä½æƒé‡

# ä¼˜åŒ–å
ç¯å¢ƒä¸€è‡´æ€§: 40%  # æœ€é«˜
è§’è‰²ä¸€è‡´æ€§: 30%
æè¿°å‡†ç¡®æ€§: 20%
ç©ºé—´ä¸€è‡´æ€§: 10%
```

**æç¤ºè¯æ›´æ–°**:

```python
system_prompt_template_select_most_consistent_image = """
1. Environment Consistency (40% weight) - HIGHEST PRIORITY
   - Scene location matching
   - Lighting conditions consistency
   - Overall atmosphere and tone
   - Props and furniture continuity

2. Character Consistency (30% weight)
   - Gender, ethnicity, age
   - Facial features, body type
   - Clothing, hairstyle

3. Description Accuracy (20% weight)
   ...
```

**æ•ˆæœ**:

- ä¼˜å…ˆé€‰æ‹©ç¯å¢ƒåŒ¹é…çš„å€™é€‰å›¾
- é“å…·ä½ç½®æ›´è¿è´¯
- è§†è§‰é£æ ¼æ›´ç»Ÿä¸€

---

### P3 ä¼˜åŒ–: åœºæ™¯å®šä¹‰éªŒè¯ âœ…

**é—®é¢˜**: é•œå¤´ç¼ºå°‘ scene_id å¯¼è‡´è¿‡æ»¤å¤±æ•ˆ

**è§£å†³æ–¹æ¡ˆ**: ç”Ÿæˆå¸§å‰éªŒè¯åœºæ™¯å®šä¹‰

**å®ç°ä½ç½®**: `pipelines/script2video_pipeline.py`

```python
# åœ¨ç”Ÿæˆå¸§ä¹‹å‰éªŒè¯
scene_definition = self.scenes_dict.get(shot_description.scene_id)
if not scene_definition:
    logger.warning(f"âš ï¸ P3è­¦å‘Š: é•œå¤´ {shot.idx} æ²¡æœ‰å…³è”çš„åœºæ™¯ID")
```

**æ•ˆæœ**:

- åŠæ—©å‘ç°é…ç½®é—®é¢˜
- æä¾›æ¸…æ™°çš„è­¦å‘Šæ—¥å¿—
- é¿å…é™é»˜å¤±è´¥

---

### P4 ä¼˜åŒ–: è§†é¢‘ç”Ÿæˆå®¹é”™æœºåˆ¶ âœ…

**é—®é¢˜**: è§†é¢‘ç”Ÿæˆå¤±è´¥å¯¼è‡´æ•´ä¸ªæµç¨‹ä¸­æ–­

**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ è¶…æ—¶æ§åˆ¶å’Œé”™è¯¯å¤„ç†

**å®ç°ä½ç½®**: `pipelines/script2video_pipeline.py`

```python
try:
    # 10åˆ†é’Ÿè¶…æ—¶
    video_output = await asyncio.wait_for(
        self.video_generator.generate_single_video(...),
        timeout=600
    )

    # éªŒè¯æ–‡ä»¶å­˜åœ¨
    if not os.path.exists(video_path):
        logger.error(f"âŒ è§†é¢‘æ–‡ä»¶æœªç”Ÿæˆ: {video_path}")
        return

except asyncio.TimeoutError:
    logger.error(f"âŒ è§†é¢‘ç”Ÿæˆè¶…æ—¶ (10åˆ†é’Ÿ)")
except Exception as e:
    logger.error(f"âŒ è§†é¢‘ç”Ÿæˆå¤±è´¥: {e}")
```

**æ•ˆæœ**:

- é¿å…æ— é™ç­‰å¾…
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- ä¸å½±å“å·²å®Œæˆçš„å¸§

---

### ä¼˜åŒ–æ•ˆæœæ€»ç»“

| ä¼˜åŒ–é¡¹ | é—®é¢˜         | è§£å†³æ–¹æ¡ˆ             | çŠ¶æ€      |
| ------ | ------------ | -------------------- | --------- |
| P1     | ç¯å¢ƒä¸ä¸€è‡´   | åŠ¨æ€æ”¶é›†åŒåœºæ™¯å‚è€ƒå¸§ | âœ… å·²å®ç° |
| P2     | æ—¶åºæ··ä¹±     | ç›¸æœºé¦–å¸§ä¼˜å…ˆå®Œæˆ     | âœ… å·²å®ç° |
| P5     | é€‰å›¾åå‘è§’è‰² | ç¯å¢ƒæƒé‡æå‡è‡³ 40%   | âœ… å·²å®ç° |
| P3     | ç¼ºå°‘åœºæ™¯å®šä¹‰ | ç”Ÿæˆå‰éªŒè¯ scene_id  | âœ… å·²å®ç° |
| P4     | è§†é¢‘ç”Ÿæˆé˜»å¡ | è¶…æ—¶å’Œå®¹é”™æœºåˆ¶       | âœ… å·²å®ç° |

**æ•´ä½“æå‡**:

- åœºæ™¯ç¯å¢ƒä¸€è‡´æ€§æ˜¾è‘—æå‡ï¼ˆP1 + P5ï¼‰
- ç”Ÿæˆé¡ºåºæ›´åˆç†ï¼ˆP2ï¼‰
- ç³»ç»Ÿé²æ£’æ€§å¢å¼ºï¼ˆP3 + P4ï¼‰

**æ—¥å¿—æ ‡è®°**:

- `âœ¨ P1ä¼˜åŒ–`: ç¯å¢ƒå‚è€ƒå¸§æ·»åŠ 
- `âœ¨ P2ä¼˜åŒ–`: æ—¶åºæ§åˆ¶ç”Ÿæ•ˆ
- `âš ï¸ P3è­¦å‘Š`: åœºæ™¯å®šä¹‰ç¼ºå¤±
- `âŒ P4é”™è¯¯`: è§†é¢‘ç”Ÿæˆå¤±è´¥

---

## æ€»ç»“

ViMax çš„ Agent ç³»ç»Ÿè®¾è®¡ä½“ç°äº†æ·±åšçš„ç”µå½±åˆ¶ä½œç†è®ºåŠŸåº•ï¼Œä»æ•…äº‹åˆ›ä½œåˆ°æœ€ç»ˆè§†é¢‘æ¸²æŸ“çš„å…¨æµç¨‹éƒ½æœ‰å®Œå–„çš„æ”¯æŒã€‚

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š

- ä¸“ä¸šçš„ç”µå½±è¯­è¨€æ”¯æŒï¼ˆ180 åº¦æ³•åˆ™ã€é•œå¤´è¯­è¨€ç­‰ï¼‰
- å®Œå–„çš„ä¸€è‡´æ€§ä¿è¯æœºåˆ¶ï¼ˆè§’è‰²è‚–åƒã€å‚è€ƒå›¾ç³»ç»Ÿï¼‰
- é«˜æ•ˆçš„å¹¶è¡Œå¤„ç†å’Œç¼“å­˜è®¾è®¡
- **ğŸ†• ç»Ÿä¸€åœºæ™¯è§„åˆ’ç³»ç»Ÿ**: ScenePlanner å‰ç½®è§„åˆ’ï¼Œç¡®ä¿ scene_id åœ¨æ‰€æœ‰ Agent é—´ä¸€è‡´
- **ğŸ†• å®Œæ•´çš„å¤šå¤–è§‚ç³»ç»Ÿ**: è‡ªåŠ¨ç®¡ç†è§’è‰²åœ¨ä¸åŒåœºæ™¯çš„å¤–è§‚å˜åŒ–
- **ğŸ†• åœºæ™¯æ„ŸçŸ¥è¿‡æ»¤**: æ™ºèƒ½é€‰æ‹©é€‚åˆå½“å‰åœºæ™¯çš„è§’è‰²å¤–è§‚
- **ğŸ†• åœºæ™¯ç¯å¢ƒä¸€è‡´æ€§**: é€šè¿‡åœºæ™¯ä¸Šä¸‹æ–‡æ³¨å…¥å¢å¼ºç¯å¢ƒæè¿°çš„ä¸€è‡´æ€§
- **ğŸ†• æƒ…ç»ªè¡¨æƒ…æ”¯æŒ**: ä¸ºä¸åŒæƒ…ç»ªçŠ¶æ€ç”Ÿæˆç›¸åº”çš„é¢éƒ¨è¡¨æƒ…
- **ğŸ†• P1-P5 ä¸€è‡´æ€§ä¼˜åŒ–** (v1.2): ç¯å¢ƒå‚è€ƒã€æ—¶åºæ§åˆ¶ã€é€‰å›¾ä¼˜åŒ–ã€éªŒè¯æœºåˆ¶ã€å®¹é”™å¤„ç†

**ä¸»è¦ä¼˜åŒ–ç©ºé—´**ï¼š

- è´¨é‡è¯„ä¼°å’Œè‡ªåŠ¨çº é”™
- ç”¨æˆ·äº¤äº’å’Œåˆ›æ„æ§åˆ¶
- æˆæœ¬å’Œæ€§èƒ½ä¼˜åŒ–
- **å¤–è§‚ç®¡ç†çš„é«˜çº§ç‰¹æ€§**ï¼ˆç›¸ä¼¼åº¦æ£€æµ‹ã€æ¸å˜ã€ç»§æ‰¿ç­‰ï¼‰
- **åœºæ™¯ç¯å¢ƒä¸€è‡´æ€§é•¿æœŸæ–¹æ¡ˆ**ï¼ˆåœºæ™¯å‚è€ƒå›¾ç”Ÿæˆï¼Œå·²è§„åˆ’åœ¨ TODO.mdï¼‰

è¿™ä¸ªç³»ç»Ÿå·²ç»å…·å¤‡äº†äº§å“åŒ–çš„åŸºç¡€ï¼Œ**ç»Ÿä¸€åœºæ™¯è§„åˆ’ç³»ç»Ÿï¼ˆv1.1ï¼‰**çš„å®Œæˆæ ‡å¿—ç€ç³»ç»Ÿåœ¨åœºæ™¯ç®¡ç†å’Œä¸€è‡´æ€§ä¿è¯æ–¹é¢è¾¾åˆ°äº†æ–°çš„é«˜åº¦ï¼Œè§£å†³äº† scene_id ä¸ä¸€è‡´çš„å…³é”®é—®é¢˜ï¼Œå¹¶ä¸ºåœºæ™¯ç¯å¢ƒä¸€è‡´æ€§å¥ å®šäº†åŸºç¡€ã€‚**ä¸€è‡´æ€§ä¼˜åŒ–ç³»ç»Ÿï¼ˆv1.2ï¼‰**è¿›ä¸€æ­¥è§£å†³äº†å¹¶å‘ç”Ÿæˆå¸¦æ¥çš„ç¯å¢ƒä¸ä¸€è‡´é—®é¢˜ï¼Œé€šè¿‡åŠ¨æ€å‚è€ƒå¸§æ”¶é›†ã€æ—¶åºæ§åˆ¶ã€é€‰å›¾ä¼˜åŒ–ç­‰æ‰‹æ®µï¼Œæ˜¾è‘—æå‡äº†ç”Ÿæˆè´¨é‡ã€‚å»ºè®®çš„ä¼˜åŒ–æ–¹å‘ä¸»è¦é›†ä¸­åœ¨**æå‡ç”Ÿæˆè´¨é‡ç¨³å®šæ€§**ã€**å¢å¼ºç”¨æˆ·ä½“éªŒ**ã€**æ‰©å±•å¤–è§‚ç³»ç»Ÿé«˜çº§åŠŸèƒ½**ä»¥åŠ**å®ç°åœºæ™¯å‚è€ƒå›¾é•¿æœŸæ–¹æ¡ˆ**å››ä¸ªæ–¹é¢ã€‚
