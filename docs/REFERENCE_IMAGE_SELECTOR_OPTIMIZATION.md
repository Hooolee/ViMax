# ReferenceImageSelector ä¼˜åŒ–æ–¹æ¡ˆ

## ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–æ˜¾è‘—ç®€åŒ–äº†å‚è€ƒå›¾åƒé€‰æ‹©æµç¨‹ï¼Œä» **9-15 å¼ ** å¤‡é€‰å›¾å‡å°‘åˆ° **2-4 å¼ **ï¼ŒåŒæ—¶æé«˜äº†ç²¾å‡†åº¦å’Œæ•ˆç‡ã€‚

## ä¸»è¦æ”¹è¿›

### 1. æ™ºèƒ½ä¸‰è§†å›¾é€‰æ‹© âœ…

#### ä¹‹å‰çš„é—®é¢˜

- ä¸ºæ¯ä¸ªè§’è‰²æ·»åŠ æ‰€æœ‰ä¸‰è§†å›¾ï¼ˆfront, side, backï¼‰
- LLM éœ€è¦ä» 3 å¼ å›¾ä¸­é€‰æ‹©åˆé€‚çš„è§†è§’
- å¢åŠ äº†ä¸å¿…è¦çš„è®¡ç®—å’Œ token æ¶ˆè€—

#### ä¼˜åŒ–æ–¹æ¡ˆ

åœ¨åˆ†é•œæ‹†è§£é˜¶æ®µæå–è§’è‰²æœå‘ä¿¡æ¯ï¼Œç„¶åç›´æ¥é€‰æ‹©å¯¹åº”çš„è§†è§’ã€‚

**æ•°æ®ç»“æ„å˜æ›´**ï¼š

```python
# interfaces/shot_description.py
class ShotDescription(BaseModel):
    ff_vis_char_idxs: List[int]  # å¯è§è§’è‰²ç´¢å¼•
    ff_char_orientations: Optional[Dict[int, Literal["front", "side", "back"]]]  # â† æ–°å¢

    lf_vis_char_idxs: List[int]
    lf_char_orientations: Optional[Dict[int, Literal["front", "side", "back"]]]  # â† æ–°å¢
```

**StoryboardArtist æ›´æ–°**ï¼š

```python
# agents/storyboard_artist.py
class VisDescDecompositionResponse(BaseModel):
    ff_char_orientations: Dict[int, Literal["front", "side", "back"]]  # â† æ–°å¢
    lf_char_orientations: Dict[int, Literal["front", "side", "back"]]  # â† æ–°å¢
```

ç³»ç»Ÿæç¤ºè¯æ›´æ–°ï¼Œè¦æ±‚ LLM è¯†åˆ«è§’è‰²æœå‘ï¼š

```
- **è§’è‰²æœå‘è¯†åˆ«**ï¼šå¯¹äºé¦–å¸§å’Œå°¾å¸§ä¸­çš„æ¯ä¸ªå¯è§è§’è‰²ï¼Œå¿…é¡»ç¡®å®šå…¶ç›¸å¯¹äºæ‘„åƒæœºçš„æœå‘ï¼š
  * 'front'ï¼ˆæ­£é¢ï¼‰ï¼šè§’è‰²é¢å‘æ‘„åƒæœºï¼Œå¯ä»¥çœ‹åˆ°æ­£è„¸
  * 'side'ï¼ˆä¾§é¢ï¼‰ï¼šè§’è‰²ä¾§å¯¹æ‘„åƒæœºï¼Œå‘ˆç°ä¾§è„¸/è½®å»“
  * 'back'ï¼ˆèƒŒé¢ï¼‰ï¼šè§’è‰²èƒŒå¯¹æ‘„åƒæœºï¼Œçœ‹ä¸åˆ°æ­£è„¸
```

**å¸§ç”Ÿæˆé€»è¾‘**ï¼š

```python
# pipelines/script2video_pipeline.py - generate_frame_for_single_shot()

# è·å–å½“å‰å¸§çš„è§’è‰²æœå‘ä¿¡æ¯
char_orientations = None
if frame_type == "first_frame":
    char_orientations = shot_descriptions[shot_idx].ff_char_orientations
elif frame_type == "last_frame":
    char_orientations = shot_descriptions[shot_idx].lf_char_orientations

# æ ¹æ®è§’è‰²æœå‘é€‰æ‹©å¯¹åº”çš„ä¸‰è§†å›¾
for visible_character in visible_characters:
    # ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªä¸ªè§†è§’
    desired_view = "front"  # é»˜è®¤æ­£é¢
    if char_orientations and char_idx in char_orientations:
        desired_view = char_orientations[char_idx]

    # åªé€‰æ‹©å¯¹åº”è§†è§’çš„å›¾åƒ
    if desired_view in content:
        item = content[desired_view]
        available_image_path_and_text_pairs.append((item["path"], item["description"]))
        logging.info(f"âœ… ä¼˜åŒ–: ä¸ºè§’è‰² {identifier} é€‰æ‹©äº† {desired_view} è§†è§’")
        break  # â† åªæ·»åŠ 1å¼ ï¼Œä¸æ˜¯3å¼ 
```

**æ•ˆæœ**ï¼š

- æ¯ä¸ªè§’è‰²ä» **3 å¼ å›¾** å‡å°‘åˆ° **1 å¼ å›¾**
- æ›´ç²¾å‡†çš„è§†è§’åŒ¹é…
- å‡å°‘çº¦ **67% çš„è§’è‰²è‚–åƒå›¾æ•°é‡**

---

### 2. ç®€åŒ–ç¯å¢ƒå‚è€ƒé€»è¾‘ âœ…

#### ä¹‹å‰çš„é—®é¢˜

- æ”¶é›†æœ€å¤š **5 ä¸ª** å·²å®Œæˆçš„å¸§
- åŒ…æ‹¬å„ç§é•œå¤´çš„é¦–å¸§å’Œæœ«å¸§
- å¯èƒ½åŒ…å«ä¸ç›¸å…³åœºæ™¯çš„å¸§
- å¤æ‚çš„æ’åºå’Œè¿‡æ»¤é€»è¾‘

#### ä¼˜åŒ–æ–¹æ¡ˆ

åªä½¿ç”¨å‰ä¸€ä¸ªé•œå¤´çš„å°¾å¸§ï¼ˆåŒåœºæ™¯æ—¶ï¼‰ã€‚

```python
# åªæ”¶é›†å‰ä¸€ä¸ªé•œå¤´çš„å°¾å¸§ï¼ˆå¦‚æœæ˜¯åŒåœºæ™¯ï¼‰
if shot_idx > 0:
    prev_shot_idx = shot_idx - 1
    prev_scene_id = shot_descriptions[prev_shot_idx].scene_id
    current_scene_id = shot_descriptions[shot_idx].scene_id

    # åªæœ‰åŒåœºæ™¯æ‰ä½¿ç”¨å‰ä¸€ä¸ªé•œå¤´çš„å¸§
    if prev_scene_id == current_scene_id:
        # ä¼˜å…ˆä½¿ç”¨æœ«å¸§ï¼ˆå¦‚æœæœ‰ï¼‰
        lf_path = os.path.join(self.working_dir, "shots", f"{prev_shot_idx}", "last_frame.png")
        if os.path.exists(lf_path):
            available_image_path_and_text_pairs.append((
                lf_path,
                f"Previous shot {prev_shot_idx} last frame (for temporal continuity)"
            ))
            logging.info(f"âœ… ä¼˜åŒ–: ä½¿ç”¨å‰ä¸€ä¸ªé•œå¤´ #{prev_shot_idx} çš„æœ«å¸§")
        else:
            # æ²¡æœ‰æœ«å¸§ï¼Œä½¿ç”¨é¦–å¸§
            ff_path = os.path.join(self.working_dir, "shots", f"{prev_shot_idx}", "first_frame.png")
            if os.path.exists(ff_path):
                available_image_path_and_text_pairs.append((
                    ff_path,
                    f"Previous shot {prev_shot_idx} first frame (for temporal continuity)"
                ))
    else:
        logging.info(f"âš ï¸ åœºæ™¯åˆ‡æ¢: ä¸ä½¿ç”¨å‰ä¸€é•œå¤´çš„å¸§")
```

**åœºæ™¯åˆ‡æ¢åˆ¤æ–­**ï¼š

- ä½¿ç”¨ `scene_id` å­—æ®µåˆ¤æ–­æ˜¯å¦åœºæ™¯åˆ‡æ¢
- åœºæ™¯åˆ‡æ¢æ—¶ï¼šä¸æ·»åŠ ä»»ä½•ç¯å¢ƒå‚è€ƒ
- åŒåœºæ™¯æ—¶ï¼šåªæ·»åŠ å‰ä¸€ä¸ªé•œå¤´çš„å¸§ï¼ˆ1 å¼ ï¼‰

**æ•ˆæœ**ï¼š

- ç¯å¢ƒå‚è€ƒä» **5 å¼ ** å‡å°‘åˆ° **0-1 å¼ **
- æ›´ç›´æ¥çš„æ—¶é—´è¿ç»­æ€§
- é¿å…è·¨åœºæ™¯çš„è§†è§‰å¹²æ‰°

---

### 3. ç§»é™¤ç¬¬ä¸€é•œå¤´é¦–å¸§å¼•ç”¨ï¼ˆå·²æ’¤å›ï¼‰âš ï¸

#### ä¹‹å‰çš„é—®é¢˜

```python
# æ€»æ˜¯åŒ…å«ç¬¬ä¸€ä¸ªé•œå¤´çš„é¦–å¸§
available_image_path_and_text_pairs.append(first_shot_ff_path_and_text_pair)
```

- æ—¶é—´ä¸Šå¯èƒ½ç›¸è·å¾ˆè¿œï¼ˆshot #10 è¿˜å¼•ç”¨ shot #0ï¼‰
- å¼•å…¥ä¸ç›¸å…³çš„è§†è§‰ä¿¡æ¯
- ä¸æ¸…æ¥šçš„è®¾è®¡æ„å›¾

#### âš ï¸ æ’¤å›åŸå› 

ç»è¿‡å½±å“è¯„ä¼°ï¼Œå‘ç°å®Œå…¨ç§»é™¤é¦–å¸§å¼•ç”¨ä¼šå¯¼è‡´ï¼š

1. **Camera å†…ç©ºé—´ä¸€è‡´æ€§å‡å¼±**ï¼šé•¿é•œå¤´åºåˆ—ï¼ˆå¦‚ shot #0 â†’ #3 â†’ #5 â†’ #8ï¼‰çš„æœ«å°¾é•œå¤´å¯èƒ½ä¸èµ·å§‹é•œå¤´ç©ºé—´ç‰¹å¾ä¸ä¸€è‡´
2. **"ç”µè¯ä¼ å£°"æ•ˆåº”**ï¼šæ¯ä¸ªé•œå¤´åªå¼•ç”¨å‰ä¸€ä¸ªï¼Œå¯èƒ½å¯¼è‡´è§†è§‰æ¼‚ç§»

#### ä¼˜åŒ–æ–¹æ¡ˆï¼šP4 æ¡ä»¶å¼•ç”¨æœºåˆ¶

é‡‡ç”¨**æ™ºèƒ½æ¡ä»¶å¼•ç”¨**ç­–ç•¥ï¼Œè€Œéå®Œå…¨ç§»é™¤ï¼š

```python
# P4 ä¼˜åŒ–ï¼šCamera ç©ºé—´ä¸€è‡´æ€§é”šç‚¹
# æ¡ä»¶ï¼š
# 1. ä¸æ˜¯é¦–é•œå¤´æœ¬èº«
# 2. é—´éš” >= 3ï¼ˆé¿å…ä¸ P1 ä¼˜åŒ–é‡å¤ï¼‰
# 3. åŒä¸€åœºæ™¯
# 4. é¦–å¸§å·²ç”Ÿæˆ
if (shot_idx != first_shot_idx
    and shot_gap >= 3
    and current_scene_id == first_shot_scene_id
    and os.path.exists(first_shot_ff_path)):

    available_image_path_and_text_pairs.append((
        first_shot_ff_path,
        f"Camera spatial anchor: first shot {first_shot_idx} first frame (for spatial consistency)"
    ))
    logging.info(f"âœ… P4ä¼˜åŒ–: é•œå¤´ #{shot_idx} è·ç¦»é¦–é•œå¤´ #{first_shot_idx} é—´éš”{shot_gap}ï¼Œæ·»åŠ Cameraç©ºé—´é”šç‚¹")
```

**è§¦å‘æ¡ä»¶**ï¼š

- âœ… å½“å‰é•œå¤´ä¸é¦–é•œå¤´é—´éš” â‰¥ 3ï¼ˆä¾‹å¦‚ shot #5 å¼•ç”¨ shot #0ï¼‰
- âœ… åœ¨åŒä¸€åœºæ™¯ï¼ˆé¿å…è·¨åœºæ™¯æ±¡æŸ“ï¼‰
- âŒ é—´éš” < 3 æ—¶ä¸å¼•ç”¨ï¼ˆç”± P1 ä¼˜åŒ–çš„"å‰ä¸€é•œå¤´å°¾å¸§"è¦†ç›–ï¼‰

**æ•ˆæœ**ï¼š

- ä¿ç•™äº† Camera çº§åˆ«çš„ç©ºé—´é”šç‚¹
- é¿å…äº†çŸ­è·ç¦»é•œå¤´çš„é‡å¤å¼•ç”¨
- ä¿æŒåœºæ™¯åˆ‡æ¢çš„éš”ç¦»æ€§

---

### 4. P4 ä¼˜åŒ–ï¼šCamera ç©ºé—´ä¸€è‡´æ€§é”šç‚¹ âœ…

#### è®¾è®¡ç›®æ ‡

è§£å†³é•¿é•œå¤´åºåˆ—ä¸­çš„ç©ºé—´æ¼‚ç§»é—®é¢˜ã€‚

#### å·¥ä½œåŸç†

| é•œå¤´é—´éš” | å¼•ç”¨ç­–ç•¥         | ç†ç”±                             |
| -------- | ---------------- | -------------------------------- |
| 0-2      | åªç”¨å‰ä¸€é•œå¤´å°¾å¸§ | æ—¶é—´è¿ç»­æ€§ä¼˜å…ˆï¼ˆP1 ä¼˜åŒ–ï¼‰        |
| â‰¥ 3      | å‰ä¸€å°¾å¸§ + é¦–å¸§  | æ—¶é—´è¿ç»­æ€§ + ç©ºé—´é”šç‚¹ï¼ˆP1 + P4ï¼‰ |
| è·¨åœºæ™¯   | ä¸å¼•ç”¨ä»»ä½•ç¯å¢ƒå¸§ | é¿å…åœºæ™¯é£æ ¼æ±¡æŸ“                 |

#### å®é™…æ¡ˆä¾‹

**åœºæ™¯**ï¼šä¸€ä¸ª Camera æœ‰ 10 ä¸ªé•œå¤´ï¼Œéƒ½åœ¨åŒä¸€åœºæ™¯

| å½“å‰é•œå¤´ | P1 å¼•ç”¨ï¼ˆå‰ä¸€å°¾å¸§ï¼‰ | P4 å¼•ç”¨ï¼ˆé¦–å¸§é”šç‚¹ï¼‰ | æ€»ç¯å¢ƒå‚è€ƒ |
| -------- | ------------------- | ------------------- | ---------- |
| shot #0  | æ—                   | æ—                   | 0 å¼        |
| shot #1  | shot #0 å°¾å¸§        | æ— ï¼ˆé—´éš” 1ï¼‰        | 1 å¼        |
| shot #2  | shot #1 å°¾å¸§        | æ— ï¼ˆé—´éš” 2ï¼‰        | 1 å¼        |
| shot #3  | shot #2 å°¾å¸§        | âœ… shot #0 é¦–å¸§     | **2 å¼ **   |
| shot #4  | shot #3 å°¾å¸§        | âœ… shot #0 é¦–å¸§     | **2 å¼ **   |
| ...      | ...                 | ...                 | ...        |
| shot #9  | shot #8 å°¾å¸§        | âœ… shot #0 é¦–å¸§     | **2 å¼ **   |

**æ•ˆæœ**ï¼š

- å‰ 3 ä¸ªé•œå¤´ï¼šçº¯æ—¶é—´è¿ç»­æ€§ï¼ˆåª 1 å¼ ç¯å¢ƒå¸§ï¼‰
- åç»­é•œå¤´ï¼šæ—¶é—´è¿ç»­æ€§ + ç©ºé—´é”šç‚¹ï¼ˆ2 å¼ ç¯å¢ƒå¸§ï¼‰
- é¿å…äº†"æ¯ä¸ªé•œå¤´éƒ½å¼•ç”¨é¦–å¸§"çš„å†—ä½™ï¼ˆé—´éš” < 3 ä¸å¼•ç”¨ï¼‰

---

## ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

### å¤‡é€‰å›¾æ•°é‡å˜åŒ–

| åˆ†é•œåœºæ™¯                       | ä¼˜åŒ–å‰   | ä¼˜åŒ–å | å‡å°‘       |
| ------------------------------ | -------- | ------ | ---------- |
| **shot #0**ï¼ˆé¦–é•œï¼‰            | 6-8 å¼    | 2-3 å¼  | **60-70%** |
| **shot #1-2**ï¼ˆç´§é‚»ï¼ŒåŒåœºæ™¯ï¼‰  | 12-15 å¼  | 3-4 å¼  | **73-80%** |
| **shot #5**ï¼ˆé—´éš” â‰¥3ï¼ŒåŒåœºæ™¯ï¼‰ | 12-15 å¼  | 4-5 å¼  | **67-73%** |
| **shot #10**ï¼ˆåœºæ™¯åˆ‡æ¢ï¼‰       | 12-15 å¼  | 2-3 å¼  | **80-85%** |

### è¯¦ç»†ç¤ºä¾‹ï¼šshot #5 çš„å¤‡é€‰å›¾ï¼ˆä¸ shot #0 åŒåœºæ™¯ï¼Œé—´éš” â‰¥3ï¼‰

#### ä¼˜åŒ–å‰ï¼ˆ12 å¼ ï¼‰

```python
[
    # 1. è§’è‰²è‚–åƒï¼ˆ6å¼ ï¼‰
    "çˆ±ä¸½ä¸_front.png",
    "çˆ±ä¸½ä¸_side.png",
    "çˆ±ä¸½ä¸_back.png",
    "é²å‹ƒ_front.png",
    "é²å‹ƒ_side.png",
    "é²å‹ƒ_back.png",

    # 2. å·²å®Œæˆåœºæ™¯å¸§ï¼ˆ5å¼ ï¼‰
    "shot_4_first_frame.png",
    "shot_3_last_frame.png",
    "shot_2_first_frame.png",
    "shot_1_last_frame.png",
    "shot_0_first_frame.png",

    # 3. ç¬¬ä¸€é•œå¤´é¦–å¸§ï¼ˆ1å¼ ï¼‰
    "shot_0_first_frame.png",  # é‡å¤çš„
]
```

#### ä¼˜åŒ–åï¼ˆ4 å¼ ï¼‰

```python
[
    # 1. è§’è‰²è‚–åƒï¼ˆæ ¹æ®æœå‘é€‰æ‹©ï¼Œ2å¼ ï¼‰
    "çˆ±ä¸½ä¸_front.png",  # æ ¹æ® ff_char_orientations[0] = "front"
    "é²å‹ƒ_side.png",     # æ ¹æ® ff_char_orientations[1] = "side"

    # 2. å‰ä¸€é•œå¤´å°¾å¸§ï¼ˆP1 ä¼˜åŒ–ï¼ŒåŒåœºæ™¯ï¼Œ1å¼ ï¼‰
    "shot_4_last_frame.png",

    # 3. Camera é¦–å¸§é”šç‚¹ï¼ˆP4 ä¼˜åŒ–ï¼Œé—´éš”â‰¥3ï¼Œ1å¼ ï¼‰
    "shot_0_first_frame.png",
]
```

**å‡å°‘äº† 67%ï¼**

### è¯¦ç»†ç¤ºä¾‹ï¼šshot #2 çš„å¤‡é€‰å›¾ï¼ˆä¸ shot #0 åŒåœºæ™¯ï¼Œé—´éš”<3ï¼‰

#### ä¼˜åŒ–å‰ï¼ˆ12 å¼ ï¼‰

```python
[
    # è§’è‰²è‚–åƒï¼ˆ6å¼ ï¼‰+ ç¯å¢ƒå¸§ï¼ˆ5å¼ ï¼‰+ é¦–å¸§å¼•ç”¨ï¼ˆ1å¼ ï¼‰
    # å…± 12 å¼ 
]
```

#### ä¼˜åŒ–åï¼ˆ3 å¼ ï¼‰

```python
[
    # 1. è§’è‰²è‚–åƒï¼ˆæ ¹æ®æœå‘é€‰æ‹©ï¼Œ2å¼ ï¼‰
    "çˆ±ä¸½ä¸_front.png",
    "é²å‹ƒ_side.png",

    # 2. å‰ä¸€é•œå¤´å°¾å¸§ï¼ˆP1 ä¼˜åŒ–ï¼Œ1å¼ ï¼‰
    "shot_1_last_frame.png",

    # æ³¨æ„ï¼šä¸å¼•ç”¨ shot_0 é¦–å¸§ï¼ˆé—´éš”<3ï¼Œç”± P1 è¦†ç›–ï¼‰
]
```

**å‡å°‘äº† 75%ï¼**

---

## æ€§èƒ½æå‡

| æŒ‡æ ‡             | ä¼˜åŒ–å‰   | ä¼˜åŒ–å        | æå‡         |
| ---------------- | -------- | ------------- | ------------ |
| **å¤‡é€‰å›¾æ•°é‡**   | 9-15 å¼   | 2-5 å¼         | **67-85% â†“** |
| **Token æ¶ˆè€—**   | ~15000   | ~4000-6000    | **60-73% â†“** |
| **LLM è°ƒç”¨æ—¶é—´** | ~8-12 ç§’ | ~3-6 ç§’       | **50-63% â†“** |
| **é€‰æ‹©å‡†ç¡®æ€§**   | ä¾èµ– LLM | ç¡®å®šæ€§é€‰æ‹©    | **æ˜¾è‘—æå‡** |
| **ç©ºé—´ä¸€è‡´æ€§**   | è¾ƒå¼±     | å¼ºï¼ˆP4 é”šç‚¹ï¼‰ | **æ˜¾è‘—æå‡** |

**æ³¨**ï¼šP4 ä¼˜åŒ–ä¸ºé—´éš” â‰¥3 çš„é•œå¤´å¢åŠ  1 å¼ ç¯å¢ƒå¸§ï¼Œæ¢å–äº†æ›´å¥½çš„ç©ºé—´ä¸€è‡´æ€§ï¼Œæ•´ä½“ä»æ˜¾è‘—å‡å°‘å¤‡é€‰å›¾æ•°é‡ã€‚

---

## ä»£ç å˜æ›´æ€»ç»“

### æ–°å¢æ–‡ä»¶

æ— 

### ä¿®æ”¹æ–‡ä»¶

1. **interfaces/shot_description.py**

   - æ·»åŠ  `ff_char_orientations` å­—æ®µ
   - æ·»åŠ  `lf_char_orientations` å­—æ®µ
   - å¯¼å…¥ `Dict` ç±»å‹

2. **agents/storyboard_artist.py**

   - æ›´æ–° `VisDescDecompositionResponse` æ¨¡å‹
   - æ›´æ–°ç³»ç»Ÿæç¤ºè¯è¦æ±‚è¯†åˆ«è§’è‰²æœå‘
   - å¯¼å…¥ `Dict` ç±»å‹

3. **pipelines/script2video_pipeline.py**
   - é‡å†™ `generate_frame_for_single_shot()` ä¸­çš„å‚è€ƒå›¾é€‰æ‹©é€»è¾‘
   - å®ç°åŸºäºè§’è‰²æœå‘çš„ä¸‰è§†å›¾é€‰æ‹©ï¼ˆP1 ä¼˜åŒ–ï¼‰
   - ç®€åŒ–ç¯å¢ƒå‚è€ƒä¸ºåªä½¿ç”¨å‰ä¸€é•œå¤´ï¼ˆåŒåœºæ™¯ï¼‰
   - æ–°å¢ P4 ä¼˜åŒ–ï¼šCamera ç©ºé—´ä¸€è‡´æ€§é”šç‚¹ï¼ˆæ¡ä»¶å¼•ç”¨é¦–å¸§ï¼‰
   - ç§»é™¤æ—§çš„å¤æ‚å¸§æ”¶é›†é€»è¾‘ï¼ˆ60 è¡Œä»£ç ï¼‰

### å‘åå…¼å®¹æ€§

- âœ… æ–°å¢å­—æ®µä¸º `Optional`ï¼Œä¸å½±å“æ—§æ•°æ®
- âœ… å¦‚æœæ²¡æœ‰æœå‘ä¿¡æ¯ï¼Œé»˜è®¤ä½¿ç”¨ `front` è§†è§’
- âœ… ä¿æŒæ‰€æœ‰æ¥å£ç­¾åä¸å˜

---

## ä½¿ç”¨ç¤ºä¾‹

### StoryboardArtist è¾“å‡ºç¤ºä¾‹

```json
{
  "ff_desc": "ä¸­æ™¯é•œå¤´ã€‚çˆ±ä¸½ä¸ï¼ˆçŸ­å‘ï¼Œç»¿è‰²è¿è¡£è£™ï¼‰é¢å‘æ‘„åƒæœºï¼Œé²å‹ƒï¼ˆé«˜ä¸ªå­ï¼Œè“è‰²è¡¬è¡«ï¼‰ä¾§å¯¹æ‘„åƒæœºç«™åœ¨å³ä¾§...",
  "ff_vis_char_idxs": [0, 1],
  "ff_char_orientations": {
    "0": "front",
    "1": "side"
  },
  "lf_desc": "...",
  "lf_vis_char_idxs": [0, 1],
  "lf_char_orientations": {
    "0": "front",
    "1": "front"
  }
}
```

### å¸§ç”Ÿæˆæ—¥å¿—ç¤ºä¾‹

**shot #2ï¼ˆé—´éš” < 3ï¼Œä¸è§¦å‘ P4ï¼‰**ï¼š

```
ğŸ–¼ï¸ Starting first_frame generation for shot 2...
âœ… ä¼˜åŒ–: ä¸ºè§’è‰² 0_çˆ±ä¸½ä¸ (appearance_0) é€‰æ‹©äº† front è§†è§’
âœ… ä¼˜åŒ–: ä¸ºè§’è‰² 1_é²å‹ƒ (appearance_0) é€‰æ‹©äº† side è§†è§’
âœ… ä¼˜åŒ–: ä½¿ç”¨å‰ä¸€ä¸ªé•œå¤´ #1 çš„æœ«å¸§ä½œä¸ºç¯å¢ƒå‚è€ƒ
P4è·³è¿‡: é•œå¤´ #2 è·ç¦»é¦–é•œå¤´ä»…2ä¸ªé•œå¤´ï¼Œç”±P1ä¼˜åŒ–è¦†ç›–
ğŸ” Selecting reference images and generating prompt for first_frame frame of shot 2...
âœ… Selected 3 reference images: [0, 1, 2]
```

**shot #5ï¼ˆé—´éš” â‰¥ 3ï¼Œè§¦å‘ P4ï¼‰**ï¼š

```
ğŸ–¼ï¸ Starting first_frame generation for shot 5...
âœ… ä¼˜åŒ–: ä¸ºè§’è‰² 0_çˆ±ä¸½ä¸ (appearance_0) é€‰æ‹©äº† front è§†è§’
âœ… ä¼˜åŒ–: ä¸ºè§’è‰² 1_é²å‹ƒ (appearance_0) é€‰æ‹©äº† side è§†è§’
âœ… ä¼˜åŒ–: ä½¿ç”¨å‰ä¸€ä¸ªé•œå¤´ #4 çš„æœ«å¸§ä½œä¸ºç¯å¢ƒå‚è€ƒ
âœ… P4ä¼˜åŒ–: é•œå¤´ #5 è·ç¦»é¦–é•œå¤´ #0 é—´éš”5ï¼Œæ·»åŠ Cameraç©ºé—´é”šç‚¹
ğŸ” Selecting reference images and generating prompt for first_frame frame of shot 5...
âœ… Selected 4 reference images: [0, 1, 2, 3]
```

---

## æœªæ¥æ”¹è¿›æ–¹å‘

1. **åŠ¨æ€è§†è§’é€‰æ‹©**

   - æ ¹æ®é•œå¤´ç±»å‹è‡ªåŠ¨æ¨æ–­è§†è§’
   - ä¾‹å¦‚ï¼šè¿‡è‚©é•œå¤´è‡ªåŠ¨é€‰æ‹© back è§†è§’

2. **å¤šè§†è§’èåˆ**

   - å¯¹äºå¤æ‚è§’åº¦ï¼ˆå¦‚ 3/4 è§†è§’ï¼‰ï¼Œè€ƒè™‘èåˆå¤šä¸ªè§†å›¾

3. **åœºæ™¯çº§åˆ«ç¼“å­˜**

   - ç¼“å­˜åœºæ™¯çš„"ä»£è¡¨å¸§"
   - é¿å…æ¯æ¬¡éƒ½é‡æ–°é€‰æ‹©ç¯å¢ƒå‚è€ƒ

4. **æ™ºèƒ½å›é€€æœºåˆ¶**
   - å¦‚æœæŒ‡å®šè§†è§’ä¸å­˜åœ¨ï¼Œæ™ºèƒ½é€‰æ‹©æœ€æ¥è¿‘çš„è§†è§’
   - ä¾‹å¦‚ï¼šside ä¸å­˜åœ¨æ—¶ï¼Œé€‰æ‹© front

---

## æ€»ç»“

è¿™æ¬¡ä¼˜åŒ–é€šè¿‡ï¼š

1. âœ… **åœ¨åˆ†é•œæ‹†è§£é˜¶æ®µæå–è§’è‰²æœå‘** â†’ ç¡®å®šæ€§é€‰æ‹©ä¸‰è§†å›¾
2. âœ… **åªä½¿ç”¨å‰ä¸€é•œå¤´çš„å°¾å¸§** â†’ ç›´æ¥çš„æ—¶é—´è¿ç»­æ€§
3. âœ… **åŸºäº scene_id åˆ¤æ–­åœºæ™¯åˆ‡æ¢** â†’ é¿å…è·¨åœºæ™¯å¹²æ‰°
4. âœ… **P4 æ¡ä»¶å¼•ç”¨é¦–å¸§** â†’ ä¿æŒ Camera ç©ºé—´ä¸€è‡´æ€§ï¼ˆé—´éš” â‰¥3 æ—¶ï¼‰

å®ç°äº†ï¼š

- **67-85% çš„å¤‡é€‰å›¾å‡å°‘**ï¼ˆæ ¹æ®é•œå¤´ä½ç½®ï¼‰
- **50-63% çš„å¤„ç†é€Ÿåº¦æå‡**
- **æ›´é«˜çš„é€‰æ‹©å‡†ç¡®æ€§**ï¼ˆç¡®å®šæ€§ä¸‰è§†å›¾é€‰æ‹©ï¼‰
- **æ›´å¼ºçš„ç©ºé—´ä¸€è‡´æ€§**ï¼ˆP4 é”šç‚¹æœºåˆ¶ï¼‰
- **æ›´æ¸…æ™°çš„ä»£ç é€»è¾‘**ï¼ˆç§»é™¤ 60 è¡Œå¤æ‚é€»è¾‘ï¼‰

è¿™æ˜¯ä¸€ä¸ªé«˜è´¨é‡çš„ä¼˜åŒ–ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿæ•ˆç‡ã€å‡†ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ğŸ‰

---

## ä¼˜åŒ–ç¼–å·æ€»ç»“

| ç¼–å· | åç§°                  | ä¸»è¦ä½œç”¨           | è§¦å‘æ¡ä»¶     |
| ---- | --------------------- | ------------------ | ------------ |
| P1   | æ™ºèƒ½ä¸‰è§†å›¾é€‰æ‹©        | å‡å°‘è§’è‰²è‚–åƒå›¾æ•°é‡ | æ‰€æœ‰é•œå¤´     |
| P2   | ç®€åŒ–ç¯å¢ƒå‚è€ƒé€»è¾‘      | å‡å°‘ç¯å¢ƒå¸§æ•°é‡     | åŒåœºæ™¯é•œå¤´   |
| P3   | åœºæ™¯å®šä¹‰ä¼ é€’          | æå‡åœºæ™¯ä¸€è‡´æ€§     | æœ‰åœºæ™¯ ID    |
| P4   | Camera ç©ºé—´ä¸€è‡´æ€§é”šç‚¹ | é˜²æ­¢é•¿åºåˆ—è§†è§‰æ¼‚ç§» | é—´éš” â‰¥3 é•œå¤´ |
