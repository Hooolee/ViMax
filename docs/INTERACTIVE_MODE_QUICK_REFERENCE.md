# 交互模式快速参考

## 快速开始

### 1. 启用交互模式

在 `main_idea2video.py` 中设置：

```python
interactive_mode = True  # 默认值
```

### 2. 运行程序

```bash
python main_idea2video.py
```

### 3. 交互选项

程序运行时会在每个步骤后显示：

```
================================================================================
🎯 [阶段名称] 阶段已完成！
================================================================================
请选择：
  [c] 继续下一步
  [r] 重新运行当前步骤
  [q] 退出程序
================================================================================
请输入选项 (c/r/q):
```

**输入选项**：

- `c` - 继续执行下一步
- `r` - 重新运行当前步骤（会删除已生成的文件）
- `q` - 退出程序

## 执行流程

```
开始
  ↓
📖 发展故事 (Develop Story)
  ↓ [等待用户: c/r/q]
📝 编写剧本 (Write Script)
  ↓ [等待用户: c/r/q]
🎬 场景规划 (Plan Scenes)
  ↓ [等待用户: c/r/q]
👥 提取角色 (Extract Characters)
  ↓ [等待用户: c/r/q]
🎨 生成角色肖像 (Generate Character Portraits)
  ↓ [等待用户: c/r/q]
🎥 生成场景视频 (Scene 1/N)
  ↓ [等待用户: c/r/q]
🎥 生成场景视频 (Scene 2/N)
  ↓ [等待用户: c/r/q]
  ... (更多场景)
🎉 最终视频完成
  ↓ [等待用户: c/r/q]
结束
```

## 每个阶段显示的信息

| 阶段            | 显示内容                     |
| --------------- | ---------------------------- |
| 📖 发展故事     | 故事内容预览（前 500 字符）  |
| 📝 编写剧本     | 场景数量 + 前 3 个场景的预览 |
| 🎬 场景规划     | 所有场景的位置、时间和描述   |
| 👥 提取角色     | 所有角色的名称和描述         |
| 🎨 生成角色肖像 | 所有角色的肖像文件路径       |
| 🎥 生成场景视频 | 每个场景视频的文件路径       |
| 🎉 最终视频完成 | 最终视频的完整路径           |

## 禁用交互模式

如果不需要交互，设置：

```python
interactive_mode = False
```

程序将自动运行所有步骤。

## 常见操作

### 重新生成某个阶段

1. 运行程序
2. 等待到达要重新生成的阶段
3. 当该阶段完成后，输入 `r`
4. 程序会删除该阶段的输出文件并重新执行

### 提前退出

在任何阶段输入 `q` 或按 `Ctrl+C`

### 从中断处继续

如果程序中断，下次运行时会从已完成的步骤继续（基于文件缓存）

## 输出文件位置

所有输出文件保存在：

```
.working_dir/<output_subdir>/
├── story.txt                           # 故事文本
├── script.json                         # 剧本
├── scenes.json                         # 场景定义
├── characters.json                     # 角色信息
├── character_portraits_registry.json   # 角色肖像注册
├── character_portraits/                # 角色肖像目录
│   └── <idx>_<name>/
│       ├── front.png
│       ├── side.png
│       └── back.png
├── scene_0/                            # 场景0工作目录
│   └── final_video.mp4
├── scene_1/                            # 场景1工作目录
│   └── final_video.mp4
└── final_video.mp4                     # 最终合成视频
```

## 故障排除

### 问题：程序不等待输入

**解决**：检查 `interactive_mode` 是否设置为 `True`

### 问题：输入选项无效

**解决**：只输入单个字符 `c`、`r` 或 `q`，然后按回车

### 问题：重新运行后文件仍然存在

**解决**：程序会自动删除文件，如果仍存在，请手动删除对应的输出文件

### 问题：在 CI/CD 中使用时卡住

**解决**：在自动化环境中使用时，设置 `interactive_mode=False`

## 更多信息

详细文档：`docs/INTERACTIVE_MODE_GUIDE.md`
实现细节：`docs/INTERACTIVE_MODE_IMPLEMENTATION.md`
测试示例：`test_interactive_mode.py`
